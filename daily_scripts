# fixing qcd recalculation for systematics

it seems it is always done only for nominal

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 -s PUUp

hadd plots/distrs/foobar.root plots//distrs/distrs_redo_v25v26_mc_HISTOSEL_Mt_lep_met_f_mu_sel_lj_*



ls histosels/redo-v25-v26_1/distrs/*root | wc -l
584
ls histosels/redo-v25-v26_1/distrs/2/*root | wc -l
620

hadd histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_1_objfix.root histosels/redo-v25-v26_1/distrs/*root






# correcting the plots

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3


python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other.dy_other,dy_tautau

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other


python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,TOPPT

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,JES,JER,TES

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,TOPPT,JES,JER,TES

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root -p -r -o plots/ --lumi 35800 -c mu_sel_lj -x mu_selVloose_lj -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --ratio-range 0.3 --merge-procs wjets_taul,wjets_tauh,wjets_other:wjets.dy_other,dy_tautau:dy.s_top_mutau,s_top_lj,s_top_other:s_top.tt_taultauh,tt_taulj,tt_other --systematic-uncertainty bSF,PU,LEPmuID,LEPmuTRG,TOPPT,JES,JER,TES,Frag,SemilepBR,Peterson





# compare precomputed mt-s to recomputed

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


python -W ignore sumup_ttree_draw.py "event_met_lep_mt" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL_precomp.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f_precomp  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 40821, Total sum= 36603.5

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f_precomp")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f_precomp, Entries= 40821, Total sum= 36603.5

hadd quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL_compare.root quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL_precomp.root quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root

h         = (TH1D*) mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")
h_precomp = (TH1D*) mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f_precomp")

h_precomp->SetLineColor(kRed)

h        ->Draw()
h_precomp->Draw("same")

OK perfect match

to implement the mt obj variations


test

time python -W ignore sumup_ttree_draw.py "std_mt_vars" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_obj_mt.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root


mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Draw()
mu_sel->Get("tt_mutau/JESUp/mu_sel_tt_mutau_JESUp_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/JESDown/mu_sel_tt_mutau_JESDown_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/JERUp/mu_sel_tt_mutau_JERUp_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/JERDown/mu_sel_tt_mutau_JERDown_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/TESUp/mu_sel_tt_mutau_TESUp_Mt_lep_met_f")->Draw("same")
mu_sel->Get("tt_mutau/TESDown/mu_sel_tt_mutau_TESDown_Mt_lep_met_f")->Draw("same")

perfect

hadd jobsums/distrs/distrs_redo_v25v26_mc_3w0jets.root quick-test/redo-v25-v26_cats_hadds/MC*

mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_f")->Draw()
mu_sel_lj->Get("tt_mutau/JESUp/mu_sel_lj_tt_mutau_JESUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/JESDown/mu_sel_lj_tt_mutau_JESDown_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/JERUp/mu_sel_lj_tt_mutau_JERUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/JERDown/mu_sel_lj_tt_mutau_JERDown_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/TESUp/mu_sel_lj_tt_mutau_TESUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("tt_mutau/TESDown/mu_sel_lj_tt_mutau_TESDown_Mt_lep_met_f")->Draw("same")

mu_selVloose_lj->Get("tt_mutau/NOMINAL/mu_selVloose_lj_tt_mutau_NOMINAL_Mt_lep_met_f")->Draw()
mu_selVloose_lj->Get("tt_mutau/TESUp/mu_selVloose_lj_tt_mutau_TESUp_Mt_lep_met_f")->Draw("same")
mu_selVloose_lj->Get("tt_mutau/TESDown/mu_selVloose_lj_tt_mutau_TESDown_Mt_lep_met_f")->Draw("same")

mu_sel_lj->Get("qcd/NOMINAL/mu_sel_lj_qcd_NOMINAL_Mt_lep_met_f")->Draw()
mu_sel_lj->Get("qcd/TESUp/mu_sel_lj_qcd_TESUp_Mt_lep_met_f")->Draw("same")
mu_sel_lj->Get("qcd/TESDown/mu_sel_lj_qcd_TESDown_Mt_lep_met_f")->Draw("same")

rerun histosels and substitute HISTOSEL file for the fit

foreach sys (JESDown JESUp)
foreach sys (TESDown TESUp)
foreach sys (JERDown JERUp)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --sys $sys &
end

hadd histosels/redo-v25-v26_1/HISTOSELS_redo_v25_v26_2.root histosels/redo-v25-v26_1/*root







# datacards

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex


new lep systematics

 KEY: TDirectoryFile	LEPelIDDown;1	LEPelIDDown
 KEY: TDirectoryFile	LEPelIDUp;1	LEPelIDUp
 KEY: TDirectoryFile	LEPelTRGDown;1	LEPelTRGDown
 KEY: TDirectoryFile	LEPelTRGUp;1	LEPelTRGUp
 KEY: TDirectoryFile	LEPmuIDDown;1	LEPmuIDDown
 KEY: TDirectoryFile	LEPmuIDUp;1	LEPmuIDUp
 KEY: TDirectoryFile	LEPmuTRGDown;1	LEPmuTRGDown
 KEY: TDirectoryFile	LEPmuTRGUp;1	LEPmuTRGUp

ttxsec/fit-stuff/new_impact_table.py
python ttxsec/fit-stuff/new_impact_table.py --merge-pdf latest_el_impacts.json latest_mu_impacts.json latest_both_impacts.json





# histosels

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8

qcd

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05



systematics with recalculated qcd

foreach sys (`cat syst-test.syst-list.1`)
foreach sys (`cat syst-test.syst-list.1_aa`)
foreach sys (`cat syst-test.syst-list.1_ab`)
foreach sys (`cat syst-test.syst-list.1_ac`)
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --qcd 1.05 --systematic $sys &
end

and without (hard tt modeling)

syst-test.syst-list.2_aa  syst-test.syst-list.2_ac  syst-test.syst-list.2_ae  syst-test.syst-list.2_ag
syst-test.syst-list.2_ab  syst-test.syst-list.2_ad  syst-test.syst-list.2_af  syst-test.syst-list.2_ah

foreach sys (`cat syst-test.syst-list.2_aa`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ab`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ac`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ad`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ae`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_af`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ag`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end

foreach sys (`cat syst-test.syst-list.2_ah`)
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o histosels/redo-v25-v26_1/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8 --sys $sys &
  python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o histosels/redo-v25-v26_1/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8 --sys $sys &
end





old example:

foreach sys (`cat syst-test.syst-list.1`)
python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s $sys || true
end

python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true


foreach sys (`cat syst-test.syst-list.1`)
python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s $sys || true
end

python stack_plot.py distrs_v25pStage2Run3_3_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true


now datacard with qcd systematics and free parameters
and run NLL and impacts













# run with systematics, tt in separate bunches

let's hadd after all?

tt, data, small and tt systs are hadded already

all nominals:

merge-sets/jobs_hadd.dtags.single-muon      
merge-sets/jobs_hadd.dtags.single-electron 

merge-sets/jobs_hadd.dtags.all-tt-systs_main

merge-sets/jobs_hadd.dtags.small_main
merge-sets/jobs_hadd.dtags.large_aa_main
merge-sets/jobs_hadd.dtags.large_ab_main

MC2016_Summer16_TTJets_powheg


time python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/MC2016_Summer16_TTJets_powheg.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


foreach dtag (`cat merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
echo $dtag
time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (`cat merge-sets/jobs_hadd.dtags.small_main`)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_aa_main`)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_ab_main`)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end

foreach dtag (SingleMuon SingleElectron)
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_sels/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
end






with systematics:

named_systs_weights_all = {'nom': systs_weights_nominal,
'common': systs_weights_common,
'obj'   : systs_objects,
'tt_weights': systs_weights_tt,
'tt_hard': systs_weights_tt_hard,
'tt_pdf':  systs_weights_tt_alpha_pdf,
}

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach systs (nom,common obj tt_weights tt_hard tt_pdf)
  time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_${chans}_$systs.root    --std-histos --histo-name $chans/std_procs/$systs/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &
  end
end


foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
  echo $dtag
  time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.small_main`)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_aa_main`)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end

foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (`cat merge-sets/jobs_hadd.dtags.large_ab_main`)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end


foreach chans ( el_sel_lj,el_selVloose_lj,el_sel_ljout,el_selVloose_ljout,el_sel_lj_ss,el_selVloose_lj_ss,el_sel_ljout_ss,el_selVloose_ljout_ss mu_sel_lj,mu_selVloose_lj,mu_sel_ljout,mu_selVloose_ljout,mu_sel_lj_ss,mu_selVloose_lj_ss,mu_sel_ljout_ss,mu_selVloose_ljout_ss)
  foreach dtag (SingleMuon SingleElectron)
  python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root &
  end
end



-- gen batch jobs out of this?





## batch jobs

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach systs (nom common obj tt_weights tt_hard tt_alpha tt_pdf1 tt_pdf10 tt_pdf20 tt_pdf30 tt_pdf40 tt_pdf50)
  echo \#\!/bin/sh                                          > batch_jobs/tt_${chans}_${systs}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/tt_${chans}_${systs}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/tt_${chans}_${systs}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/tt_${chans}_${systs}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/tt_${chans}_${systs}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/tt_${chans}_${systs}
  echo cmsenv                                              >> batch_jobs/tt_${chans}_${systs}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/tt_${chans}_${systs}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_${chans}_$systs.root    --std-histos --histo-name $chans/std_procs/$systs/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root >> batch_jobs/tt_${chans}_${systs}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main  sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (SingleMuon SingleElectron)
  echo \#\!/bin/sh                                          > batch_jobs/data_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/data_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/data_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/data_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/data_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/data_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/data_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/data_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/data_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/data_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"std_mt_vars"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/data_${dtag}_${chans}
  end
end



ls batch_jobs/ > batch_jobs/submit

qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/e
UserCodeh

% s,^,qsub -l h_vmem=1G '/lstore/cms/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/proc/batch_jobs/,
% s/$/'/

remove the line with submit

$ wc -l batch_jobs/submit
800 batch_jobs/submit


sed -i 's/--cond-com/--cond-com ""/'                 batch_jobs/data_*
sed -i -e 's/sqrt/"sqrt/' -e 's/ --ttree/" --ttree/' batch_jobs/tt_*


PUDown failed (= PUUp now)



hadds


hadd quick-test/redo-v25-v26_cats_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_el_*.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_mu_*.root &

foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.all-tt-systs_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main`)
foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main`)
foreach dtag (SingleMuon SingleElectron)
hadd quick-test/redo-v25-v26_cats_hadds/$dtag.root quick-test/redo-v25-v26_cats/$dtag*root &
end

hadd quick-test/distrs_redo_v25v26_mc_3.root quick-test/redo-v25-v26_cats_hadds/MC*


merge-sets/jobs_hadd.dtags.small_main
merge-sets/jobs_hadd.dtags.large_aa_main
merge-sets/jobs_hadd.dtags.large_ab_main

MC2016_Summer16_TTJets_powheg

small did not match
MC2016_Summer16_WJets_madgraph did not match
and only el_sel_lj in SingleT


foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo $chans $dtag
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}
  echo python -W ignore sumup_ttree_draw.py '"sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (`cat sw-dir/merge-sets/jobs_hadd.dtags.large_aa_main sw-dir/merge-sets/jobs_hadd.dtags.large_ab_main sw-dir/merge-sets/jobs_hadd.dtags.small_main`)
  echo $chans
  echo $dtag
  end
end


foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (MC2016_Summer16_WJets_madgraph)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py '"sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end


ls batch_jobs/mc_* batch_jobs/tt_* batch_jobs/data_* > batch_jobs/submit



broken weights and number of entries

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach systs (nom,common obj tt_weights tt_hard tt_pdf)
  echo \#\!/bin/sh                                          > batch_jobs/tt_${chans}_${systs}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/tt_${chans}_${systs}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/tt_${chans}_${systs}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/tt_${chans}_${systs}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/tt_${chans}_${systs}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/tt_${chans}_${systs}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/tt_${chans}_${systs}
  echo cmsenv                                              >> batch_jobs/tt_${chans}_${systs}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/tt_${chans}_${systs}

  end
end




python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_NOMINAL,TESUp.root    --std-histos --histo-name mu_sel/std_procs/NOMINAL,TESUp/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_TESUp.root    --std-histos --histo-name mu_sel/std_procs/TESUp/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &


root [6] mu_sel_lj->Get("tt_lj/NOMINAL/mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 11001, Total sum= 10001.2


root [1] mu_sel->Get("tt_lj/NOMINAL/mu_sel_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 18405, Total sum= 16741.9

root [3] mu_sel->Get("tt_lj/NOMINAL/mu_sel_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 18405, Total sum= 16741.9
root [4] mu_sel->Get("tt_lj/TESUp/mu_sel_tt_lj_TESUp_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_TESUp_Mt_lep_met_f, Entries= 19110, Total sum= 133735

root [2] mu_sel->Get("tt_lj/TESUp/mu_sel_tt_lj_TESUp_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_lj_TESUp_Mt_lep_met_f, Entries= 19110, Total sum= 133735


python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_TESUp.root    --std-histos --histo-name mu_sel/std_procs/TESUp/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root




## distrs

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleMuon.root     -o plots/redo-v25-v26_1/ -p -r --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8

python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8
python stack_plot.py distrs/distrs_redo_v25v26_mc.root ../quick-test/redo-v25-v26_1_cats_hadds/SingleElectron.root -o plots/redo-v25-v26_1/ -p -r --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8


-- w0jets are not cut off well

foreach chans (el_sel_lj el_selVloose_lj el_sel_ljout el_selVloose_ljout el_sel_lj_ss el_selVloose_lj_ss el_sel_ljout_ss el_selVloose_ljout_ss mu_sel_lj mu_selVloose_lj mu_sel_ljout mu_selVloose_ljout mu_sel_lj_ss mu_selVloose_lj_ss mu_sel_ljout_ss mu_selVloose_ljout_ss)
  foreach dtag (MC2016_Summer16_WJets_madgraph)
  echo \#\!/bin/sh                                          > batch_jobs/mc_${dtag}_${chans}
  echo export X509_USER_PROXY=/home/t3cms/olek/x509_proxy  >> batch_jobs/mc_${dtag}_${chans}
  echo export SCRAM_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export BUILD_ARCH=slc6_amd64_gcc530                 >> batch_jobs/mc_${dtag}_${chans}
  echo export VO_CMS_SW_DIR=/cvmfs/cms.cern.ch             >> batch_jobs/mc_${dtag}_${chans}
  echo source $VO_CMS_SW_DIR/cmsset_default.sh             >> batch_jobs/mc_${dtag}_${chans}
  echo export CMS_PATH=$VO_CMS_SW_DIR                      >> batch_jobs/mc_${dtag}_${chans}
  echo cd /lstore/cms/olek/CMSSW_8_0_26_patch1/src/        >> batch_jobs/mc_${dtag}_${chans}
  echo cmsenv                                              >> batch_jobs/mc_${dtag}_${chans}
  echo cd UserCode/NtuplerAnalyzer/proc/                   >> batch_jobs/mc_${dtag}_${chans}

  echo python -W ignore sumup_ttree_draw.py --cut-w0jets '"sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))"' --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com '""' --output quick-test/redo-v25-v26_cats/${dtag}_$chans.root    --std-histos --histo-name $chans/std_procs/nom,common,obj/Mt_lep_met_f  --per-weight --try-xsec --save-weight lstore_outdirs/merge-sets/v25/resub1/$dtag*.root >> batch_jobs/mc_${dtag}_${chans}
  end
end

hadd jobsums/distrs/distrs_redo_v25v26_mc_2w0jets.root quick-test/redo-v25-v26_cats_hadds/MC*










## some error with NOMINAL TT

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL,common/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL,common,obj/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root



check updowns

python -W ignore sumup_ttree_draw.py --debug --test "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_fsrup_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup*root

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_fsrup_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrup*root

time python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26_tests/MC2016_Summer16_TTJets_powheg_fsrdown_mu_sel_lj_NOMINAL.root --std-histos --histo-name mu_sel_lj/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/MC2016_Summer16_TTJets_powheg_fsrdown*root



fixed sys names of updowns



also the hadd failed?

ls quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_el_*.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_mu_*.root | wc -l

hadd quick-test/redo-v25-v26_cats_hadds/MC2016_Summer16_TTJets_powheg.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_el_*.root quick-test/redo-v25-v26_cats/MC2016_Summer16_TTJets_powheg_mu_*.root










# skipping the merge step

compate these:

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/MC2016_Summer16_TTJets_powheg_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleElectron_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleElectron.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleMuon.root &

to:

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/MC2016_Summer16_TTJets_powheg_sels_files.root --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v26/resub1/MC2016_Summer16_TTJets_powheg/*root &
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleElectron_sels_files.root                --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v25/resub1/Data13TeV_SingleElectron2016*/*root &
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels_files.root                    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v25/resub1/Data13TeV_SingleMuon2016*/*root &

OK  SingleMuon
OK  SingleElectron (14383)
OK  MC TT

hadded file
root [2] el_sel->Get("tt_eltau/NOMINAL/el_sel_tt_eltau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = el_sel_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 27022, Total sum= 25102.6
root [3] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 40821, Total sum= 36603.5

separate files (takes much longer, 30 minutes)
TH1.Print Name  = el_sel_tt_eltau_NOMINAL_Mt_lep_met_f, Entries= 27022, Total sum= 25102.6
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 40821, Total sum= 36603.5

Perfect



debugging input with multiple files

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels_files.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/v25/resub1/Data13TeV_SingleMuon2016B_03Feb2017_ver2/Data13TeV_SingleMuon2016B_03Feb2017_ver2_1.root lstore_outdirs/v25/resub1/Data13TeV_SingleMuon2016B_03Feb2017_ver2/Data13TeV_SingleMuon2016B_03Feb2017_ver2_10.root







## time them too?








# run selection on v25-v26

first finish the full script on all dtags
systematics per each dtag

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root



python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut_tt.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut_tt_without.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

-- test with and without OK



python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_wjet.root    --std-histos --histo-name el_sel,mu_sel/std_procs/per_dtag/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_ttjet.root   --std-histos --histo-name el_sel,mu_sel/std_procs/per_dtag/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root &

-- nothing in wjets


python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_wjet.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root

python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_per_dtag_sys_wjet.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root

-- only 16 events pass?


but it seems to work

run on all MCs etc:

the fit was with
HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root

from log below it was made with

grep v25pStage2Run3_3_Run4_mu_ljs jobsums/histosel*
grep: jobsums/histosel-roots: Is a directory
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8    -s NOMINAL || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_pdfs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_pdfs:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_rest:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
jobsums/histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_rest:python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true


last in histosel-roots
HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root
v25pStage2Run3_3_Run4_el_ljs
v25pStage2Run3_3_Run4_mu_ljs

HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root


in mc_norm
distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root

from below:

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root v25pStage2Run4Rest/MC* v25pStage2Run4Rest/wjets/MC* v25r4/MC* v26pStage2Run4/MC2016_Summer16_TTJets_powheg.root

cp  distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root  ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

merge-sets/v25/pStage2Run4Rest  -- small processes MC    (28 files)
merge-sets/v25/r4               -- TT systematics        ( 8 files)
merge-sets/v26/pStage2Run4      -- main TT               ( 1 file)

all MC
ls merge-sets/v25/pStage2Run4Rest/*.root merge-sets/v25/r4/*root merge-sets/v26/pStage2Run4/*root

-- 37 files

and Data in ../distrs/v25pStage2Run3_hadds/SingleMuon.root

ls merge-sets/v25/pStage2Run3/Data*


python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/MC2016_Summer16_WJets_madgraph.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run4Rest/MC2016_Summer16_WJets_madgraph.root




## confirm the old selection is processed ok with the super sumup script in mu_sel, el_sel and NOMINAL

foreach file (`ls merge-sets/v25/pStage2Run4Rest/*root`)
setenv dtag `echo $file | sed 's/^.*\(MC[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run4Rest/$dtag.root
end


foreach file (`ls merge-sets/v25/r4/MC*root`)
setenv dtag `echo $file | sed 's/^.*\(MC[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/r4/$dtag.root &
end

foreach file (`ls merge-sets/v26/pStage2Run4/MC*TT*root`)
setenv dtag `echo $file | sed 's/^.*\(MC[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v26/pStage2Run4/$dtag.root &
end

foreach file (`ls merge-sets/v25/pStage2Run3/Data*root`)
setenv dtag `echo $file | sed 's/^.*\(Data[^.]*\).root.*/\1/'`
python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/$dtag.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run3/$dtag.root &
end



debugging

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/MC2016_Summer16_WJets_madgraph.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run4Rest/MC2016_Summer16_WJets_madgraph.root


python -W ignore sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-at-v40/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight merge-sets/v25/pStage2Run3/Data13TeV_SingleMuon2016H_03Feb2017_ver2.root



-- works, but now the selection ids are different





## re-stage2 the old NTuples

with separate presel and sel!    -- CORRECT NUMBERS IN DRAW
and with Vloose cut at tau!      -- CHECK? OK

merge-sets/jobs_hadd.dtags.all-tt-systs

merge-sets/jobs_hadd.dtags.small
merge-sets/jobs_hadd.dtags.large_aa
merge-sets/jobs_hadd.dtags.large_ab

make merge_proc dtags=merge-sets/jobs_hadd.dtags.all-tt-systs nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.single-muon      nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.single-electron  nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small    nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v25 proc=resub1 merge_dir=lstore_outdirs/merge-sets/

hadd lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v26/resub1/MC2016_Summer16_TTJets_powheg/*root &




test data and tt yields

SingleMuon
64252 ev
24147 in OS mu_sel

SingleElectron
38121 ev
14383 in OS el_sel

TT
249914 ev
64461  OS mu
42162  OS el

OK



TT and Data nominals:

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/MC2016_Summer16_TTJets_powheg_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v26/resub1/MC2016_Summer16_TTJets_powheg.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleElectron_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleElectron.root &

python -W ignore sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/redo-v25-v26/SingleMuon_sels.root    --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight lstore_outdirs/merge-sets/v25/resub1/SingleMuon.root &















# el yield investigation PROBLEM

quick test


scheme Dilep_tauId

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "musel/tt/NOMINAL/musel_tt_NOMINAL_lep_pt" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_mutau_lep_pt.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "elsel/tt/NOMINAL/elsel_tt_NOMINAL_lep_pt" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_eltau_lep_pt.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

8302 and 1856



scheme signal

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "musel/tt/NOMINAL/musel_tt_NOMINAL_lep_pt" --output quick-test/v34/MC2016_Summer16_TTJets_powheg_mutau_lep_pt.root gstore_outdirs/v34/*/Ntupler_v34_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "elsel/tt/NOMINAL/elsel_tt_NOMINAL_lep_pt" --output quick-test/v34/MC2016_Summer16_TTJets_powheg_eltau_lep_pt.root gstore_outdirs/v34/*/Ntupler_v34_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &


6400 and 4313


scheme Dilep_tauId

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "musel/tt/NOMINAL/musel_tt_NOMINAL_lep_pt" --output quick-test/v31v27/MC2016_Summer16_TTJets_powheg_mutau_lep_pt.root gstore_outdirs/v31v27/*/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

python sumup_ttree_draw.py "lep_p4[0].pt()" --histo-range 21,0.,200 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight    --save-weight --histo-name "elsel/tt/NOMINAL/elsel_tt_NOMINAL_lep_pt" --output quick-test/v31v27/MC2016_Summer16_TTJets_powheg_eltau_lep_pt.root gstore_outdirs/v31v27/*/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg*/*/0000/*_22.root &

mu el
613 and 415

????



NTupler on 1 TT file 10k events

tauID

abs(leps_ID) == 11 or 13
184
681

Dilepton

11 or 13
0
0

11*11, 11*13 or 13*13
4
21
63

-- hm?


v33tauCands

tauID

11 13

184
681


Dilepton

11 11   11 13   13 13

4
21
63


v26

tauID

184
681


Dilepton

4
21
63

?



------------------------ ok, ntupler outputs the same
test whether the gstore files are the same?




root -l gstore_outdirs/v26/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v26_MC2016_Summer16_TTJets_powheg/180412_180008/0000/MC2016_Summer16_TTJets_powheg_1.root

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(leps_ID)==11")
39156

((TTree*) ntupler->Get("reduced_ttree"))->Draw("5", "abs(leps_ID)==13")
55855

-- but the ratio is totally not 184-681!!!!!!!!!!!!!!!!!!!!!!!1111

root -l gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/*/0000/MC2016_Summer16_TTJets_powheg_1.root

11
13645
13
57593

???



------------------------ test ntupler on tauID_Dileptons together
must be no interference -- dilep scheme did not contribute any events to leps_ID 11, 13

v40

11 13
184
681

11*11 11*13 13*13

4
21
63

-- no interference!

v26 (RECOMPILE!)

518
663

29
65
63


--- there +20 muons now? more precise barrel-endcap relIso?
or just movement from el-mu to mu?


fixed electrons
507? (missing what?)
663

25
63
63


some electrons are missing..

dut to higher veto pt?
-    el_veto_kino_cuts_pt  = cms.double( 10.),
+    el_veto_kino_cuts_pt  = cms.double( 15.),

-- an old veto elecron is not considered at all

and lower muon veto pt:
-    mu_veto_kino_cuts_pt  = cms.double( 15.),
+    mu_veto_kino_cuts_pt  = cms.double( 10.),

-- it scratches elmu probably

test with old vetos

507
663

25
63
63

same????????


filters_noBadMuons
filters_duplicateMuons

maybe the filters work? -- they actually must tag events and not skip them

nothing works. hopefully it's ok, running as is





# new sumup draw

lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_draw.py "{draw_com}" --ttree ttree_out """ + "--histo-range {}".format(args.histo_range) + """ --cond-com "{selection}" --output {outdir}/test1_lep_pt_{dtag}_{chan}_{proc}_{sys}_{distr}.root  --histo-name {chan}/{proc}/{sys}/{chan}_{proc}_{sys}_{distr}  --save-weight {options} {dtag_file}

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight  lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root



python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight  lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

-- per weight and xsecs (only lumi is left)
if do this then also THE TAU ID 0.95 and THE SYSTEMATIC NORM TO WEIGHT!



systematics

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root



multiple channels

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root


python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name all_std/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root



automatic el processes?

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name mu_sel,el_sel/std_procs/NOMINAL,obj,common/Mt_lep_met_f  --save-weight  lstore_outdirs/v40/p1/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_1.root

-- ok
but too few el events?



test event yield in tt

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight  lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_TTJets_powheg.root

-- in TT 64.7k mu sel (107)
  and 14.1k of el sel (117)

same difference in presel

and no vloose? -- yes, the cut is at Medium


w0jets

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_nocut.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight              lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root &

python sumup_ttree_draw.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "" --output quick-test/test1_lep_pt_super_w0cut.root  --std-histos --histo-name el_sel,mu_sel/std_procs/NOMINAL/Mt_lep_met_f  --per-weight --try-xsec --save-weight --cut-w0jets lstore_outdirs/merge-sets/v40/p1/MC2016_Summer16_WJets_madgraph.root &










# number of jobs for control

ls gstore_outdirs/v40/SingleMuon/Ntupler_v40_Data13TeV_SingleMuon2016*/*/*/*root         | wc -l
471
ls gstore_outdirs/v40/SingleElectron/Ntupler_v40_Data13TeV_SingleElectron2016*/*/*/*root | wc -l
430

python genjobs.py v40 p1 --do-W-stitching channels_nom_sys_muon_sel_main --dtags data_mu,data_el,MC2016_Summer16_TTJets_powheg,MC2016_Summer16_WZTo3LNu_powheg --submit queue

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small nt=v40 proc=p1 merge_dir=lstore_outdirs/merge-sets/









# final distrs run in v40

put it in the Makefile!

make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="selection_stage==107"  chan="mu_sel"    &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="selection_stage==106"  chan="mu_sel_ss" &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose"    &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1  cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &

make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="selection_stage==117"  chan="el_sel"    dtag=SingleEle &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" dtag=SingleEle &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose"    dtag=SingleEle &
make distrs_data_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v40 p=p1 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" dtag=SingleEle &


just in case just sel in nominal:

make distrs_usual_data_sel
make distrs_usual_nominal_sel


and these are lj and ljout:

make distrs_usual_data_sel    more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel more=" && event_jets_lj_var >  60." suff="_ljout"

make distrs_usual_nominal_sel proc=distrs_mc_common_weights more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_objects        more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights     more=" && event_jets_lj_var >  60." suff="_ljout"

make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_scale  more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_alphas more=" && event_jets_lj_var >  60." suff="_ljout"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_pdf    more=" && event_jets_lj_var >  60." suff="_ljout"


make distrs_usual_data_sel    more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel more=" && event_jets_lj_var >  60." suff="_lj"

make distrs_usual_nominal_sel proc=distrs_mc_common_weights more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_objects        more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights     more=" && event_jets_lj_var >  60." suff="_lj"

make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_scale  more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_alphas more=" && event_jets_lj_var >  60." suff="_lj"
make distrs_usual_nominal_sel proc=distrs_mc_tt_weights_pdf    more=" && event_jets_lj_var >  60." suff="_lj"



leptons have this el/mu difference...

make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj"    &

make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    &


make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj"    &

make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPmu p=p1 nt=v40                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
make distrs_mc_lep_weights   sysname=LEPel p=p1 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss"    &








# test the free parameters in higgsCombine

lrwxrwxrwx 1 olek t3cms 53 Sep 10 10:56 ttxsec/fit-stuff/latest_datacard_mu.txt -> stage2_run3_test_mu_sel_ljs_updowns_rates_weights.txt

fit NLL and impacts

old datacard:

 POI: r= 0.942117 -> [0.5,1.5]


rm latest_datacard_mu.txt
ln -s stage2_run3_test_mu_sel_ljs_updowns_rates_weights_rateParam.txt latest_datacard_mu.txt


new with rateparams
 POI: r= 0.983215 -> [0.5,1.5]

very similar toy impacts, overall uncertainty a bit large, FSR a bit less asymetric


*fit to data shifted FSR to 2 sigmas up*......................!!!




fit to data in electron-tau

lrwxrwxrwx 1 olek t3cms 53 Sep 10 10:56 latest_datacard_el.txt -> stage2_run3_test_el_sel_ljs_updowns_rates_weights.txt

ln -s stage2_run3_test_el_sel_ljs_updowns_rates_weights_rateParam.txt latest_datacard_el.txt


 POI: r= 0.5048 -> [0.5,1.5]
????

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root --algo grid --points 50 --rMin 0.7 --rMax 1.3 --name ElShapes2 --freezeParameters lumi_13TeV

 POI: r= 0.700004 -> [0.7,1.3]

remove the rateParams

tau_fakerate_tt rateParam el_sel_lj    tt_lj       1.0
tau_fakerate_tt rateParam el_sel_lj    tt_taulj    1.0
tau_fakerate_tt rateParam el_sel_lj    tt_other    1.0
tau_fakerate_tt rateParam el_sel_lj    dibosons    1.0
tau_fakerate_tt rateParam el_sel_lj    s_top_lj    1.0
tau_fakerate_tt rateParam el_sel_lj    s_top_other 1.0
tau_fakerate_tt rateParam el_sel_ljout tt_lj       1.0
tau_fakerate_tt rateParam el_sel_ljout tt_taulj    1.0
tau_fakerate_tt rateParam el_sel_ljout tt_other    1.0
tau_fakerate_tt rateParam el_sel_ljout dibosons    1.0
tau_fakerate_tt rateParam el_sel_ljout s_top_lj    1.0
tau_fakerate_tt rateParam el_sel_ljout s_top_other 1.0

tau_fakerate_wjets rateParam el_sel_lj    wjets_taul  1.0
tau_fakerate_wjets rateParam el_sel_lj    wjets_other 1.0
tau_fakerate_wjets rateParam el_sel_ljout wjets_taul  1.0
tau_fakerate_wjets rateParam el_sel_ljout wjets_other 1.0

tau_fakerate_qcd rateParam el_sel_lj    qcd  1.0
tau_fakerate_qcd rateParam el_sel_ljout qcd  1.0

tau group = tauID_eff tau_fakerate_tt tau_fakerate_wjets tau_fakerate_qcd

 POI: r= 1.01968 -> [0.7,1.3]


ok............. fakerates interfere with FSR?

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root --algo grid --points 50 --rMin 0.7 --rMax 1.3 --name ElShapes2 --freezeParameters lumi_13TeV,FSR

 POI: r= 0.7001 -> [0.7,1.3]

then what???

add range 0.5-1.5

 POI: r= 1.01856 -> [0.7,1.3]

-- ok, like removing the rates

and with FSR:

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root --algo grid --points 50 --rMin 0.7 --rMax 1.3 --name ElShapes2 --freezeParameters lumi_13TeV

 POI: r= 1.01914 -> [0.7,1.3]

toy impacts 1+-0.096


to data:
1.02 +- 0.102
and FSR is ok



mu fit with 0.5 range for free params (does it fix the FSR?)

0.95 +- 0.0688
and FSR is constrained and close to +1sigma







# QCD shape in OS and SS

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage==107 || selection_stage==105 || selection_stage==103 || selection_stage== 7 || selection_stage== 5 || selection_stage== 3)"  chan="mu_presel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage==106 || selection_stage==104 || selection_stage==102 || selection_stage== 6 || selection_stage== 4 || selection_stage== 2)"  chan="mu_presel_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage==117 || selection_stage==115 || selection_stage==113 || selection_stage==17 || selection_stage==15 || selection_stage==13)"  chan="el_presel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage==116 || selection_stage==114 || selection_stage==112 || selection_stage==16 || selection_stage==14 || selection_stage==12)"  chan="el_presel_ss" &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage_wjets== 7 )"  chan="mu_wjets" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35                      cond="(selection_stage_wjets== 6 )"  chan="mu_wjets_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage_wjets==17 )"  chan="el_wjets" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=pQCDtest nt=v35 options="--el-procs" cond="(selection_stage_wjets==16 )"  chan="el_wjets_ss" &


foreach dtag ( MC2016_Summer16_QCD_EMEnriched_Pt-120to170 MC2016_Summer16_QCD_EMEnriched_Pt-170to300 MC2016_Summer16_QCD_EMEnriched_Pt-20to30 MC2016_Summer16_QCD_EMEnriched_Pt-300toInf MC2016_Summer16_QCD_EMEnriched_Pt-30to40 MC2016_Summer16_QCD_EMEnriched_Pt-30to50 MC2016_Summer16_QCD_EMEnriched_Pt-30toInf MC2016_Summer16_QCD_EMEnriched_Pt-40toInf MC2016_Summer16_QCD_EMEnriched_Pt-50to80 MC2016_Summer16_QCD_EMEnriched_Pt-80to120 MC2016_Summer16_QCD_HT-100-200 MC2016_Summer16_QCD_HT-1000-1500 MC2016_Summer16_QCD_HT-1500-2000 MC2016_Summer16_QCD_HT-200-300 MC2016_Summer16_QCD_HT-2000-Inf MC2016_Summer16_QCD_HT-300-500 MC2016_Summer16_QCD_HT-50-100 MC2016_Summer16_QCD_HT-500-700 MC2016_Summer16_QCD_HT-700-1000 MC2016_Summer16_QCD_MuEnriched_Pt15_20toInf MC2016_Summer16_QCD_MuEnriched_Pt5_1000toInf MC2016_Summer16_QCD_MuEnriched_Pt5_120to170 MC2016_Summer16_QCD_MuEnriched_Pt5_15to20 MC2016_Summer16_QCD_MuEnriched_Pt5_170to300 MC2016_Summer16_QCD_MuEnriched_Pt5_20to30 MC2016_Summer16_QCD_MuEnriched_Pt5_300to470 MC2016_Summer16_QCD_MuEnriched_Pt5_30to50 MC2016_Summer16_QCD_MuEnriched_Pt5_470to600 MC2016_Summer16_QCD_MuEnriched_Pt5_50to80 MC2016_Summer16_QCD_MuEnriched_Pt5_600to800 MC2016_Summer16_QCD_MuEnriched_Pt5_800to1000 MC2016_Summer16_QCD_MuEnriched_Pt5_80to120 )
hadd distrs/v35pQCDtest_hadds/$dtag.root distrs/v35pQCDtest/*$dtag*
end


hadd distrs_v35pQCDtest_QCD_HT.root v35pQCDtest/MC2016_Summer16_QCD_HT-*
hadd distrs_v35pQCDtest_QCD_EM.root v35pQCDtest/MC2016_Summer16_QCD_EMEnriched_Pt-*
hadd distrs_v35pQCDtest_QCD_Mu.root v35pQCDtest/MC2016_Summer16_QCD_MuEnriched_Pt*

TH1D* h_mu_presel    = (TH1D*) (mu_presel->Get("qcd/NOMINAL/mu_presel_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_mu_presel_ss = (TH1D*) (mu_presel_ss->Get("qcd/NOMINAL/mu_presel_ss_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_presel    = (TH1D*) (el_presel->Get("qcd/NOMINAL/el_presel_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_presel_ss = (TH1D*) (el_presel_ss->Get("qcd/NOMINAL/el_presel_ss_qcd_NOMINAL_Mt_lep_met_f"))


TH1D* h_mu_wjets     = (TH1D*) (mu_wjets->Get("qcd/NOMINAL/mu_wjets_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_mu_wjets_ss  = (TH1D*) (mu_wjets_ss->Get("qcd/NOMINAL/mu_wjets_ss_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_wjets     = (TH1D*) (el_wjets->Get("qcd/NOMINAL/el_wjets_qcd_NOMINAL_Mt_lep_met_f"))
TH1D* h_el_wjets_ss  = (TH1D*) (el_wjets_ss->Get("qcd/NOMINAL/el_wjets_ss_qcd_NOMINAL_Mt_lep_met_f"))


h_mu_presel_ss ->SetLineColor(kRed)
h_el_presel_ss ->SetLineColor(kRed)
h_mu_wjets_ss  ->SetLineColor(kRed)
h_el_wjets_ss  ->SetLineColor(kRed)


h_mu_presel   ->SetXTitle("M_{T} (#mu, E^{miss}_{T}) [GeV]")
h_el_presel   ->SetXTitle("M_{T} (e,   E^{miss}_{T}) [GeV]")
h_mu_wjets    ->SetXTitle("M_{T} (#mu, E^{miss}_{T}) [GeV]")
h_el_wjets    ->SetXTitle("M_{T} (e,   E^{miss}_{T}) [GeV]")

h_mu_presel    ->Draw()
h_mu_presel_ss ->Draw("same")

h_el_presel    ->Draw()
h_el_presel_ss ->Draw("same")

h_mu_wjets     ->Draw()
h_mu_wjets_ss  ->Draw("same")

h_el_wjets     ->Draw()
h_el_wjets_ss  ->Draw("same")


leg = new TLegend(0.6,0.7, 0.9,0.9)
leg->AddEntry(h_mu_presel,    "Opposite Sign", "l")
leg->AddEntry(h_mu_presel_ss, "Same Sign",     "l")

gStyle->SetOptStat(0)

leg->Draw("same")

c1->SaveAs("mt_shapes_os_ss_mu_presel.png")
c1->SaveAs("mt_shapes_os_ss_el_presel.png")

c1->SaveAs("mt_shapes_os_ss_mu_wjets.png")
c1->SaveAs("mt_shapes_os_ss_el_wjets.png")







# hadds per output dir

foreach dtag (`ls lstore_outdirs/v40/u4test/`)
hadd lstore_outdirs/merge-sets/v40/u4test/$dtag.root lstore_outdirs/v40/u4test/$dtag/*.root &
end






# qcd shape cross check in MC

hadd:

foreach dtag (`ls lstore_outdirs/v35/pQCDtest/`)
hadd lstore_outdirs/merge-sets/v35/pQCDtest/$dtag.root lstore_outdirs/v35/pQCDtest/$dtag/*.root
end

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="selection_stage_wjets==7"  chan="wjets_mu"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="selection_stage_wjets==6"  chan="wjets_mu_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="selection_stage_wjets==17" chan="wjets_el"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="selection_stage_wjets==16" chan="wjets_el_ss" &


and presel (2-3 and 12-13 sel without 100):

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="(selection_stage==3  || selection_stage==5  || selection_stage==7  || selection_stage==107 || selection_stage==105 || selection_stage==103)"  chan="mu_sel"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest                      cond="(selection_stage==2  || selection_stage==4  || selection_stage==6  || selection_stage==106 || selection_stage==104 || selection_stage==102)"  chan="mu_sel_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="(selection_stage==13 || selection_stage==15 || selection_stage==17 || selection_stage==117 || selection_stage==115 || selection_stage==113)"  chan="el_sel"    &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ nt=v35 p=pQCDtest options="--el-procs" cond="(selection_stage==12 || selection_stage==14 || selection_stage==16 || selection_stage==116 || selection_stage==114 || selection_stage==112)"  chan="el_sel_ss" &







# NOMINAL dy tautau, selection problem and adding data and systematics

in distrs:
root [3] dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 9818, Total sum= 0.102819
root [6] dy_tautau_sel->Get("tt_lj/NOMINAL/dy_tautau_sel_tt_lj_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_lj_NOMINAL_Mt_lep_met_f, Entries= 10977, Total sum= 0.114189

in merge:
root [3] ttree_out->Draw("event_leptons[0].pt()", "selection_stage_dy==102 || selection_stage_dy==103")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 12610

-- and good distribution of gen_proc_id


--- forgot parenths in distr selection?
--> after the fix everything is better, but still too much WJets and also tt

--- I reran the selection without 3pi & SV Sign cut?
    check in ttrees the geom SV

ttree_out->Draw("event_taus_sv_sign[0]>>h(42, -1, 20)", "selection_stage_dy==102 || selection_stage_dy==103")

-- clear cut at 2.5

ttree_out->Draw("event_taus_sv_sign[0]>>h(40,-20,20)", "selection_stage_dy==102 || selection_stage_dy==103")
-- some taus at -11, i.e. don't have the SV refitted
   it was a run without .hasSecondaryVertex() ? and it somehow interfered

try quick test

-- made sumup_ttree_draw per-xsec-capable and nickname-capable

python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "(selection_stage_dy==102 || selection_stage_dy==103)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root lstore_outdirs/merge-sets/v40/u2/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root



with only madgraph wjets

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "(selection_stage_dy==102 || selection_stage_dy==103)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2/$dtag.root lstore_outdirs/merge-sets/v40/u2/$dtag.root
end

hadd quick-test/foobar_v40u2.root quick-test/v40/u2/MC*root

python stack_quick.py quick-test/foobar_v40u2.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f.root --scale-stack 35800

-- wjets have significant tail.............................................................



## quick test on inputs

old quick test:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 42,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2_inputs/$dtag.root gstore_outdirs/v40/*/Ntupler_v40_$dtag/*/*/MC*root
end

hadd quick-test/foobar_v40u2_inputs.root quick-test/v40/u2_inputs/MC*root

python stack_quick.py quick-test/foobar_v40u2_inputs.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f_inputs.root --scale-stack 35800

INFO:root:import ROOT
DEBUG:root:dy_tautau_sel/ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign
DEBUG:root:ttbar 4801.91458273
DEBUG:root:dy_tautau_sel/wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign
DEBUG:root:wjets 79165.7116547
DEBUG:root:dy_tautau_sel/dibosons/NOMINAL/dy_tautau_sel_dibosons_NOMINAL_geom_tau_sv_sign
DEBUG:root:dibosons 2399.22657406
DEBUG:root:dy_tautau_sel/single_top/NOMINAL/dy_tautau_sel_single_top_NOMINAL_geom_tau_sv_sign
DEBUG:root:single_top 1381.56985289
DEBUG:root:dy_tautau_sel/dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign
DEBUG:root:dy 52192.7615089

-- noticeable tail in wjets
-- is it the same as in v40u2 stage2 output?

try with Mt40

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 42,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u2_inputs_Mt40/$dtag.root gstore_outdirs/v40/*/Ntupler_v40_$dtag/*/*/MC*root &
end

hadd quick-test/foobar_v40u2_inputs_Mt40.root quick-test/v40/u2_inputs_Mt40/MC*root

python stack_quick.py quick-test/foobar_v40u2_inputs_Mt40.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug test_f_inputs_Mt40.root --scale-stack 35800

DEBUG:root:dy_tautau_sel/ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign
DEBUG:root:ttbar 1007.68226349
DEBUG:root:dy_tautau_sel/wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign
DEBUG:root:wjets 15209.1757812
DEBUG:root:dy_tautau_sel/dibosons/NOMINAL/dy_tautau_sel_dibosons_NOMINAL_geom_tau_sv_sign
DEBUG:root:dibosons 547.442466587
DEBUG:root:dy_tautau_sel/single_top/NOMINAL/dy_tautau_sel_single_top_NOMINAL_geom_tau_sv_sign
DEBUG:root:single_top 277.260660708
DEBUG:root:dy_tautau_sel/dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign
DEBUG:root:dy 34797.0296421

-- negligible after 2.5-3 SV Sign

comparing to stage2 output they look completely different: the tail in the stage2 is unreasonable
(a kind of problem which could propagate unnoticed to tt too)

are yields similar?

root [6] dy_tautau_sel->Get("dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 8197, Total sum= 0.971984
root [7] dy_tautau_sel->Get("ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 2724, Total sum= 0.0281475
root [8] dy_tautau_sel->Get("wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 237, Total sum= 0.424837

in stage2 processing:

root [4] dy_tautau_sel->Get("dy/NOMINAL/dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 22311, Total sum= 0.487645
root [5] dy_tautau_sel->Get("ttbar/NOMINAL/dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 12610, Total sum= 0.115728
root [3] dy_tautau_sel->Get("wjets/NOMINAL/dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_tautau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 1017, Total sum= 0.529739

-- what's with total sums?

tau ID cut was vloose


statement of the problem:
* test_f.root is made of stage2 output
  and it has the problem
* test_f_inputs.root and test_f_inputs_Mt40.root
  is from inputs (gstore ntuples)
  and it's fine






## repeate quick test in dy only

(then in tt)

without Mt cut now

don't cut on SV Sign, but save it in ttree

info on differences with quick test:

* 0 bjets, not matched to tau
* stage2 checks dR match quality of tau SV refit
* correct (geom) SV Sign is saved
* tau pt cut 21GeV

quick test was done on all DY, including ext
ls gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/*/MC*root




## re-stage2 in v40 u4test, re-quick-test

make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v40 proc=u4test merge_dir=lstore_outdirs/merge-sets/
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v40 proc=u4test merge_dir=lstore_outdirs/merge-sets/
hadd lstore_outdirs/merge-sets/v40/u4test/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v40/u4test/MC2016_Summer16_TTJets_powheg/*.root
hadd lstore_outdirs/merge-sets/v40/u4test/MC2016_Summer16_WJets_madgraph.root lstore_outdirs/v40/u4test/MC2016_Summer16_WJets_madgraph/*.root


foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )

foreach dtag ( MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "(selection_stage_dy==102 || selection_stage_dy==103)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u4test/$dtag.root lstore_outdirs/merge-sets/v40/u4test/$dtag.root
end

hadd quick-test/foobar_v40u4test.root quick-test/v40/u4test/MC*root

python stack_quick.py quick-test/foobar_v40u4test.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug quick-test/test_f_v40u4test.root --scale-stack 35800

kind of ok
a little too much wjets in the tail
very similar to the quick on all inputs (without Mt cut)


foreach dtag ( MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python sumup_ttree_draw.py "event_taus_sv_sign[0]" --ttree ttree_out --histo-range 42,-1,20 --cond-com "((selection_stage_dy==102 || selection_stage_dy==103) && event_met_lep_mt < 40.)"   --per-weight --try-xsec --std-histo-name geom_tau_sv_sign  --save-weight --histo-name "dy_tautau_sel/dy_all/NOMINAL/dy_tautau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/u4test_Mt40/$dtag.root lstore_outdirs/merge-sets/v40/u4test/$dtag.root
end

hadd quick-test/foobar_v40u4test_Mt40.root quick-test/v40/u4test_Mt40/MC*root

python stack_quick.py quick-test/foobar_v40u4test_Mt40.root --chan dy_tautau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --debug quick-test/test_f_v40u4test_Mt40.root --scale-stack 35800

kind of too much wjets?
-- the same amount of wjets in the tail!
   Mt did not work?

in DY  Mt = 0 or rarely -87.
WJets  Mt = 0
TTJets Mt = 0


--- after the mt fix it's perfect!






# NOMINAL distrs for double ratio test 2

hadd lstore_outdirs/merge-sets/v40/u2/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root lstore_outdirs/v40/u2/*/*root

root [2] ttree_out->Draw("event_taus_sv_sign[0]>>h(21,-1,20)", "selection_stage_dy>100")
(Long64_t) 15737

hadd lstore_outdirs/merge-sets/v40/u2/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v40/u2/MC2016_Summer16_TTJets_powheg/*root


ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
ttree_out->Draw("event_taus_sv_sign[0]>>h(21,-1,20)", "selection_stage_dy>100")

ttree_out->Draw("selection_stage",    "selection_stage==107")
ttree_out->Draw("selection_stage_em", "selection_stage_em==205")
ttree_out->Draw("selection_stage_dy", "selection_stage_dy==102 || selection_stage_dy==103")
ttree_out->Draw("selection_stage_dy_mumu", "selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103")

dy
root [1] ttree_out->Draw("selection_stage",    "selection_stage==107")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 67
root [2] ttree_out->Draw("selection_stage_em", "selection_stage_em==205")
(Long64_t) 26
root [3] ttree_out->Draw("selection_stage_dy", "selection_stage_dy==102 || selection_stage_dy==103")
(Long64_t) 13417
root [4] ttree_out->Draw("selection_stage_dy_mumu", "selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103")
(Long64_t) 12138782


ttbar
root [3] ttree_out->Draw("selection_stage",    "selection_stage==107")
Info in <TCanvas::MakeDefCanvas>:  created default TCanvas with name c1
(Long64_t) 9244
root [4] ttree_out->Draw("selection_stage_em", "selection_stage_em==205")
(Long64_t) 86794
root [5] ttree_out->Draw("selection_stage_dy", "selection_stage_dy==102 || selection_stage_dy==103")
(Long64_t) 12610
root [6] ttree_out->Draw("selection_stage_dy_mumu", "selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103")
(Long64_t) 87954

-- weird (maybe just the 2.5 SV Sign taus)

also forgot Mt < 40 !!!!!!!!!!!!!!!!!!!
-- will see if backgrounds are dead in SV Sign




time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_em==205"  chan="elmu_sel" &

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage_dy==102 || selection_stage_dy==103)"  chan="dy_tautau_sel" &

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103)"  chan="dy_mumu_sel" &


foreach d ( `cat all-dtags` )
hadd distrs/v40u2_hadds/$d.root distrs/v40u2/*$d*root &
end



python stack_plot.py mc_norm/distrs_v40u2_mc_1.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/ --lumi 35800 -c mu_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""

-- 50-70-90(max) events in bins, 478 events in MC overall
   too few events per bin???
   also: same ratio with fakes, a bin with WJets


python stack_plot.py mc_norm/distrs_v40u2_mc_1.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/ --lumi 35800 -c dy_tautau_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""
python stack_plot.py mc_norm/distrs_v40u2_mc_1.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/ --lumi 35800 -c dy_mumu_sel   -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""



time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==107"  chan="mu_sel" dtag=TTJet &

hadd foobar1.root v40u1/1/*TT*heg_mu_sel_tt* &
hadd foobar2.root v40u2/1/*TT*heg_mu_sel_tt* &


---- typo with u1 instead of u2!!!

missing W1Jets
hadd lstore_outdirs/merge-sets//v40/u2/MC2016_Summer16_W1Jets_madgraph.root lstore_outdirs/v40/u2/MC2016_Summer16_W1Jets_madgraph/*root

time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==107"  chan="mu_sel"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage==106"  chan="mu_sel_ss" dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==117"  chan="el_sel"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" dtag=W1Jet &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose"    dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" dtag=W1Jet &


time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_em==205"  chan="elmu_sel"  dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_dy==102 || selection_stage_dy==103"  chan="dy_tautau_sel" dtag=W1Jet &
time make distrs_mc_nominal merge_dir=lstore_outdirs/merge-sets/ p=u2 nt=v40                      cond="selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103"  chan="dy_mumu_sel" dtag=W1Jet &


python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c mu_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

3300 events overall

python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c mu_sel_ss     -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

788.719281
practically pure tt and st, some wjets
need data to check for qcd


python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c elmu_sel      -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

30711.964286
pure tt->other and s-top->other

python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c dy_mumu_sel   -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

16358095.808810
pure DY,
tautau is probably mumu
--> after DY fix:
15497337.752776
and pure DY->mumu

python stack_plot.py mc_norm/distrs_v40u2_mc_2.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root -p -r -o plots/v40u2/2/ --lumi 35800 -c dy_tautau_sel -d Mt_lep_met_f --skip-QCD --no-data --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events" --title ""

116706.923147
-- PROBLEM, it's a rainbow with WJets, tt and DY->other
--> after DY fix:
51568.708471
negligible DY->mumu, but noticeable tt and wjets (with correct contributions from different processes)
including below Mt<40 about third of events is wjets -- where it's not expected, another PROBLEM



1. why DY->other?
2. why wjets? just need Mt<40? how much does it cut?
   --- it won't cut all wjets, like a third of all events will be wjets,
       which is not expected from SV Sign 2.5
3. why each tt process contributes the same amount? and they have the same Mt shape??
   --- checked for mutau and lj, indeed the same shape
       and yields 9800 mutau, 11000 lj

useful distrs:
tau pt
SV Sign




## old results

bin 2-3 -- 350-380 events
    3-4 -- 250
    4-5 -- 150-180




## quick test

dy:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

tt:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 0 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel/tt/NOMINAL/mu_sel_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel_2b/tt/NOMINAL/mu_sel_2b_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_nbjets2.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 2.5 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 0 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel_2sv5/tt/NOMINAL/mu_sel_2sv5_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_2sv5.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && tau_SV_geom_flightLenSign[tau_refited_index[0]] > 2.5 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 1 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel_2sv5_2b/tt/NOMINAL/mu_sel_2sv5_2b_tt_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_2sv5_2b.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &


h = (TH1D*) mu_sel->Get("tt/NOMINAL/mu_sel_tt_NOMINAL_geom_tau_sv_sign")
h->Scale(35800)
h->Print()
TH1.Print Name  = mu_sel_tt_NOMINAL_geom_tau_sv_sign, Entries= 44147, Total sum= 16165


h = (TH1D*) mu_sel_2b->Get("tt/NOMINAL/mu_sel_2b_tt_NOMINAL_geom_tau_sv_sign")
TH1.Print Name  = mu_sel_2b_tt_NOMINAL_geom_tau_sv_sign, Entries= 32778, Total sum= 11945.7

h = (TH1D*) mu_sel_2sv5->Get("tt/NOMINAL/mu_sel_2sv5_tt_NOMINAL_geom_tau_sv_sign")
TH1.Print Name  = mu_sel_2sv5_tt_NOMINAL_geom_tau_sv_sign, Entries= 13670, Total sum= 4582.09

h = (TH1D*) mu_sel_2sv5_2b->Get("tt/NOMINAL/mu_sel_2sv5_2b_tt_NOMINAL_geom_tau_sv_sign")
TH1.Print Name  = mu_sel_2sv5_2b_tt_NOMINAL_geom_tau_sv_sign, Entries= 11366, Total sum= 3808.2



quick test on taus without 3pi

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 21,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets > 0 && lep_id[0]*tau_id[0] < 0"   --per-weight --scale 831.4   --save-weight --histo-name "mu_sel/tt/NOMINAL/mu_sel_tt_NOMINAL_tau_pt" --output quick-test/v40/MC2016_Summer16_TTJets_powheg_tau_pt.root gstore_outdirs/v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/*root &


time python channel_distrs_full_loop.py --do-W-stitching -l logss temp/ channels_nom_sys_muon_sel_main -i /gstore/t3cms/store/user/otoldaie//v40/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v40_MC2016_Summer16_TTJets_powheg/181009_141741/0000/MC2016_Summer16_TTJets_powheg_33.root







# NOMINAL distrs for TT/DY double ratio

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small    nt=v40 proc=u1
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v40 proc=u1
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v40 proc=u1

tt lep-tau (with VLoose too)

time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal p=u1 nt=v40                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal p=u1 nt=v40                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal p=u1 nt=v40 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &


tt elmu
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage_em==205"  chan="elmu_sel" &

dy tautau
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage_dy==102 || selection_stage_dy==103"  chan="dy_tautau_sel" &

dy mumu (mu hlt, no mass requirement)
time make distrs_mc_nominal p=u1 nt=v40                      cond="selection_stage_dy_mumu==102 || selection_stage_dy_mumu==103"  chan="dy_mumu_sel" &



tests:

python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage_dy==102" --distr Mt_lep_met_f --chan dy_tautau_sel --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight merge-sets/v40/u1/*MC*.root

python sumup_ttree_draw.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --custom-range 0,20,40,60,80,100,130,160,200,250 --cond-com "event_weight * (selection_stage_dy==102 && !(gen_proc_id == 1))" --output distrs//test1_lep_pt_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f.root  --histo-name dy_tautau_sel/dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f  --save-weight --per-weight merge-sets/v40/u1/MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root


-- turned off the recoils


foreach d ( `cat all-dtags` )
hadd distrs/v40u1_hadd/$d.root distrs/v40u1/*$d*root &
end

test TT and DY yields in channels, relative to each other

mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
elmu_sel->Get("tt_mutau/NOMINAL/elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu_sel->Get("tt_mutau/NOMINAL/dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()

root [4] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 5929, Total sum= 7.05533e-05
root [5] elmu_sel->Get("tt_mutau/NOMINAL/elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 61, Total sum= 5.98596e-07
root [6] dy_mumu_sel->Get("tt_mutau/NOMINAL/dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [7] dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 2934, Total sum= 3.73507e-05

-- wrong processes in elmu and mumu

mu_sel->Get("dy_other/NOMINAL/mu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
elmu_sel->Get("dy_other/NOMINAL/elmu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu_sel->Get("dy_other/NOMINAL/dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
dy_tautau_sel->Get("dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()

root [2] mu_sel->Get("dy_other/NOMINAL/mu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 1, Total sum= 6.70175e-09
root [3] elmu_sel->Get("dy_other/NOMINAL/elmu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 1, Total sum= 7.12112e-09
root [4] dy_mumu_sel->Get("dy_other/NOMINAL/dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [5] dy_tautau_sel->Get("dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 428, Total sum= 2.78714e-06


mu_sel->Get("dy_tautau/NOMINAL/mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
elmu_sel->Get("dy_tautau/NOMINAL/elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
dy_mumu_sel->Get("dy_tautau/NOMINAL/dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
dy_tautau_sel->Get("dy_tautau/NOMINAL/dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()

root [6] mu_sel->Get("dy_tautau/NOMINAL/mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 64, Total sum= 4.35527e-07
root [7] elmu_sel->Get("dy_tautau/NOMINAL/elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 23, Total sum= 1.56526e-07
root [8] dy_mumu_sel->Get("dy_tautau/NOMINAL/dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [9] dy_tautau_sel->Get("dy_tautau/NOMINAL/dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 10374, Total sum= 6.87678e-05

-- all 0 in dy_mumu
all 0 in ttree_out




-- fixed mumu and redone

root [1] mu_sel->Get("dy_other/NOMINAL/mu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [2] elmu_sel->Get("dy_other/NOMINAL/elmu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 0, Total sum= 0
root [3] dy_mumu_sel->Get("dy_other/NOMINAL/dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 43170, Total sum= 0.000278779
root [4] dy_tautau_sel->Get("dy_other/NOMINAL/dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_other_NOMINAL_Mt_lep_met_f, Entries= 34, Total sum= 2.22026e-07

root [5] mu_sel->Get("dy_tautau/NOMINAL/mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 4, Total sum= 2.90441e-08
root [6] elmu_sel->Get("dy_tautau/NOMINAL/elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 2, Total sum= 1.64038e-08
root [7] dy_mumu_sel->Get("dy_tautau/NOMINAL/dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 337, Total sum= 2.21724e-06
root [8] dy_tautau_sel->Get("dy_tautau/NOMINAL/dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_dy_tautau_NOMINAL_Mt_lep_met_f, Entries= 751, Total sum= 5.00932e-06


root [1] mu_sel->Get("tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 793, Total sum= 9.5598e-06
root [2] elmu_sel->Get("tt_mutau/NOMINAL/elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = elmu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 8, Total sum= 7.71649e-08
root [3] dy_mumu_sel->Get("tt_mutau/NOMINAL/dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_mumu_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 15, Total sum= 1.70171e-07
root [4] dy_tautau_sel->Get("tt_mutau/NOMINAL/dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f")->Print()
TH1.Print Name  = dy_tautau_sel_tt_mutau_NOMINAL_Mt_lep_met_f, Entries= 372, Total sum= 4.63528e-06


-- 700 TT in tt mutau
   700 DY in dy taumutau

too few events?
in DY from the test it was 1k per bin in 3-5sigma bins
in TT it was 100 events per bin


comparing DY to quick tests

root -l quick-test/foobar.root
dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign, Entries= 22476, Total sum= 0.845538

((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->Scale(22476./0.845538)

root [10] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(1)
(Double_t) 2531.66
root [11] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(2)
(Double_t) 9040.16
root [12] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(3)
(Double_t) 3314.38
root [13] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(4)
(Double_t) 2015.38
root [14] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(5)
(Double_t) 1317.67
root [15] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(6)
(Double_t) 913.347
root [16] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(7)
(Double_t) 695.636
root [17] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(0)
(Double_t) 20.7343
root [18] 
root [18] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(8)
(Double_t) 493.477
root [19] ((TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign"))->GetBinContent(9)
(Double_t) 375.291

-- more than 700



root [3] ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
(Long64_t) 1167
root [1] ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
(Long64_t) 15737

and it was 10k in first run!?
did it have tau SV cut? NO and SV sign distr is like TT, 100 events per bin in 3-4-5sigma

quick test selection?

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

-- forgot Mt
also pass_mu has no_iso_veto_leps and lep_relIso[0] < 0.15
dy_tautau definition = any tau + any tau

and n bjets < 2? -- not tau bjets?

ttree_out->Draw("selection_stage_dy", "selection_stage_dy>100")
ttree_out->Draw("event_taus_sv_sign[0]>>h(21,-1,20)", "selection_stage_dy>100")

retest the SV Sign

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all_retest.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 21 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all_retest_tau21pt.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &


dy_mutau_sel->Get("dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign")->Print()
retest
TH1.Print Name  = dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign, Entries= 25229, Total sum= 0.950801

retest_tau21pt
TH1.Print Name  = dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign, Entries= 24364, Total sum= 0.917807

-- forgot 10k limit!!!!!!










# issue with recoil corrections

how did I get them to link in last time?












# More info plots for AN

Mt shape of signal and background
Same Sign selection

file with nominal sel for paper Mt:
jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root

python jobsums/get_shapes.py --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_mutau,NOMINAL tt_mujets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_selVloose -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_mutau,NOMINAL tt_mujets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_selVloose,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_mujets : tt_mutau " -c mu_sel -d Mt_lep_met_f -p tt_lj tt_mutau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_sel,tt_mutau,NOMINAL tt_mujets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:mu_sel,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_sel -d Mt_lep_met_f -p tt_lj tt_eltau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_sel,tt_eltau,NOMINAL tt_eljets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_sel,tt_lj,NOMINAL

python jobsums/get_shapes.py --x-title "M_{T} [GeV]" --norm-binwidth --formula "tt_eljets : tt_eltau " -c el_selVloose -d Mt_lep_met_f -p tt_lj tt_eltau:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_selVloose,tt_eltau,NOMINAL tt_eljets:jobsums/mc_norm/v25v26_pStage2Run3_Run4_Run4Rest_nolj_1.root:el_selVloose,tt_lj,NOMINAL



file from last histosel
distrs_v25pStage2Run3_3_Run4_updowns_weights.root

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 31300 -c el_sel_ljout_ss -x el_selVloose_ljout_ss -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 31300 -c el_sel_lj_ss    -x el_selVloose_lj_ss    -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""


python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root      --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 35800 -c mu_sel_ljout_ss -x mu_selVloose_ljout_ss -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root      --bin-norm  -p -r -o plots/v25pStage2Run3_3_Run4/ --lumi 35800 -c mu_sel_lj_ss    -x mu_selVloose_lj_ss    -d Mt_lep_met_f --skip-QCD --wjet 0.8 --title-x "M_{T} [GeV]" --title-y "events/1GeV" --title ""








# DY -> taue-tauh

compare number of events to mu-tau

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 29. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && (((abs(gen_zdecays_IDs[0]) == 15*11 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*11 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tautau.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 29. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && \!(((abs(gen_zdecays_IDs[0]) == 15*11 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*11 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_other/NOMINAL/dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_other.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

-- very few events, to confirm check the dy->taumu-tauh with el cut

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 29. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && (((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tautau_mutau-w-el-cut.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root








# quick test over full MC

example with Mt and OS:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0"              --save-weight --histo-name "mutau_sel_MT40OS/data/NOMINAL/mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OS_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

with HLT, OS id, without Mt 40

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OS_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &


python selections.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0" --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --out-dir quick-test/test/ gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/*/*root


foreach dtag (`cat merge-sets/jobs_hadd.dtags.small`)
python selections.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0" --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --out-dir quick-test/v40/ gstore_outdirs/v40/*/Ntupler_v40_$dtag*/*/*/*root &
end

-- troubles


quick script:
python per_dtag_script.py

dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()

dy = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->Print()

TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 14927, Total sum= 20195.1

-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1

data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign")
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")

dy->Scale(5765.4)

full run:

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_W1Jets_madgraph MC2016_Summer16_W2Jets_madgraph MC2016_Summer16_W3Jets_madgraph MC2016_Summer16_W4Jets_madgraph MC2016_Summer16_WJets_amcatnlo MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python per_dtag_script.py $dtag &
end

only wjets:

foreach dtag (  MC2016_Summer16_W1Jets_madgraph MC2016_Summer16_W2Jets_madgraph MC2016_Summer16_W3Jets_madgraph MC2016_Summer16_W4Jets_madgraph MC2016_Summer16_WJets_amcatnlo MC2016_Summer16_WJets_madgraph )
python per_dtag_script.py $dtag &
end

only TTbar:

foreach dtag ( MC2016_Summer16_TTJets_powheg )
python per_dtag_script.py $dtag &
end



run on data:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root

hadd foobar.root v40/*.root

dy         = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
single_top = (TH1D*) dy_mutau_sel->Get("single_top/NOMINAL/dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign")
wjets      = (TH1D*) dy_mutau_sel->Get("wjets/NOMINAL/dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign")
dibosons   = (TH1D*) dy_mutau_sel->Get("dibosons/NOMINAL/dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign")
ttbar      = (TH1D*) dy_mutau_sel->Get("ttbar/NOMINAL/dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign")

dy         ->Scale(35800)
single_top ->Scale(35800)
wjets      ->Scale(35800)
dibosons   ->Scale(35800)
ttbar      ->Scale(35800)

dy         ->Print()
single_top ->Print()
wjets      ->Print()
dibosons   ->Print()
ttbar      ->Print()

TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 14988, Total sum= 22045.3
root [11] single_top ->Print()
TH1.Print Name  = dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign, Entries= 9154, Total sum= 1210.31
root [12] wjets      ->Print()
TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 9136, Total sum= 114618
root [13] dibosons   ->Print()
TH1.Print Name  = dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign, Entries= 27178, Total sum= 1756.32
root [3] ttbar      ->Print()
TH1.Print Name  = dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 15578, Total sum= 5786.75


data = (TH1D*) dy_mutau_sel->Get("data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign")
data->Print()

TH1.Print Name  = dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign, Entries= 80894, Total sum= 79490

-- delirious results
amcatnlo wjets need aMCatNLO weight!

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "(aMCatNLO_weight>0.) * (abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0)"    --per-weight   --scale 61526.7         --save-weight --histo-name "dy_mutau_sel/wjets/NOMINAL/dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_WJets_amcatnlo.root gstore_outdirs/v40/*/*MC2016_Summer16_WJets_amcatnlo*/*/0000/*root

TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 6503, Total sum= 81559.5

still too many events, but closer to data

dibosons seem too big





# test refit index

python selections.py "tau_refited_index[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0" --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --out-dir quick-test/test/ gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/*/*root

python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root


python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 100,-5,5 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_2.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root

= -1 and 0 indexes only






# yield with lower cuts

python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 20,-10,10 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_lowcuts.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root

149047 events (37136.0 refit index = 0, others = -1) VS 49273



## geom SV sign distrs in DY and data

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"   --per-weight   --save-weight --histo-name "dy_mutau_sel/dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign" --output quick-test/test/lowcuts_Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_geom_svsign.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"                  --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/test/lowcuts_SingleMuon_geom_svsign.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"                  --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/test/lowcuts_SingleMuon_geom_svsign.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

hadd h_lowcuts.root lowcuts*root

dy   = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
data = (TH1D*) dy_mutau_sel->Get("data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign")
dy->SetLineColor(kRed)
dy->Scale(5765.4 * 35800)
data->Print()
dy->Print()

-- dy lowcuts have 1k at 3-4-5 signmas



## try Mt < 40 and full run on MC

foreach dtag ( MC2016_Summer16_WWTo2L2Nu_powheg MC2016_Summer16_WWToLNuQQ_powheg MC2016_Summer16_WZTo1L1Nu2Q_amcatnlo_madspin MC2016_Summer16_WZTo1L3Nu_amcatnlo_madspin MC2016_Summer16_WZTo2L2Q_amcatnlo_madspin MC2016_Summer16_WZTo3LNu_powheg MC2016_Summer16_ZZTo2L2Nu_powheg MC2016_Summer16_ZZTo2L2Q_amcatnlo_madspin MC2016_Summer16_schannel_4FS_leptonicDecays_amcatnlo MC2016_Summer16_tchannel_antitop_4f_leptonicDecays_powheg MC2016_Summer16_tchannel_top_4f_leptonicDecays_powheg MC2016_Summer16_DYJetsToLL_10to50_amcatnlo MC2016_Summer16_DYJetsToLL_50toInf_madgraph MC2016_Summer16_SingleT_tW_5FS_powheg MC2016_Summer16_SingleTbar_tW_5FS_powheg MC2016_Summer16_WJets_madgraph MC2016_Summer16_TTJets_powheg )
python per_dtag_script.py $dtag &
end

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0"             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root

hadd foobar.root v40/MC*root v40/SingleMuon.root


dy         = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
single_top = (TH1D*) dy_mutau_sel->Get("single_top/NOMINAL/dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign")
wjets      = (TH1D*) dy_mutau_sel->Get("wjets/NOMINAL/dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign")
dibosons   = (TH1D*) dy_mutau_sel->Get("dibosons/NOMINAL/dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign")
ttbar      = (TH1D*) dy_mutau_sel->Get("ttbar/NOMINAL/dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign")

dy         ->Scale(35800)
single_top ->Scale(35800)
wjets      ->Scale(35800)
dibosons   ->Scale(35800)
ttbar      ->Scale(35800)

dy         ->Print()
single_top ->Print()
wjets      ->Print()
dibosons   ->Print()
ttbar      ->Print()

data = (TH1D*) dy_mutau_sel->Get("data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign")
data->Print()

root [11] dy         ->Print()
TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 37306, Total sum= 55273.7
root [12] single_top ->Print()
TH1.Print Name  = dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign, Entries= 12396, Total sum= 1443.25
root [13] wjets      ->Print()
TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 4482, Total sum= 93913.1
root [14] dibosons   ->Print()
TH1.Print Name  = dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign, Entries= 34159, Total sum= 2489.03
root [15] ttbar      ->Print()
TH1.Print Name  = dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 13295, Total sum= 4948.53

root [18] data->Print()
TH1.Print Name  = dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign, Entries= 212683, Total sum= 209320



and with Mt

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."             --save-weight --histo-name "dy_mutau_sel/data/NOMINAL/dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

root [11] dy         ->Print()
TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 25322, Total sum= 36829.1
root [12] single_top ->Print()
TH1.Print Name  = dy_mutau_sel_single_top_NOMINAL_geom_tau_sv_sign, Entries= 2519, Total sum= 288.954
root [13] wjets      ->Print()
TH1.Print Name  = dy_mutau_sel_wjets_NOMINAL_geom_tau_sv_sign, Entries= 811, Total sum= 17017.4
root [14] dibosons   ->Print()
TH1.Print Name  = dy_mutau_sel_dibosons_NOMINAL_geom_tau_sv_sign, Entries= 12990, Total sum= 565.068
root [15] ttbar      ->Print()
TH1.Print Name  = dy_mutau_sel_ttbar_NOMINAL_geom_tau_sv_sign, Entries= 2802, Total sum= 1036.63

root [18] data->Print()
TH1.Print Name  = dy_mutau_sel_data_NOMINAL_geom_tau_sv_sign, Entries= 77254, Total sum= 75717


-- by dy-data distrs seems like this is it


now:
* to stack
* splitting DY in tautau and other


### split DY

only with z_decays the second option does not count now
and only in DY50

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && (((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tautau.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && \!(((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0)"   --per-weight  --scale 5765.4  --save-weight --histo-name "dy_mutau_sel/dy_other/NOMINAL/dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_other.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

dy         = (TH1D*) dy_mutau_sel->Get("dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
dy_tautau  = (TH1D*) dy_mutau_sel->Get("dy_tautau/NOMINAL/dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign")
dy_other   = (TH1D*) dy_mutau_sel->Get("dy_other/NOMINAL/dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign")

dy         ->Print()
dy_tautau  ->Print()
dy_other   ->Print()

add up?

root [5] dy         ->Print()
TH1.Print Name  = dy_mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 25322, Total sum= 1.02875
root [6] dy_tautau  ->Print()
TH1.Print Name  = dy_mutau_sel_dy_tautau_NOMINAL_geom_tau_sv_sign, Entries= 22476, Total sum= 0.000146657
root [7] dy_other   ->Print()
TH1.Print Name  = dy_mutau_sel_dy_other_NOMINAL_geom_tau_sv_sign, Entries= 1455, Total sum= 9.74784e-06

22476 + 1455
23931

-- undefined N_zdecays?

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[tau_refited_index[0]]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && tau_refited_index[0] > -1 && lep_p4[0].pt() > 26. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 20 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] < 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."   --per-weight --scale 5765.4   --save-weight --histo-name "dy_mutau_sel/dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign" --output quick-test/v40/MC2016_Summer16_DYJetsToLL_50toInf_madgraph_all.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root &

dy_all    = (TH1D*) dy_mutau_sel->Get("dy_all/NOMINAL/dy_mutau_sel_dy_all_NOMINAL_geom_tau_sv_sign")



### stack them

python stack_quick.py quick-test/foobar.root --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy --also data test_f.root --scale-stack 35800

python stack_quick.py quick-test/foobar.root --chan dy_mutau_sel --sys NOMINAL --distr geom_tau_sv_sign --stack ttbar,wjets,dibosons,single_top,dy_tautau,dy_other --debug --also data test_f.root --scale-stack 35800











# check the yield in SS DY

python sumup_ttree_draw.py "tau_refited_index[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets < 2 && lep_id[0]*tau_id[0] > 0"             --save-weight --histo-name "dy_mutau_sel/dy/NOMINAL/dy_mutau_sel_dy_NOMINAL_tau_refited_index" --output quick-test/test/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_SS.root gstore_outdirs/v40/*/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph*/*/0000/*root

5461 events VS 49273 in OS













# testing DY MC in tau-tau

in the summer project it had very small number of events
-- redo and compare with old SV Sign plot

python sumup_ttree_distrs.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4" --per-weight --save-weight --histo-name mc_dy_tau_svsign_geom --output mc_dy_tau_svsign_geom.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/Ntupler_v40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph/181009_141955/0000/*root

example:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root



and full runs with propper histo names:

python sumup_ttree_distrs.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

and data:

python sumup_ttree_distrs.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &


dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")







and without HLT requirement:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

-- same factor of 3 crap!

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 11 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "eltau_sel/dy/NOMINAL/eltau_sel_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_el_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 11 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "eltau_sel/data/NOMINAL/eltau_sel_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_el_SingleElectron.root gstore_outdirs/v40/SingleElectron/*/*/0000/*root &












dimuon test of normalization:

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 20,0,200 --cond-com "leps_ID == -13*13 && HLT_mu && (lep_matched_HLT[0] || lep_matched_HLT[1]) && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mumu_sel/dy/NOMINAL/mumu_sel_dy_NOMINAL_geom_tau_sv_sign"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_mumu.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 20,0,200 --cond-com "leps_ID == -13*13 && HLT_mu && (lep_matched_HLT[0] || lep_matched_HLT[1]) && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mumu_sel/data/NOMINAL/mumu_sel_data_NOMINAL_geom_tau_sv_sign" --output SingleMuon_mumu.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

mumu_dy = (TH1D*) mumu_sel->Get("dy/NOMINAL/mumu_sel_dy_NOMINAL_geom_tau_sv_sign")
mumu_data = (TH1D*) mumu_sel->Get("data/NOMINAL/mumu_sel_data_NOMINAL_geom_tau_sv_sign")
mumu_dy->Scale(5765.4 * 35800)
mumu_dy->SetLineColor(kRed)
mumu_data->Draw()
mumu_dy->Draw("same")





hadd test_foobar.root SingleMuon.root SingleMuon_mumu.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_mumu.root SingleMuon_pt.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt.root



mumu ok (MC has more events with smaller pt -- SFs)
mutau -- difference data > MC by factor of 3 over all SV Sign range, why?






python sumup_ttree_distrs.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

python sumup_ttree_distrs.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt")
data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")


-- same factor of 3









## investigation of factor 3

tau-lep dR match?

python sumup_ttree_distrs.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets == 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

from
210961
down to
184479

! renamed sumup_ttree_distrs to sumup_ttree_draw !

OS tau?

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets == 0 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch_os.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

-- down to
146400

still not 1 third


not the 0 tau?

python sumup_ttree_events.py --output foobar_test_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &
python sumup_ttree_events.py --output foobar_test_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


-- in DY mostly all events have only 1 tau

waiting SingleMuon


what if nbjets == 0 is wrong? (the true tau matches to a bjet, in case of mumu it does not happen)

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch_os_nbjets1.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets1.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


TH1.Print Name  = mutau_sel_dy_NOMINAL_tau_pt, Entries= 48841, Total sum= 0.000328438
root [3] mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_pt")->Integral()
root [4]
root [4] 0.000328438 * 5765.4 * 35800
(double) 67790.0

root [2] mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_tau_pt")->Print()
TH1.Print Name  = mutau_sel_data_NOMINAL_tau_pt, Entries= 214744, Total sum= 210495



ok, test of tau IDs

python sumup_ttree_draw.py "tau_IDlev[0] + 10*tau_IDlev[1] + 100*tau_IDlev[2]" --histo-range 1000,0,1000 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_data_NOMINAL_tau_IDlevs" --output foobars3_SingleMuon_tau_IDlevs.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_IDlev[0] + 10*tau_IDlev[1] + 100*tau_IDlev[2]" --histo-range 1000,0,1000 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 2 && tau_id[0] * lep_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_IDlevs"     --output foobars3_MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tau_IDlevs.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &



another wain atempt with bjets == 0

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 1 && tau_id[0] * lep_id[0] < 0"              --save-weight --histo-name "mutau_sel/data/NOMINAL/mutau_sel_b0_data_NOMINAL_tau_pt" --output SingleMuon_pt_lepmatch_os_nbjets0.root                                  gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_p4[0].pt()" --histo-range 20,0,100 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && \!tau_matching_lep[0] && nbjets < 1 && tau_id[0] * lep_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel/dy/NOMINAL/mutau_sel_b0_dy_NOMINAL_tau_pt"     --output MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets0.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

-- about 1.4 less events than with nbjets < 2
in both data and dy


hadd foobar3_test.root   foobars3_*.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets1.root SingleMuon_pt_lepmatch_os_nbjets1.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets0.root SingleMuon_pt_lepmatch_os_nbjets0.root

hadd foobar3_test.root SingleMuon_pt_lepmatch_os_nbjets0.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets0.root SingleMuon_tau_IDlevs.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_tau_IDlevs.root SingleMuon_pt_lepmatch_os_nbjets1.root MC2016_Summer16_DYJetsToLL_50toInf_madgraph_pt_lepmatch_os_nbjets1.root


dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_tau_IDlevs")
data = (TH1D*) mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_tau_IDlevs")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")




## even more properly done full event scan

with corrected index into SV
and b-jet dR matching

python sumup_ttree_events.py --save-weight              --output foobar_test2_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &
python sumup_ttree_events.py --save-weight --per-weight --output foobar_test2_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


-- but could be even more precise!
now all jets are matched to tau and skipped if they are dR < 0.4,
in principle it's better to have only 1 the best matched to tau and skipped
it's an edge case

by tau pt
220659   data and
 72000.8 dy

by sv sign
73016   data
18946.8 dy



## All DY events

all events are recorded
the BR on gen level are ok

no gen_N_zdecays > 0 events (?????)

((TTree*) ntupler->Get("reduced_ttree"))->GetEntries()

HLTs

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*11) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*11)")

-- % passing HLT:

1.87% in mumu
0.1 % in taumu+tauh
0.05% in taumu+tauel

HLT el

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 11 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 11")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*11 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*11 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "(abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*11) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*11)")

h = (TH1D*) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())

h->GetBinContent(1)
h->GetBinContent(2)

0.9%  elel eff
0.04% in tauel+tauh
0.05% in taumu+tauel (differen events trigger el and mu trig)



events with some reco taus:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_IDlev[0] > 1")


((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]:tau_IDlev[3]", "tau_IDlev[0] > 2 && tau_p4[0].pt() > 30. && abs(tau_p4[0].eta()) < 2.4 && !tau_matching_lep[0] && abs(leps_ID) == 13")

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_p4[0].pt():tau_p4[0].eta():tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]:tau_IDlev[3]:gen_pythia8_prompt_leptons_IDs[0]:gen_pythia8_prompt_leptons_IDs[1]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_IDlev[0] > 0")


how many gen tauh get ID?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15))")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_IDlev[0] > 0")

from
7563
id at 0
61

0.00806558

among mumu?

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13 && tau_IDlev[0] > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_pythia8_prompt_leptons_IDs[0]) == 13 && abs(gen_pythia8_prompt_leptons_IDs[1]) == 13 && tau_IDlev[0] > 0 && !tau_matching_lep[0]")

from
34428
id
124
and
124

0.00360172

incredible numbers
fake rate in DY is 0.5 of true taus


too few tau ID in true taus
scan tau IDs

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15))")

-- no "high tau ID on last indices"
mostly empty, and
*    53120 *         1 *           *           *
sometimes
*    53586 *         3 *         1 *         0 *
*    55726 *         4 *           *           *
*    55754 *           *           *           *
*    55760 *         0 *           *           *

*    58588 *         5 *           *           *

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15)) && tau_p4[0].pt() > 25")

mostly ID = 0




### issue with merged genparticle producer?

%MSG
%MSG-w MergedGenParticleProducer:  MergedGenParticleProducer:mergedGenParticles  12-Oct-2018 12:33:54 CEST Run: 1 Event: 4251447
Found multiple packed matches for: 13	22	4.97106e-09	-2.89792

-- check on first 1000 events: are all 1000 events recorded? does it cause some missing events?

-- tested on 10k events, all 10k are recorded
(empty ones? will see in full file record)




### OldDMs?

recompile ntupler with OldDMs for tau decay mode finding

and scan this:

((TTree*) ntupler->Get("reduced_ttree"))->Scan("tau_IDlev[0]:tau_IDlev[1]:tau_IDlev[2]", "((abs(gen_pythia8_prompt_leptons_IDs[0]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[1]) >15*15) || (abs(gen_pythia8_prompt_leptons_IDs[1]) == 15*13 && abs(gen_pythia8_prompt_leptons_IDs[0]) >15*15))")

pat::Tau: the ID decayModeFindingOldDMs can't be found in this pat::Tau.
The available IDs are:
'againstElectronLooseMVA6'
'againstElectronMVA6Raw'
'againstElectronMVA6category'
'againstElectronMediumMVA6'
'againstElectronTightMVA6'
'againstElectronVLooseMVA6'
'againstElectronVTightMVA6'
'againstMuonLoose3'
'againstMuonTight3'
'byCombinedIsolationDeltaBetaCorrRaw3Hits'
'byIsolationMVArun2v1DBdR03oldDMwLTraw'
'byIsolationMVArun2v1DBnewDMwLTraw'
'byIsolationMVArun2v1DBoldDMwLTraw'
'byIsolationMVArun2v1PWdR03oldDMwLTraw'
'byIsolationMVArun2v1PWnewDMwLTraw'
'byIsolationMVArun2v1PWoldDMwLTraw'
'byLooseCombinedIsolationDeltaBetaCorr3Hits'
'byLooseIsolationMVArun2v1DBdR03oldDMwLT'
'byLooseIsolationMVArun2v1DBnewDMwLT'
'byLooseIsolationMVArun2v1DBoldDMwLT'
'byLooseIsolationMVArun2v1PWdR03oldDMwLT'
'byLooseIsolationMVArun2v1PWnewDMwLT'
'byLooseIsolationMVArun2v1PWoldDMwLT'
'byMediumCombinedIsolationDeltaBetaCorr3Hits'
'byMediumIsolationMVArun2v1DBdR03oldDMwLT'
'byMediumIsolationMVArun2v1DBnewDMwLT'
'byMediumIsolationMVArun2v1DBoldDMwLT'
'byMediumIsolationMVArun2v1PWdR03oldDMwLT'
'byMediumIsolationMVArun2v1PWnewDMwLT'
'byMediumIsolationMVArun2v1PWoldDMwLT'
'byPhotonPtSumOutsideSignalCone'
'byTightCombinedIsolationDeltaBetaCorr3Hits'
'byTightIsolationMVArun2v1DBdR03oldDMwLT'
'byTightIsolationMVArun2v1DBnewDMwLT'
'byTightIsolationMVArun2v1DBoldDMwLT'
'byTightIsolationMVArun2v1PWdR03oldDMwLT'
'byTightIsolationMVArun2v1PWnewDMwLT'
'byTightIsolationMVArun2v1PWoldDMwLT'
'byVLooseIsolationMVArun2v1DBdR03oldDMwLT'
'byVLooseIsolationMVArun2v1DBnewDMwLT'
'byVLooseIsolationMVArun2v1DBoldDMwLT'
'byVLooseIsolationMVArun2v1PWdR03oldDMwLT'
'byVLooseIsolationMVArun2v1PWnewDMwLT'
'byVLooseIsolationMVArun2v1PWoldDMwLT'
'byVTightIsolationMVArun2v1DBdR03oldDMwLT'
'byVTightIsolationMVArun2v1DBnewDMwLT'
'byVTightIsolationMVArun2v1DBoldDMwLT'
'byVTightIsolationMVArun2v1PWdR03oldDMwLT'
'byVTightIsolationMVArun2v1PWnewDMwLT'
'byVTightIsolationMVArun2v1PWoldDMwLT'
'byVVTightIsolationMVArun2v1DBdR03oldDMwLT'
'byVVTightIsolationMVArun2v1DBnewDMwLT'
'byVVTightIsolationMVArun2v1DBoldDMwLT'
'byVVTightIsolationMVArun2v1PWdR03oldDMwLT'
'byVVTightIsolationMVArun2v1PWnewDMwLT'
'byVVTightIsolationMVArun2v1PWoldDMwLT'
'chargedIsoPtSum'
'chargedIsoPtSumdR03'
'decayModeFinding'
'decayModeFindingNewDMs'
'footprintCorrection'
'footprintCorrectiondR03'
'neutralIsoPtSum'
'neutralIsoPtSumWeight'
'neutralIsoPtSumWeightdR03'
'neutralIsoPtSumdR03'
'photonPtSumOutsideSignalCone'
'photonPtSumOutsideSignalConedR03'
'puCorrPtSum'











### full new file

trigger efficiencies

((TTree*) ntupler->Get("reduced_ttree"))->GetEntries()

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "gen_N_zdecays == 0")

125498
7991

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 11 && abs(gen_zdecays_IDs[1]) == 11 && gen_N_zdecays > 0")

41760
41810

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) > 15 && abs(gen_zdecays_IDs[1]) > 15 && gen_N_zdecays > 0")

41928

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

(Long64_t) 9337
root [12] 9337. / 41928
(double) 0.222691

h = (TH1D*) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())

h->GetBinContent(1)
h->GetBinContent(2)

mumu
15814.0
25946.0

taumu tauh

8526.00
 811.000


electron

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_zdecays_IDs[0]) == 11 && abs(gen_zdecays_IDs[1]) == 11 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "((abs(gen_zdecays_IDs[0]) == 15*11 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*11 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")


muon HLT efficiency
mumu       0.62
taumu tauh 0.086 -> 1 - (1-0.086)^2 = 0.166

electron HLT
elel       0.47
tauel tauh 0.044 -> 1 - (1-0.044)^2 = 0.086


-- the efficiency equations don't hold!
the taumu kinematics is different from just mu but not this much!



### trigger efficiencies in TT

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13")

983

root [5] h->GetBinContent(1)
(Double_t) 512.000
root [6] h->GetBinContent(2)
(Double_t) 471.000

root [11] 471.000 / 983
(double) 0.479145

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_el", "abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 11")

1008

root [9] h->GetBinContent(1)
(Double_t) 297.000
root [10] h->GetBinContent(2)
(Double_t) 711.000

root [12] 711.000 / 1008
(double) 0.705357

root [13] 1 - (1 - 0.479145)*(1 - 0.479145)
(double) 0.728710



### reco efficiencies and kinematics of the lepton

((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 11 && abs(gen_zdecays_IDs[1]) == 11 && gen_N_zdecays > 0")

in mumu:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && abs(leps_ID) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("HLT_mu", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && leps_ID == -13*13")

-- compare lep pt

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && abs(leps_ID) == 13")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && leps_ID == -13*13")

h = (TH1D *) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())



lep IDs in tautau:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)",   "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)",   "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("abs(leps_ID)",   "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 13")



((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].pt()>>h(20,0,200)", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 13")

h_tautau_pt = (TH1D *) (((TTree*) ntupler->Get("reduced_ttree"))->GetHistogram())

etas:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(20,-2.5,2.5)", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0 && abs(leps_ID) == 13")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("lep_p4[0].eta()>>h(50,-2.5,2.5)", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0 && abs(leps_ID) == 13")





### test with Mt < 40.


python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40."              --save-weight --histo-name "mutau_sel_MT40/data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

mutau_sel_MT40->Get("data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign")->Print()
15.2k now

w.o. MT40:
mutau_sel->Get("data/NOMINAL/mutau_sel_data_NOMINAL_geom_tau_sv_sign")->Print()
44.2k

examples:

data = (TH1D*) mutau_sel_MT40->Get("data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign")

dy = (TH1D*) mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")


test on DY:

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 20,0,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40." --per-weight --save-weight --histo-name "mutau_sel_MT40/dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_Mt40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root

mutau_sel_MT40->Get("dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign")->Print()
Entries= 5338, Total sum= 2.66933e-05

mutau_sel->Get("dy/NOMINAL/mutau_sel_dy_NOMINAL_geom_tau_sv_sign")->Print()
TH1.Print Name  = mutau_sel_dy_NOMINAL_geom_tau_sv_sign, Entries= 8621, Total sum= 4.23872e-05

dy = (TH1D*) mutau_sel_MT40->Get("dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->Print()
TH1.Print Name  = mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign, Entries= 5338, Total sum= 5509.52

-- again 1/3 of 14k of data

hadd foobarNOHLT_Mt40.root foobarNOHLT_Mt40_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root foobarNOHLT_Mt40_SingleMuon.root

data = (TH1D*) mutau_sel_MT40->Get("data/NOMINAL/mutau_sel_MT40_data_NOMINAL_geom_tau_sv_sign")
dy = (TH1D*) mutau_sel_MT40->Get("dy/NOMINAL/mutau_sel_MT40_dy_NOMINAL_geom_tau_sv_sign")
dy->Scale(5765.4 * 35800)
dy->Print()
dy->SetLineColor(kRed)
data->Draw()
dy->Draw("same")

-- maybe closer in tail
much less events than in Strasbourg result:
1) there 1k events was at 3-4sigma
2) here 1k is at 1sigma, 3-4 have 100 events -- in both data and DY




include OS

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0"              --save-weight --histo-name "mutau_sel_MT40OS/data/NOMINAL/mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OS_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0" --per-weight --save-weight --histo-name "mutau_sel_MT40OS/dy/NOMINAL/mutau_sel_MT40OS_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_Mt40OS_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &


include OS and HLT

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0 && HLT_mu && lep_matched_HLT[0]"              --save-weight --histo-name "mutau_sel_MT40OSHLT/data/NOMINAL/mutau_sel_MT40OSHLT_data_NOMINAL_geom_tau_sv_sign" --output foobarNOHLT_Mt40OSHLT_SingleMuon.root gstore_outdirs/v40/SingleMuon/*/*/0000/*root &

python sumup_ttree_draw.py "tau_SV_geom_flightLenSign[0]" --histo-range 21,-1,20 --cond-com "abs(leps_ID) == 13 && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && nbjets == 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) < 40. && lep_id[0]*tau_id[0] < 0 && HLT_mu && lep_matched_HLT[0]" --per-weight --save-weight --histo-name "mutau_sel_MT40OSHLT/dy/NOMINAL/mutau_sel_MT40OSHLT_dy_NOMINAL_geom_tau_sv_sign"     --output foobarNOHLT_Mt40OSHLT_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root gstore_outdirs/v40/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/*/*/0000/*root &

hadd foobarNOHLT_Mt40_OS_HLT.root foobarNOHLT_Mt40OS_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root foobarNOHLT_Mt40OS_SingleMuon.root foobarNOHLT_Mt40OSHLT_MC2016_Summer16_DYJetsToLL_50toInf_madgraph.root foobarNOHLT_Mt40OSHLT_SingleMuon.root

data_os = (TH1D*) mutau_sel_MT40OS->Get("data/NOMINAL/mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign")
dy_os   = (TH1D*) mutau_sel_MT40OS->Get("dy/NOMINAL/mutau_sel_MT40OS_dy_NOMINAL_geom_tau_sv_sign")
dy_os->Scale(5765.4 * 35800)
dy_os->Print()
data_os->Print()
dy_os->SetLineColor(kRed)
data_os->Draw()
dy_os->Draw("same")

TH1.Print Name  = mutau_sel_MT40OS_dy_NOMINAL_geom_tau_sv_sign, Entries= 4817, Total sum= 6664.21
TH1.Print Name  = mutau_sel_MT40OS_data_NOMINAL_geom_tau_sv_sign, Entries= 16560, Total sum= 16440

data_os_hlt = (TH1D*) mutau_sel_MT40OSHLT->Get("data/NOMINAL/mutau_sel_MT40OSHLT_data_NOMINAL_geom_tau_sv_sign")
dy_os_hlt   = (TH1D*) mutau_sel_MT40OSHLT->Get("dy/NOMINAL/mutau_sel_MT40OSHLT_dy_NOMINAL_geom_tau_sv_sign")
dy_os_hlt->Scale(5765.4 * 35800)
dy_os_hlt->Print()
data_os_hlt->Print()
dy_os_hlt->SetLineColor(kRed)
data_os_hlt->Draw()
dy_os_hlt->Draw("same")

TH1.Print Name  = mutau_sel_MT40OSHLT_dy_NOMINAL_geom_tau_sv_sign, Entries= 4806, Total sum= 6648.85
TH1.Print Name  = mutau_sel_MT40OSHLT_data_NOMINAL_geom_tau_sv_sign, Entries= 16546, Total sum= 16426




### checking gen lepton pt

with gen2_leptons_p4

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen2_leptons_p4[0].pt():gen2_leptons_p4[1].pt():gen2_leptons_p4[2].pt()", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- most of events don't have the lepton
others have only 1 as should be

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen2_leptons_p4[0].pt():gen2_leptons_p4[1].pt():gen2_leptons_p4[2].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")

-- mostly 2 or 1 lepton, sometimes none

?????????????????????????????????????????????????

gen_final_p4 gen_final_pdgId gen_final_chainId gen_final_ndaughters

gen_final_pdgId[0]:gen_final_pdgId[1]:gen_final_pdgId[2]:gen_final_pdgId[3]:gen_final_pdgId[4]
gen_final_chainId[0]:gen_final_chainId[1]:gen_final_chainId[2]:gen_final_chainId[3]:gen_final_chainId[4]
gen_final_ndaughters[0]:gen_final_ndaughters[1]:gen_final_ndaughters[2]:gen_final_ndaughters[3]:gen_final_ndaughters[4]

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_ndaughters[0]:gen_final_ndaughters[1]:gen_final_ndaughters[2]:gen_final_ndaughters[3]:gen_final_ndaughters[4]", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")

-- all 0 daughters, muons and photos are from chainID 23 (Z), pdgID = muons, photons and protons

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_ndaughters[0]:gen_final_ndaughters[1]:gen_final_ndaughters[2]:gen_final_ndaughters[3]:gen_final_ndaughters[4]", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- all 0

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_pdgId[0]:gen_final_pdgId[1]:gen_final_pdgId[2]:gen_final_pdgId[3]:gen_final_pdgId[4]:gen_final_pdgId[5]:gen_final_pdgId[6]:gen_final_pdgId[7]:gen_final_pdgId[8]", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_chainId[0]:gen_final_chainId[1]:gen_final_chainId[2]:gen_final_chainId[3]:gen_final_chainId[4]:gen_final_chainId[5]:gen_final_chainId[6]:gen_final_chainId[7]:gen_final_chainId[8]", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- protons and tau products in final state, tau products are from 23 (Z)

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_p4[0].pt():gen_final_p4[1].pt():gen_final_p4[2].pt():gen_final_p4[3].pt():gen_final_p4[4].pt():gen_final_p4[5].pt():gen_final_p4[6].pt():gen_final_p4[7].pt():gen_final_p4[8].pt()", "((abs(gen_zdecays_IDs[0]) == 15*13 && abs(gen_zdecays_IDs[1]) > 15*15) || (abs(gen_zdecays_IDs[1]) == 15*13 && abs(gen_zdecays_IDs[0]) > 15*15)) && gen_N_zdecays > 0")

-- out of first 11 tau-muons only 2 pass 22GeV cut and only 1 passes 24 GeV (one is barely above 22, another one is 25)

in mumu

((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_p4[0].pt():gen_final_p4[1].pt():gen_final_p4[2].pt():gen_final_p4[3].pt():gen_final_p4[4].pt():gen_final_p4[5].pt():gen_final_p4[6].pt():gen_final_p4[7].pt():gen_final_p4[8].pt()", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")
((TTree*) ntupler->Get("reduced_ttree"))->Scan("gen_final_pdgId[0]:gen_final_pdgId[1]:gen_final_pdgId[2]:gen_final_pdgId[3]:gen_final_pdgId[4]:gen_final_pdgId[5]:gen_final_pdgId[6]:gen_final_pdgId[7]:gen_final_pdgId[8]", "abs(gen_zdecays_IDs[0]) == 13 && abs(gen_zdecays_IDs[1]) == 13 && gen_N_zdecays > 0")

-- easily above 30GeV










# testing the tau momenta in MC at gen level: orig -> vis + invis

((TTree*) ntupler->Get("reduced_ttree"))->Draw("(gen_tt_tau_vis_p4[lep_matching_gen_collection[0]] + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]]).pt()", "lep_matching_gen_collection[0]>-1")

-- the sum does not work in the root interpreter
try separate components:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].X() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].X() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].X())", "lep_matching_gen_collection[0]>-1")

= 1



((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].Y() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].Y() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].Y())", "lep_matching_gen_collection[0]>-1")

= 1 mostly, three entries at 0.625, 0.96 and 0.99
(neutrino-neutrino chains in gen level?)

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].Z() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].Z() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].Z())", "lep_matching_gen_collection[0]>-1")

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[lep_matching_gen_collection[0]].T() / (gen_tt_tau_vis_p4[lep_matching_gen_collection[0]].T() + gen_tt_tau_invis_p4[lep_matching_gen_collection[0]].T())", "lep_matching_gen_collection[0]>-1")


hadronic taus:

((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].X() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].X() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].X())", "tau_matching_gen_collection[0]>-1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].Y() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].Y() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].Y())", "tau_matching_gen_collection[0]>-1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].Z() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].Z() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].Z())", "tau_matching_gen_collection[0]>-1")
((TTree*) ntupler->Get("reduced_ttree"))->Draw("gen_tt_tau_orig_p4[tau_matching_gen_collection[0]].T() / (gen_tt_tau_vis_p4[tau_matching_gen_collection[0]].T() + gen_tt_tau_invis_p4[tau_matching_gen_collection[0]].T())", "tau_matching_gen_collection[0]>-1")

= 1 +- 0.004


ok, run on grid and check later




submit on tt and dy:

/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM
/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext1-v2/MINIAODSIM
/DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext2-v1/MINIAODSIM












# enriched

## mu enriched qcd

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2MuEnriched  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat merge-sets/jobs_hadd.dtags.qcd-mu-enriched` )
hadd distrs/$d.root distrs/v35pStage2MuEnriched/*$d*root &
end


TH1D* h_mu    = (TH1D*) alliso_mu_sel   ->Get("qcd/NOMINAL/alliso_mu_sel_qcd_NOMINAL_relIso")
TH1D* h_mu_ss = (TH1D*) alliso_mu_sel_ss->Get("qcd/NOMINAL/alliso_mu_sel_ss_qcd_NOMINAL_relIso")
h_mu->Divide(h_mu_ss)
h_mu->Draw()

TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")
h_el->Divide(h_el_ss)
h_el->Draw()






## EM Enriched QCD test

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &


time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5"  nt=v35 p=pStage2EMEnriched  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat merge-sets/jobs_hadd.dtags.qcd-em-enriched` )
hadd distrs/$d.root distrs/v35pStage2EMEnriched/*$d*root &
end


TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")
h_el->Divide(h_el_ss)
h_el->Draw()


-- file by file is kind of flat indeed

hadd antiiso_emenriched_v35pStage2EMEnriched.root v35pStage2EMEnriched/MC*
hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-20to30.root MC2016_Summer16_QCD_EMEnriched_Pt-30to50.root MC2016_Summer16_QCD_EMEnriched_Pt-50to80.root MC2016_Summer16_QCD_EMEnriched_Pt-80to120.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root

hadd antiiso_double_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-30toInf.root MC2016_Summer16_QCD_EMEnriched_Pt-40toInf.root MC2016_Summer16_QCD_EMEnriched_Pt-30to40.root

hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-20to30.root MC2016_Summer16_QCD_EMEnriched_Pt-30to50.root MC2016_Summer16_QCD_EMEnriched_Pt-50to80.root MC2016_Summer16_QCD_EMEnriched_Pt-80to120.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root

w.o. 80to120

hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-20to30.root MC2016_Summer16_QCD_EMEnriched_Pt-30to50.root MC2016_Summer16_QCD_EMEnriched_Pt-50to80.root  MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root

hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root MC2016_Summer16_QCD_EMEnriched_Pt-300toInf.root
hadd antiiso_emenriched_v35pStage2EMEnriched.root MC2016_Summer16_QCD_EMEnriched_Pt-120to170.root MC2016_Summer16_QCD_EMEnriched_Pt-170to300.root



 xsec: 557600000, eff: 0.0096, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-20to30        
 xsec: 136000000, eff: 0.073, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30to50         
 xsec: 136000000, eff: 0.073, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30to50_ext1   
 xsec: 19800000,  eff: 0.146, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-50to80        
 xsec: 19800000,  eff: 0.146, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-50to80_ext1   
 xsec: 2800000,   eff: 0.151, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-80to120        
 xsec: 2800000,   eff: 0.151, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-80to120_ext1  
 xsec: 477000,    eff: 0.162, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-120to170      
 xsec: 477000,    eff: 0.162, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-120to170_ext1 
 xsec: 114000,    eff: 0.165, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-170to300      
 xsec: 9000,      eff: 0.15, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-300toInf      
 xsec: 162060000, eff: 0.0016, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30toInf       
 xsec: 108000000, eff: 0.000225, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-30to40        
 xsec: 54120000,  eff: 0.002, dtag: MC2016_Summer16_QCD_EMEnriched_Pt-40toInf       










# NOMINAL Mt for paper

mc rest:

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &



mc tt:

time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107"  chan="mu_sel" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106"  chan="mu_sel_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117"  chan="el_sel" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116"  chan="el_sel_ss" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105)"  chan="mu_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104)"  chan="mu_selVloose_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115)"  chan="el_selVloose" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114)"  chan="el_selVloose_ss" &


data (old selection stages):

time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==105"  chan="mu_sel"    &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==104"  chan="mu_sel_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage==105 || selection_stage==103)"  chan="mu_selVloose"    &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage==104 || selection_stage==102)"  chan="mu_selVloose_ss" &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==115"  chan="el_sel"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==114"  chan="el_sel_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage==115 || selection_stage==113)"  chan="el_selVloose"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage==114 || selection_stage==112)"  chan="el_selVloose_ss" dtag=SingleEle &


foreach d ( `cat all-dtags` )
hadd distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/$d.root distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj/*$d*root &
end


hadd v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root     v25v26_pStage2Run3_Run4_Run4Rest_nolj/*SingleMuon* &
hadd v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleElectron.root v25v26_pStage2Run3_Run4_Run4Rest_nolj/*SingleElectron* &


python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleElectron.root -p -r -o plots/run4/nolj/ --lumi 31300 -c el_sel -x el_selVloose -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm

python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root     -p -r -o plots/run4/nolj/ --lumi 35800 -c mu_sel -x mu_selVloose -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm


python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleMuon.root     -p -r -o plots/run4/ --lumi 35800 -c mu_sel    -x mu_selVloose    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(#mu, MET), GeV" --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py v25v26_pStage2Run3_Run4_Run4Rest_nolj.root ../distrs/v25v26_pStage2Run3_Run4_Run4Rest_nolj_hadds/SingleElectron.root -p -r -o plots/run4/ --lumi 31300 -c el_sel    -x el_selVloose    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(e, MET), GeV"   --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02








#

$\tauh$ jet identification &  5.3 &  5.3 &  5.3 \\
         jet energy scale  &  3.8 &  2.9 &  3.6 \\
pileup                     &  3.1 &  2.5 &  2.2 \\
     b-tagging efficiency  &  2.1 &  2.3 &  2.2 \\
$\tauh$ misidentification background  &  3.2 &  2.9 &  1.5 \\
    jet energy resolution  &  2.1 &  0.6 &  1.2 \\
   electron ID efficiency  &  3.8 & -     &  1.1 \\
 single top normalization  &  0.7 &  0.9 &  0.7 \\
$\tauh$ energy scale       &  0.8 &  0.6 &  0.5 \\
       muon ID efficiency  &   -   &  0.7 &  0.5 \\
        QCD normalization  &  1.9 &  1.0 &  0.5 \\
         DY normalization  &  0.3 &  0.0 &  0.4 \\
   dibosons normalization  &  0.0 &  0.1 &  0.0 \\
     W+jets normalization  &  0.0 &  0.4 &  0.0 \\
luminosity                     &       2.5         &       2.5     &   2.5\\
%
\hline
%
\multicolumn{1}{l}\textit{Theoretical uncertainties:} & \\
top quark \pt modeling     &  3.1 &  4.3 &  3.4 \\
          b fragmentation  &  3.2 &  2.0 &  2.5 \\
    Final State Radiation  &  2.6 &  2.0 &  1.5 \\
  Initial State Radiation  &  1.7 &  1.7 &  1.3 \\
   ME-PS matching (hdamp)  &  0.6 &  0.2 &  0.7 \\
 ME Renormalization scale  &  0.7 &  1.4 &  0.8 \\
ME combined scale variation  &  0.3 &  0.7 &  0.5 \\
   ME Factorization scale  &  0.5 &  0.7 &  0.4 \\
Underlying event (Pythia tune)  &  0.5 &  0.7 &  0.3 \\
b decay tables, Semileptonic BR  &  0.6 &  0.3 &  0.3 \\
PDF                             &  1.9 &  1.6 &  1.5 \\
MC statistics                   &  3.7 &  2.5 &  2.2 \\
\hline
\hline

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

                                 process &  el_sel_lj & el_sel_ljout &  mu_sel_lj & mu_sel_ljout \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $      5090 \pm        115 $ & $      7867 \pm        142 $ \\
$\ttbar\rightarrow{\ell\tau}\nu\nu b\bar{b}$ ($\ell=e,\mu$) & $      2962 \pm         87 $ & $      4624 \pm        110 $ \\
$\ttbar\rightarrow{\tau_{\ell}\tau_{h} \nu\nu b\bar{b} }$ & $       168 \pm         19 $ & $       276 \pm         25 $ & $       325 \pm         26 $ & $       514 \pm         34 $ \\
$\ttbar\rightarrow{\ell\nu jj b\bar{b}}$ & $      2184 \pm         42 $ & $      1433 \pm         34 $ & $      3730 \pm         56 $ & $      2509 \pm         45 $ \\
$\ttbar\rightarrow{\tau_{\ell}\nu jj b\bar{b}}$ & $       116 \pm          8 $ & $        75 \pm          7 $ & $       238 \pm         12 $ & $       160 \pm         10 $ \\
          $\ttbar\rightarrow{\rm other}$ & $        59 \pm          9 $ & $        98 \pm         11 $ & $       103 \pm         12 $ & $       179 \pm         15 $ \\
$\text{single top}\rightarrow{{\rm \ell} \tau}+X$ & $       150 \pm         14 $ & $       270 \pm         19 $ \\
$\text{single top}\rightarrow{{\rm \ell} \tau}+X$ & $       230 \pm         17 $ & $       446 \pm         25 $ \\
$\text{single top}\rightarrow{\rm other}$ & $        20 \pm          3 $ & $        31 \pm          5 $ & $        40 \pm          5 $ & $        61 \pm          7 $ \\
$\text{single top}\rightarrow{\ell j}+X$ & $       148 \pm          8 $ & $       166 \pm          8 $ & $       233 \pm         10 $ & $       294 \pm         11 $ \\
$\text{DY}\rightarrow{\tau_{\ell}\tau_{h}}+ {\rm jets}$ & $       100 \pm         27 $ & $       189 \pm         28 $ & $       202 \pm         32 $ & $       418 \pm         52 $ \\
       $\text{DY}\rightarrow{\rm other}$ & $        20 \pm         10 $ & $        59 \pm         19 $ & $        10 \pm         10 $ & $        33 \pm         14 $ \\
$\text{W+jets} \rightarrow\ell\nu+ {\rm jets}$ & $       111 \pm         33 $ & $       180 \pm         37 $ & $       256 \pm         49 $ & $       398 \pm         68 $ \\
$\text{W+jets} \rightarrow\tau_{\ell}\nu + {\rm jets}$ & $         7 \pm          3 $ & $         7 \pm          4 $ & $        22 \pm         14 $ & $        16 \pm          4 $ \\
                       $\text{dibosons}$ & $        23 \pm          4 $ & $        45 \pm          6 $ & $        42 \pm          6 $ & $        84 \pm         10 $ \\
                            $\text{QCD}$ & $       170 \pm         55 $ & $       411 \pm         74 $ & $       225 \pm         48 $ & $       314 \pm         59 $ \\
                                  mc_sum & $      6238 \pm        129 $ & $      7866 \pm        158 $ & $     10746 \pm        164 $ & $     13293 \pm        199 $ \\
                                    data & $      6200 \pm        236 $ & $      7896 \pm        273 $ & $     10243 \pm        298 $ & $     13558 \pm        352 $ \\









# problem with merging two datacards

JER               lnN           0.999/1.001           1.001/1.001           1.003/1.008           1.002/1.000           0.996/1.000           0.970/0.983           1.004/1.001           1.005/0.991           0.995/1.002           1.000/1.000           0.993/0.999           0.819/0.976           0.979/0.988            -       0.999/1.000           0.999/0.999           0.998/1.000           0.999/0.998           0.987/0.991           1.003/1.006           1.001/1.000           1.003/0.997           0.998/1.005           1.080/1.107           1.021/1.031           1.014/1.071           0.998/1.009               -

JER             shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -


python new_impact_table.py --merge-pdf latest_el_impacts.json latest_mu_impacts.json latest_both_impacts.json








# symmetric NLL asymmetric impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_toys_3.json            --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_toys_3.json -o prefit_mu_impacts_toys

  JES       :   +0.000  -0.769/+0.831  +0.008/-0.000
  JER       :   -0.000  -0.750/+0.840  +0.007/+0.005
  TES       :   -0.000  -0.810/+0.796  +0.013/-0.003


example:

combine -M MultiDimFit ttxsec/fit-stuff/fresh_mu.txt --algo grid --points 2000 --rMax 2 --name MuShapes --forceRecreateNLL --saveSpecifiedNuis TOPPT,dy_norm --parameters TOPPT




combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 100 --rMin 0.5 --rMax 1.5 --name MuShapesTest4 --freezeParameters lumi_13TeV         --saveSpecifiedNuis JES,JER,TES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 100 --rMin 0.5 --rMax 1.5 --name MuShapesTest4 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --saveSpecifiedNuis JES,JER,TES


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 200 --rMin 0.8 --rMax 1.2 --name MuShapesTest4 --freezeParameters lumi_13TeV         --saveSpecifiedNuis JES,JER,TES

limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")
limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<1", "L")
limit->Draw("JES:r", "deltaNLL>0 && 2*deltaNLL<1", "L")
limit->Draw("JER:r", "deltaNLL>0 && 2*deltaNLL<1", "L")
limit->Draw("TES:r", "deltaNLL>0 && 2*deltaNLL<1", "L")


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -m 125 --robustFit 1 --doInitialFit         --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -t -1 --expectSignal 1.0 -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -m 125 -o latest_mu_impacts_toys_3.json            --name MuImpactsToys
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_toys_3.json -o prefit_mu_impacts_toys


only JES impact

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,TES,stop_norm,dibos_norm,LEPmu --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,TES,stop_norm,dibos_norm,LEPmu --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,TES,stop_norm,dibos_norm,LEPmu --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.648/+0.689  +0.013/-0.014

without MC stats:

  JES       :   +0.000  -0.604/+0.646  +0.013/-0.013










# blown up electron systematics

many systematics (PDF, PU)
have both variations much larger than nominal: about x2 of nominal

time make distrs_mc_common_weights  p=pStage2Run4 nt=v26 option="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal         p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &





re-hadd all

ls v26pStage2Run4 > group-hadds
split -l 500 group-hadds group-hadds_

cd v26pStage2Run4

foreach group ( `ls ../group-hadds_*` )
hadd $group.MC2016_Summer16_TTJets_powheg.root `cat $group` &
end

hadd v26pStage2Run4_hadds2/MC2016_Summer16_TTJets_powheg.root group-hadds_??.MC2016_Summer16_TTJets_powheg.root



hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root v25pStage2Run4Rest/MC* v25pStage2Run4Rest/wjets/MC* v25r4/MC* v26pStage2Run4/MC2016_Summer16_TTJets_powheg.root

cp  distrs_v25pStage2Run3_3_Run4_updowns_weights_4.root  ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/test4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/test4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s PUUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/test4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s PUDown

hadd HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root v25pStage2Run3_3_Run4_mu_ljs/*root v25pStage2Run3_3_Run4_el_ljs/*root

cp HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root ../../../fit-stuff/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root









# rest of MC with new nominal TES etc

hopefully it will correct the issue with PU and wjets

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4Rest nt=v25 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &



time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_common_weights    p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





distrs_mc_lep_weights

time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &



time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPmu p=pStage2Run4Rest nt=v25                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_lep_weights   sysname=LEPel p=pStage2Run4Rest nt=v25 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &






and tt for electron channels


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &




time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &






time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &





time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





lepton SFs 
distrs_mc_lep_weights

time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPmu  p=pStage2Run4 nt=v26                       cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_lep_weights  sysname=LEPel  p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &








foreach d ( `cat all-dtags` )
hadd distrs/v25pStage2Run4Rest_nominal_hadds/$d.root distrs/v25pStage2Run4Rest_nominal/*$d*root &
end

foreach d ( `cat all-dtags` )
hadd distrs/v25pStage2Run4Rest_sys_hadds/$d.root distrs/v25pStage2Run4Rest_sys/*$d*root &
end


foreach d ( `cat all-dtags` )
hadd distrs/v25pStage2Run4Rest_hadds/$d.root distrs/v25pStage2Run4Rest_sys_hadds/*$d*root distrs/v25pStage2Run4Rest_nominal_hadds/*$d*root &
end



hadd all

all mc
core wjets
updowns
tt

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_3.root v25pStage2Run4Rest/MC* v25pStage2Run4Rest/wjets/MC* v25r4/MC* v26pStage2Run4/2/MC2016_Summer16_TTJets_powheg.root

cp  distrs_v25pStage2Run3_3_Run4_updowns_weights_3.root  ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

hadd HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root v25pStage2Run3_3_Run4_mu_ljs/*root v25pStage2Run3_3_Run4_el_ljs/*root

cp HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root ../../../fit-stuff



-- apparently no change in the MC yields

use W0Jets?


checking for now:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.607/+0.565  +0.013/-0.004
  JER       :   +0.000  -0.992/+0.990  +0.000/-0.000
  JES       :   +0.000  -0.599/+0.674  +0.008/-0.005

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.656/+0.739  +0.008/-0.005
  JER       :   +0.000  -0.992/+0.992  +0.000/-0.000
  TES       :   +0.000  -0.713/+0.618  +0.019/-0.007

with wjets:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.703/+0.779  +0.018/-0.002
  JER       :   +0.000  -0.993/+0.992  +0.001/-0.001
  TES       :   +0.000  -0.731/+0.690  +0.025/-0.004

kind of ok


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test3.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test3.json -o latest_mu_toys_asimov_impacts_full_Run4Test3

  JES       :   +0.000  -0.723/+0.799  +0.009/+0.001
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  TES       :   +0.000  -0.776/+0.758  +0.016/-0.002





../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test3.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test3.json -o latest_mu_toys_asimov_impacts_full_Run4Test3











# full redo tt with nominal tes

all rest MC without tt
updowns
and tt v26 with weights

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights.root   v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root

now:

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_2.root v25pStage2Run3/MC* v25r4/MC* v26pStage2Run4/2/MC2016_Summer16_TTJets_powheg.root




ls v26pStage2Run4 > group-hadds
split -l 500 group-hadds group-hadds_

cd v26pStage2Run4

foreach group ( `ls ../group-hadds_*` )
hadd $group.MC2016_Summer16_TTJets_powheg.root `cat $group` &
end

hadd v26pStage2Run4_hadds2/MC2016_Summer16_TTJets_powheg.root group-hadds_??.MC2016_Summer16_TTJets_powheg.root

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights_2.root v25pStage2Run3/MC* v25r4/MC* v26pStage2Run4/2/MC2016_Summer16_TTJets_powheg.root

cp distrs_v25pStage2Run3_3_Run4_updowns_weights_2.root ../distrs_v25pStage2Run3_3_Run4_updowns_weights.root

rm histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/*
rm histosel-roots/v25pStage2Run3_3_Run4_el_ljs/*

source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs &
source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs &

source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs_rest &
source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_rest &

source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs_pdfs &
source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs_pdfs &


redo lepton systematics:

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPelUp &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPelUp &

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPelDown &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_3_Run4_el_ljs/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPelDown &


python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPmuUp &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPmuUp &

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s LEPmuDown &
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root  -o histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s LEPmuDown &






hadd HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root v25pStage2Run3_3_Run4_mu_ljs/*root v25pStage2Run3_3_Run4_el_ljs/*root



../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit               --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts_Run4Test2.json  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts_Run4Test2.json -o postfit_mu_impacts_Run4Test2


-- JES and JER are assymetric again, in the same way as usual
JES +9 -1  * 10^-3
JER +7 +5  * 10^-3
-- but they are smaller then in the first test

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2




again all three asymmetric

JER       :   -0.000  -0.699/+0.673  +0.016/+0.016
JES       :   +0.000  -0.696/+0.678  +0.018/+0.008
TES       :   -0.000  -0.665/+0.655  +0.023/+0.011

dmn
why??????


try leaving them in TT only, no old MCs






## JES JER TES only in TT

full:

JES             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -
JER             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -
TES             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -


only TT:

JES             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -
JER             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -
TES             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -


still:

  JER       :   +0.000  -0.751/+0.836  +0.009/+0.006
  JES       :   +0.000  -0.773/+0.830  +0.010/+0.001
  TES       :   -0.000  -0.810/+0.793  +0.014/-0.001






## rate based JER

JER             shape       1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -               1.0 1.0 1.0 1.0 1.0        1.0      1.0 1.0 1.0      1.0 1.0      1.0 1.0      -

JER             shape       1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -               1.0 1.0 1.0 1.0 1.0        -        -   -   -        -   -        -   -        -


python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other,dibosons,s_top_lj,s_top_other,s_top_mutau,wjets_taul,wjets_other,dy_other,dy_tautau -s JER

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj    mu_sel_lj      mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout    mu_sel_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              dibosons              s_top_lj           s_top_other           s_top_mutau            wjets_taul           wjets_other              dy_other             dy_tautau          qcd          tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              dibosons              s_top_lj           s_top_other           s_top_mutau            wjets_taul           wjets_other              dy_other             dy_tautau             qcd
                 JER           0.999/1.001           1.001/1.001           1.003/1.008           1.002/1.000           0.996/1.000           0.970/0.983           1.004/1.001           1.005/0.991           0.995/1.002           1.000/1.000           0.993/0.999           0.819/0.976           0.979/0.988            -       0.999/1.000           0.999/0.999           0.998/1.000           0.999/0.998           0.987/0.991           1.003/1.006           1.001/1.000           1.003/0.997           0.998/1.005           1.080/1.107           1.021/1.031           1.014/1.071           0.998/1.009               -



toy fit with PU on only

  TES       :   +0.000  -0.607/+0.566  +0.013/-0.004
  JER       :   +0.000  -0.992/+0.991  +0.000/-0.000
  JES       :   +0.000  -0.599/+0.674  +0.008/-0.005

-- kind of ok

full toy fit

  TES       :   +0.000  -0.778/+0.754  +0.017/-0.000
  JER       :   +0.000  -0.992/+0.993  +0.000/-0.001
  JES       :   +0.000  -0.730/+0.798  +0.011/+0.002

freeze JER

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,PU --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,PU --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,JER,PU -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2


the usual check:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

-- works!

with groups:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.736/+0.702  +0.008/-0.004
  JER       :   +0.000  -0.992/+0.991  +0.000/-0.000
  JES       :   +0.000  -0.639/+0.745  +0.006/-0.004

-- fine!

-- suddenly FSR is constrained a lot! -- it's not balanced out by fakes!

only without tau:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.777/+0.754  +0.019/+0.002
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  JES       :   +0.000  -0.727/+0.791  +0.014/+0.001

-- ha!

only added wjets:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.663/+0.781  +0.008/-0.001
  JER       :   +0.000  -0.994/+0.992  +0.000/-0.000
  TES       :   +0.000  -0.740/+0.746  +0.010/-0.001

full fit without wjets:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.692/+0.763  +0.001/-0.005
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  TES       :   +0.000  -0.761/+0.720  +0.010/-0.009

hmmm

no wjets and no PU too:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.692/+0.763  +0.001/-0.005
  JER       :   +0.000  -0.993/+0.993  +0.000/-0.001
  TES       :   +0.000  -0.761/+0.720  +0.010/-0.009

on real data:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,wjets_norm,PU -o latest_mu_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_Run4Test2.json -o latest_mu_Run4Test2


  TES       :   -0.039  -0.434/+0.362  +0.003/-0.003
  JER       :   -0.022  -1.042/+1.062  +0.000/-0.000
  JES       :   -0.013  -0.322/+0.316  -0.001/-0.000

real data full set:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsTest2   --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_Run4Test2.json -o latest_mu_Run4Test2







## impacts with only objects

testing correlation with all systematics one by one

standard fit with all systematics:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2


no theory:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008



tau on

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008



exp on

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JER       :   +0.000  -0.707/+0.803  +0.008/+0.007
  TES       :   +0.000  -0.772/+0.750  +0.016/-0.003
  JES       :   +0.000  -0.729/+0.789  +0.011/-0.000


-- one of exp!

only exp on

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.721/+0.784  +0.015/-0.001
  JER       :   +0.000  -0.706/+0.802  +0.009/+0.007
  TES       :   +0.000  -0.741/+0.704  +0.021/+0.002

exps:
exp group = tauID_eff tau_fakes dy_norm wjets_norm qcd_norm bSF PU TOPPT

norms:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JER       :   +0.000  -0.665/+0.775  +0.002/+0.002
  JES       :   +0.000  -0.645/+0.729  +0.003/+0.003
  TES       :   +0.000  -0.691/+0.649  +0.014/+0.004

the others:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   -0.000  -0.699/+0.780  +0.011/-0.002
  JER       :   +0.000  -0.695/+0.798  +0.006/+0.005
  TES       :   +0.000  -0.686/+0.682  +0.011/-0.002


--- ??? so which

again:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


-- maybe there are several affecting params?

tau fakes:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


tau ID:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012



PU:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.653/+0.646  +0.009/+0.006
  JER       :   +0.000  -0.665/+0.775  +0.000/+0.002
  JES       :   +0.000  -0.640/+0.726  +0.003/+0.003

--- PU !!!!!!!!!!

all PU:

PU              shape          1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    1.0   1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -

only-TT PU:

PU              shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -

-- run

  JER       :   +0.000  -0.666/+0.775  +0.002/+0.003
  JES       :   +0.000  -0.634/+0.716  +0.005/+0.002
  TES       :   +0.000  -0.646/+0.644  +0.010/+0.005

--- same stuff...

NLL scan with these parameters

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --name MuShapes3 --freezeParameters  lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau  --saveSpecifiedNuis JES,JER,TES,PU

--freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau
--freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau

no JER:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm,JER --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm,JER --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm,JER --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JER       :   +0.000  +0.000/+0.000  +0.000/+0.000
  JES       :   +0.000  -0.599/+0.674  +0.008/-0.005
  TES       :   +0.000  -0.607/+0.565  +0.013/-0.004

-- ha



TOPPT:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   +0.000  -0.672/+0.573  +0.021/-0.013
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.000
  JES       :   +0.000  -0.627/+0.689  +0.011/-0.009



bSF:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


the rest of norms: dy wjets qcd

dy

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,wjets_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.628/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.666/+0.775  +0.000/+0.000
  TES       :   +0.000  -0.628/+0.565  +0.015/-0.012


wjets

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,qcd_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.767  +0.009/-0.001
  JER       :   +0.000  -0.682/+0.787  +0.004/+0.004
  TES       :   +0.000  -0.651/+0.675  +0.009/-0.003

-- WJETS to some extend!!!!!!!!!!!!!!!!!!!!


qcd

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT,tauID_eff,tau_fakes,dy_norm,wjets_norm --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  TES       :   -0.000  -0.686/+0.620  +0.011/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  JES       :   +0.000  -0.673/+0.747  +0.006/-0.006

again all norms:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV,bSF,PU,TOPPT --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   -0.000  -0.699/+0.780  +0.011/-0.002
  JER       :   +0.000  -0.695/+0.798  +0.006/+0.005
  TES       :   +0.000  -0.686/+0.682  +0.011/-0.002


--- this is it!

PU & WJETS













without MC stats:

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --name MuImpactsToys  -t -1 --expectSignal 1 -d ttxsec/fit-stuff/latest_datacard_mu.root -m 125 --freezeParameters lumi_13TeV --freezeNuisanceGroup tt_th_pdf,tt_updowns,tt_th_frag,exp,tau -o latest_mu_toys_asimov_impacts_full_Run4Test2.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_toys_asimov_impacts_full_Run4Test2.json -o latest_mu_toys_asimov_impacts_full_Run4Test2

  JES       :   +0.000  -0.623/+0.686  +0.009/-0.008
  JER       :   +0.000  -0.665/+0.774  +0.000/+0.001
  TES       :   +0.000  -0.626/+0.565  +0.015/-0.012


with MC stats:

  JES       :   -0.000  -0.666/+0.723  +0.010/-0.009
  JER       :   +0.000  -0.706/+0.808  +0.000/+0.000
  TES       :   -0.000  -0.664/+0.605  +0.016/-0.013









## effect of JER

in stack plot JER  up and down shapes deviate from nominal in the same way

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JERUp,JERDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JERUp,JERDown 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JERUp,JERDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JERUp,JERDown 


redo JER?


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s PUUp,PUDown 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s PUUp,PUDown 










## distributions

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm 
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESDown

python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm 
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JESDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s JERDown
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESUp
python stack_plot.py distrs_v25pStage2Run3_3_Run4_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/test2/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm -s TESDown


## correlations

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root                          --plots --saveShapes --saveWithUncertainties --name MuShapes3

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root -t -1 --expectSignal 1.0 --plots --saveShapes --saveWithUncertainties --name MuShapes3


combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root -t -1 --expectSignal 1.0 --plots --saveShapes --saveWithUncertainties --name MuShapes3 --freezeNuisanceGroup tt_th_pdf

eog covariance_fit_s.png


* autoMCStats 0










# some weird issues in the fit after Run4 patch of jbect systematics

maybe it's due to TES in nominal MC?
-- need to correct all systematics (weight-based too)


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER,TES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TES,JER  --saveSpecifiedNuis JES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TES,JER  --saveSpecifiedNuis JES


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TES,JER,JES

-- on Run4 0.68  with objects 0.7 and a lot of angles all on = 

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup tt_th_frag,tt_th_pdf,tt_updowns --name MuShapes3 --freezeParameters lumi_13TeV,TauES,JER,JES

-- on Run3 data with stuff frozen it goes to 0.86 with objects syst on it's 0.96-1, with tt theory 0.96


root -l higgsCombineMuShapes3.MultiDimFit.mH120.root

limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("deltaNLL:JES", "", "L")

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root  --saveShapes --saveWithUncertainties --name MuShapes3  --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --freezeParameters lumi_13TeV


combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root  --saveShapes --saveWithUncertainties --name MuShapes3  --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf,tt_updowns --freezeParameters lumi_13TeV,TES,JER


JES rates:
JES              lnN           0.982/1.018           0.988/1.011           0.995/1.016           0.985/1.020           0.986/1.023           0.931/1.067           0.977/1.034           0.984/1.038           0.969/1.031           1.000/1.042           0.934/1.030           0.819/1.157           0.937/1.064           -               0.988/1.015           0.989/1.011           0.980/1.015           0.987/1.014           0.980/1.025           0.974/1.018           0.974/1.021           0.973/1.032           0.974/1.024           1.000/1.110           0.978/1.084           0.973/0.846           0.960/1.031           -

shape
JES             shape       1.0 1.0 1.0 1.0 1.0           1.0           1.0 1.0 1.0           1.0 1.0           1.0 1.0           -               1.0 1.0 1.0 1.0 1.0           1.0           1.0 1.0 1.0           1.0 1.0           1.0 1.0           -



## reproducing all weight systematics


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var >  60." chan="mu_sel_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var >  60." chan="el_sel_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &



time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var >  60." chan="mu_sel_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var >  60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &





time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var >  60." chan="mu_selVloose_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var >  60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var >  60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4  cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &


time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var >  60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights    p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights        p=pStage2Run4 nt=v26 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs"  cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




time make distrs_mc_tt_weights_scale  nt=v26 p=pStage2Run4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=pStage2Run4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights_pdf    nt=v26 p=pStage2Run4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &








# one sided expectations of JES and JER

## JES

tt_lj has the same yields in mu_sel_lj and the same yields of variations in ljout when nominal is less
but the shapes of both variations follow the same "direction" with one being smaller

tt_mutau has different yields


nom     = (TH1D*) mu_sel_ljout->Get("tt_lj/NOMINAL/mu_sel_ljout_tt_lj_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_ljout->Get("tt_lj/JESUp/mu_sel_ljout_tt_lj_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_ljout->Get("tt_lj/JESDown/mu_sel_ljout_tt_lj_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_ljout->Get("tt_lj/JERUp/mu_sel_ljout_tt_lj_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_ljout->Get("tt_lj/JERDown/mu_sel_ljout_tt_lj_JERDown_Mt_lep_met_f")

nom     = (TH1D*) mu_sel_lj->Get("tt_lj/NOMINAL/mu_sel_lj_tt_lj_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_lj->Get("tt_lj/JESUp/mu_sel_lj_tt_lj_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_lj->Get("tt_lj/JESDown/mu_sel_lj_tt_lj_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_lj->Get("tt_lj/JERUp/mu_sel_lj_tt_lj_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_lj->Get("tt_lj/JERDown/mu_sel_lj_tt_lj_JERDown_Mt_lep_met_f")


nom     = (TH1D*) mu_sel_ljout->Get("tt_mutau/NOMINAL/mu_sel_ljout_tt_mutau_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_ljout->Get("tt_mutau/JESUp/mu_sel_ljout_tt_mutau_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_ljout->Get("tt_mutau/JESDown/mu_sel_ljout_tt_mutau_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_ljout->Get("tt_mutau/JERUp/mu_sel_ljout_tt_mutau_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_ljout->Get("tt_mutau/JERDown/mu_sel_ljout_tt_mutau_JERDown_Mt_lep_met_f")

nom     = (TH1D*) mu_sel_lj->Get("tt_mutau/NOMINAL/mu_sel_lj_tt_mutau_NOMINAL_Mt_lep_met_f")
jesup   = (TH1D*) mu_sel_lj->Get("tt_mutau/JESUp/mu_sel_lj_tt_mutau_JESUp_Mt_lep_met_f")
jesdown = (TH1D*) mu_sel_lj->Get("tt_mutau/JESDown/mu_sel_lj_tt_mutau_JESDown_Mt_lep_met_f")
jerup   = (TH1D*) mu_sel_lj->Get("tt_mutau/JERUp/mu_sel_lj_tt_mutau_JERUp_Mt_lep_met_f")
jerdown = (TH1D*) mu_sel_lj->Get("tt_mutau/JERDown/mu_sel_lj_tt_mutau_JERDown_Mt_lep_met_f")


jesup   ->SetLineColor(kRed)
jesdown ->SetLineColor(kGreen)

nom     ->Draw()
jesup   ->Draw("same")
jesdown ->Draw("same")

jerup   ->SetLineColor(kRed)
jerdown ->SetLineColor(kGreen)

nom     ->Draw()
jerup   ->Draw("same")
jerdown ->Draw("same")


nom     ->Print()
jesup   ->Print()
jesdown ->Print()

jerup   ->Print()
jerdown ->Print()



## fitting info after correction

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER

root -l higgsCombineMuShapes3.MultiDimFit.mH120.root

limit->Draw("2*deltaNLL:r", "deltaNLL>0 && 2*deltaNLL<10", "L")

limit->Draw("deltaNLL:JES", "", "L")


combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid -t -1 --expectSignal 1.0 --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER,TES

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 80 --rMin 0.6 --rMax 1.4 --freezeNuisanceGroup exp,tau,tt_th_frag,tt_th_pdf --name MuShapes3 --freezeParameters lumi_13TeV  --saveSpecifiedNuis JES,JER,TES




plot of syst variations of JES

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj -d Mt_lep_met_f -s JESUp,JESDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj -d Mt_lep_met_f -s JESUp,JESDown 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESUp,JESDown 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESUp,JESDown 


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESDown
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESDown

JES             shape          0.2    0.2   0.2   0.2   0.2        0.2      0.2   0.2   0.2      0.2   0.2      0.2   0.2      -                  0.2    0.2   0.2   0.2   0.2        0.

JES             shape          1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -                  1.0    1.0   1.0   1.0   1.0        -        -     -     -        -     -        -     -        -        

JES             shape          1.0    1.0   -     -     -          -        -     -     -        -     -        -     -        -                  1.0    1.0   -     -     -          -        -     -     -        -     -        -     -        -        

JES             shape          1.0    -     -     -     -          -        -     -     -        -     -        -     -        -                  1.0    -     -     -     -          -        -     -     -        -     -        -     -        -


JES             shape          -      1.0   -     -     -          -        -     -     -        -     -        -     -        -                  -      1.0   -     -     -          -        -     -     -        -     -        -     -        -

-- sharp step here


JES             shape          -      -     -     -     -          -        -     -     -        -     -        -     -        -                  -      1.0   -     -     -          -        -     -     -        -     -        -     -        -

JES             shape          -      1.0   -     -     -          -        -     -     -        -     -        -     -        -                  -      -     -     -     -          -        -     -     -        -     -        -     -        -


JES             shape          1.0    -     1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    -     1.0   1.0   1.0        1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  



rate 

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s JES

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other,dibosons,s_top_lj,s_top_other,s_top_mutau,wjets_taul,wjets_other,dy_other,dy_tautau -s JES



JES             lnN          1.0    -     -     -     -          1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -                  1.0    -     -     -     -          1.0      1.0   1.0   1.0      1.0   1.0      1.0   1.0      -








## the selection stages

time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

test

python selections.py  --out-dir distrs/ --distr Mt_lep_met_f --chan mu_sel_ljout "sqrt(2*(sqrt((event_met_JERDown.Px()*event_met_JERDown.Px() + event_met_JERDown.Py()*event_met_JERDown.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met_JERDown.Px()*event_leptons[0].Px() + event_met_JERDown.Py()*event_leptons[0].Py())))"    --cond-com "selection_stage_JERDown==  7 && event_jets_lj_var > 60." --custom-range 0,20,40,60,80,100,130,160,200,250 --sys JERDown   --weight event_weight  merge-sets/v25/pStage2Run3/*MC*TT*.root



time make distrs_mc_nominal dtag=TT nt=v26 p=r4                      cond="(selection_stage==105 || selection_stage==107)"  chan="mu_selVloose"    &
time make distrs_mc_nominal dtag=TT nt=v26 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)"  chan="el_selVloose" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==  7 || selection_stage_JERDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==107 || selection_stage==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26                      cond="(selection_stage==106 || selection_stage==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &

time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==117 || selection_stage==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal     p=pStage2Run4 nt=v26 options="--el-procs" cond="(selection_stage==116 || selection_stage==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &





time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &





time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="selection_stage_JERDown==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="selection_stage_JERUp  ==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="selection_stage_JESDown==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="selection_stage_JESUp  ==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="selection_stage_TESDown==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="selection_stage_TESUp  ==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &







time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==107 || selection_stage_JERDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==107 || selection_stage_JERUp  ==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==107 || selection_stage_JESDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==107 || selection_stage_JESUp  ==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==107 || selection_stage_TESDown==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==107 || selection_stage_TESUp  ==105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==106 || selection_stage_JERDown==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==106 || selection_stage_JERUp  ==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==106 || selection_stage_JESDown==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==106 || selection_stage_JESUp  ==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==106 || selection_stage_TESDown==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==106 || selection_stage_TESUp  ==104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==107 || selection_stage_JERDown==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==107 || selection_stage_JERUp  ==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==107 || selection_stage_JESDown==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==107 || selection_stage_JESUp  ==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==107 || selection_stage_TESDown==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==107 || selection_stage_TESUp  ==105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==106 || selection_stage_JERDown==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==106 || selection_stage_JERUp  ==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==106 || selection_stage_JESDown==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==106 || selection_stage_JESUp  ==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==106 || selection_stage_TESDown==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==106 || selection_stage_TESUp  ==104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &




time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==117 || selection_stage_JERDown==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==117 || selection_stage_JERUp  ==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==117 || selection_stage_JESDown==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==117 || selection_stage_JESUp  ==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==117 || selection_stage_TESDown==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==117 || selection_stage_TESUp  ==115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==116 || selection_stage_JERDown==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==116 || selection_stage_JERUp  ==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==116 || selection_stage_JESDown==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==116 || selection_stage_JESUp  ==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==116 || selection_stage_TESDown==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==116 || selection_stage_TESUp  ==114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==117 || selection_stage_JERDown==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==117 || selection_stage_JERUp  ==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==117 || selection_stage_JESDown==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==117 || selection_stage_JESUp  ==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==117 || selection_stage_TESDown==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==117 || selection_stage_TESUp  ==115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERDown met=event_met_JERDown cond="(selection_stage_JERDown==116 || selection_stage_JERDown==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JERUp   met=event_met_JERUp   cond="(selection_stage_JERUp  ==116 || selection_stage_JERUp  ==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESDown met=event_met_JESDown cond="(selection_stage_JESDown==116 || selection_stage_JESDown==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=JESUp   met=event_met_JESUp   cond="(selection_stage_JESUp  ==116 || selection_stage_JESUp  ==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESDown met=event_met_TESDown cond="(selection_stage_TESDown==116 || selection_stage_TESDown==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects_mt     p=pStage2Run4 nt=v26 options="--el-procs" sys_name=TESUp   met=event_met_TESUp   cond="(selection_stage_TESUp  ==116 || selection_stage_TESUp  ==114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3_mc_objects_rerun/*$d*root &
end


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3_noJesJerTes/*$d*root &
end

hadd distrs_v25pStage2Run3_3_updowns_weights.root v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root

cat histosel_stage2_run3_3_VlooseShapes_mu_sel_ljs histosel_stage2_run3_3_VlooseShapes_el_sel_ljs

source histosel_stage2_run3_3_VlooseShapes_mu_sel_ljs &
source histosel_stage2_run3_3_VlooseShapes_el_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_3_Vloose_shape_el_mu_ljs_updowns_weights.root histosel-roots/v25pStage2Run3_3_el_ljs/*root histosel-roots/v25pStage2Run3_3_mu_ljs/*root  histosel-roots/v25pStage2Run3_el_ljs_updowns/*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/*root histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/distr*root



with new jes jer tes patch

hadd v26pStage2Run4_hadds/MC2016_Summer16_TTJets_powheg.root v25pStage2Run3_no_objects_in_tt/test*TT*root v26pStage2Run4/test*TT*root

hadd distrs_v25pStage2Run3_3_Run4_updowns_weights.root v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root v26pStage2Run4/MC2016_Summer16_TTJets_powheg.root

diverted from nominal TES factor:
pdfs and scale
updowns


source histosel_stage2_run3_3_Run4_VlooseShapes_mu_sel_ljs &
source histosel_stage2_run3_3_Run4_VlooseShapes_el_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root histosel-roots/v25pStage2Run3_3_Run4_el_ljs/*root histosel-roots/v25pStage2Run3_3_Run4_mu_ljs/*root  histosel-roots/v25pStage2Run3_el_ljs_updowns/*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/*root histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/distr*root


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_lj    -d Mt_lep_met_f -s JESDown
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_lj    -c mu_sel_ljout -d Mt_lep_met_f -s JESDown


python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JESUp 
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESUp 

python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_lj    -d Mt_lep_met_f -s JESDown
python mc_per_sys.py --no-data histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights.root -p tt_mutau -c mu_sel_ljout -d Mt_lep_met_f -s JESDown










# plots tables etc

Mt distrs for the fit (the onloy figures in the paper)
bins are normalized per gev

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/ --lumi 35800 -c mu_sel_lj    -x mu_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(#mu, MET), GeV" --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -p -r -o plots/run4/ --lumi 35800 -c mu_sel_ljout -x mu_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(#mu, MET), GeV" --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(e, MET), GeV"   --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -p -r -o plots/run4/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --qcd 1.05 --wjet 0.8 --bin-norm --title "" --title-x "M_{T}(e, MET), GeV"   --title-y "Events/1GeV" --draw-overflows 5 --legend-shift 0.02

copy and rename

cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleElectron_Mt_lep_met_f_el_sel_lj_NOMINAL_stack_ratio_x_el_selVloose_lj_dataqcd.png        el_sel_lj_Mt.png
cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleElectron_Mt_lep_met_f_el_sel_ljout_NOMINAL_stack_ratio_x_el_selVloose_ljout_dataqcd.png  el_sel_ljout_Mt.png
cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleMuon_Mt_lep_met_f_mu_sel_lj_NOMINAL_stack_ratio_x_mu_selVloose_lj_dataqcd.png            mu_sel_lj_Mt.png
cp distrs_v25pStage2Run3_2_updowns_..,distrs,v25pStage2Run3_hadds,SingleMuon_Mt_lep_met_f_mu_sel_ljout_NOMINAL_stack_ratio_x_mu_selVloose_ljout_dataqcd.png      mu_sel_ljout_Mt.png






NLL plot for paper
and stat-sus split of uncertainties


combine -M MultiDimFit --algo none --rMin 0.5 --rMax 1.5 ttxsec/fit-stuff/latest_datacard_mu.root --saveWorkspace -n MuBestfit
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n MuNoSysWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineMuBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV" -n MuFullUncertaintyNoLumi

plot1DScan.py higgsCombineMuFullUncertaintyNoLumi.MultiDimFit.mH120.root --others  'higgsCombineMuNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown syst,stat

mv scan.pdf run4_scan_mu_obs.pdf
mv scan.png run4_scan_mu_obs.png


remember for el:
combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root   --algo grid --points 32 --rMin 0.6 --rMax 1.4 --name ElShapes --freezeParameters lumi_13TeV




combine -M MultiDimFit --algo none             --rMin 0.6 --rMax 1.4 ttxsec/fit-stuff/latest_datacard_el.root --saveWorkspace -n ElBestfit
combine -M MultiDimFit --algo grid --points 32 --rMin 0.6 --rMax 1.4 higgsCombineElBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ElNoSysWLumi
combine -M MultiDimFit --algo grid --points 32 --rMin 0.6 --rMax 1.4 higgsCombineElBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV" -n ElFullUncertaintyNoLumi

plot1DScan.py higgsCombineElFullUncertaintyNoLumi.MultiDimFit.mH120.root --others  'higgsCombineElNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown syst,stat

mv scan.pdf run4_scan_el_obs.pdf
mv scan.png run4_scan_el_obs.png


combine -M MultiDimFit --algo none -t -1 --expectSignal 1 --rMin 0.5 --rMax 1.5 ttxsec/fit-stuff/latest_datacard_both.root --saveWorkspace -n ExpectedBothBestfit
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n ExpectedBothNoSysWLumi
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes" -n ExpectedBothNoTauWLumi
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit  -n ExpectedBothFullUncertaintyWLumi
combine -M MultiDimFit --algo grid -t -1 --expectSignal 1 --points 100 --rMin 0.5 --rMax 1.5 higgsCombineExpectedBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters lumi_13TeV -n ExpectedBothFullUncertaintyNoLumi

plot1DScan.py higgsCombineExpectedBothFullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombineExpectedBothFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineExpectedBothNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf run4_scan_both_exp.pdf
mv scan.png run4_scan_both_exp.png



combine -M MultiDimFit --algo none --rMin 0.5 --rMax 1.5 ttxsec/fit-stuff/latest_datacard_both.root --saveWorkspace -n BothBestfit
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters all --fastScan -n BothNoSysWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "tauID_eff,tau_fakes" -n BothNoTauWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit  -n BothFullUncertaintyWLumi
combine -M MultiDimFit --algo grid --points 100 --rMin 0.5 --rMax 1.5 higgsCombineBothBestfit.MultiDimFit.mH120.root --snapshotName MultiDimFit --freezeParameters "lumi_13TeV" -n BothFullUncertaintyNoLumi


plot1DScan.py higgsCombineBothFullUncertaintyWLumi.MultiDimFit.mH120.root --others 'higgsCombineBothFullUncertaintyNoLumi.MultiDimFit.mH120.root:lumi:4' 'higgsCombineBothNoSysWLumi.MultiDimFit.mH120.root:stat:2' --breakdown lumi,syst,stat

mv scan.pdf run4_scan_both_obs.pdf
mv scan.png run4_scan_both_obs.png



python plot_uncertainty_scans.py

eog uncertainty_scans_both_exp.png uncertainty_scans_el_exp.png uncertainty_scans_mu_exp.png
eog uncertainty_scans_both_exp_obs.png uncertainty_scans_el_exp_obs.png uncertainty_scans_mu_exp_obs.png


impact table


python new_impact_table.py --merge-pdf 
python new_impact_table.py --merge-pdf 
python new_impact_table.py --merge-pdf latest_el_impacts.json latest_mu_impacts.json latest_both_impacts.json



yields

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns_weights.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex

python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_3_Run4_Vloose_shape_el_mu_ljs_updowns_weights_test4.root -y -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout,mu_sel_lj,mu_sel_ljout --latex



xsec numbers with extrapolation

acceptances -- the same

acc_el = 0.1687
acc_mu = 0.1756
acc_bt = 0.1722
accept = [ acc_el acc_mu acc_bt ]

root -l merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

cut_ev_eltau->Divide( all_ev_eltau )
cut_ev_mutau->Divide( all_ev_mutau )

python proc/print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

acc_mu_err = sum(([0.1759     0.1756     0.1754     0.1761     0.1756     0.1760     0.1758     0.1756     0.1757     0.1758     0.1753     0.1754     0.1760     0.1755     0.1757     0.1755     0.1752     0.1762     0.1759     0.1755     0.1749     0.1762     0.1757     0.1757     0.1756     0.1758     0.1763     0.1751     0.1759     0.1754     0.1754     0.1760     0.1761     0.1753     0.1756     0.1758     0.1756     0.1757     0.1758     0.1756     0.1755     0.1761     0.1756     0.1759     0.1760     0.1753     0.1759     0.1756     0.1754     0.1761     0.1752     0.1763     0.1757     0.1757     0.1755     0.1751     0.1752     0.1752     0.1757     0.1757     0.1760     0.1758     0.1757     0.1758] - 0.1756) .^ 2) ^ 0.5
0.0025455844122715655

acc_el_err = sum(([0.1689     0.1686     0.1684     0.1691     0.1685     0.1690     0.1688     0.1686     0.1687     0.1688     0.1683     0.1684     0.1690     0.1686     0.1686     0.1685     0.1683     0.1691     0.1689     0.1686     0.1681     0.1691     0.1687     0.1687     0.1686     0.1688     0.1692     0.1682     0.1688     0.1684     0.1684     0.1690     0.1691     0.1683     0.1687     0.1688     0.1687     0.1687     0.1688     0.1686     0.1685     0.1691     0.1686     0.1689     0.1689     0.1683     0.1689     0.1686     0.1684     0.1691     0.1682     0.1693     0.1688     0.1687     0.1686     0.1681     0.1682     0.1683     0.1688     0.1687     0.1689     0.1688     0.1687     0.1687] - 0.1687) .^ 2) ^ 0.5
0.0022605309110914646

acc_bt_err = sum(([0.1724     0.1721     0.1719     0.1726     0.1721     0.1725     0.1723     0.1721     0.1722     0.1723     0.1718     0.1719     0.1725     0.1721     0.1722     0.1720     0.1717     0.1727     0.1724     0.1721     0.1715     0.1726     0.1722     0.1722     0.1721     0.1723     0.1727     0.1717     0.1724     0.1719     0.1719     0.1725     0.1726     0.1718     0.1722     0.1723     0.1721     0.1722     0.1723     0.1721     0.1720     0.1726     0.1721     0.1724     0.1725     0.1718     0.1724     0.1721     0.1719     0.1726     0.1717     0.1728     0.1722     0.1722     0.1720     0.1716     0.1717     0.1717     0.1723     0.1722     0.1725     0.1723     0.1722     0.1722] - 0.1722) .^ 2) ^ 0.5
0.002372762103540929

0.0025455844122715655 / 0.1759
0.0022605309110914646 / 0.1689
0.002372762103540929  / 0.1724

acc_el_err / acc_el
acc_mu_err / acc_mu
acc_bt_err / acc_bt




signal strangth:

el_sys = 0.112
mu_sys = 0.085
bt_sys = 0.079

el_sig = 1.022
mu_sig = 0.959
bt_sig = 1.027

el_stat = 0.016
mu_stat = 0.011
bt_stat = 0.009


el_sig  = 1.023
el_sys  = 0.10
el_stat = 0.016

mu_sig  = 0.938
mu_sys  = 0.066
mu_stat = 0.011

bt_sig  = 0.989
bt_stat = 0.009
bt_sys  = 0.07



xsec_el_vis = [el_sig el_stat el_sys 0.025 ]
xsec_mu_vis = [mu_sig mu_stat mu_sys 0.025 ]
xsec_bt_vis = [bt_sig bt_stat bt_sys 0.025 ]

xsec_vis = 831.76 * accept

xsec_el_vis * xsec_vis[1]
xsec_mu_vis * xsec_vis[2]
xsec_bt_vis * xsec_vis[3]


el_sys_extr = sum([el_sys acc_el_err / acc_el].^2) ^ 0.5
mu_sys_extr = sum([mu_sys acc_mu_err / acc_mu].^2) ^ 0.5
bt_sys_extr = sum([bt_sys acc_bt_err / acc_bt].^2) ^ 0.5

xsec_el_extr = [el_sig el_stat el_sys_extr 0.025 ]
xsec_mu_extr = [mu_sig mu_stat mu_sys_extr 0.025 ]
xsec_bt_extr = [bt_sig bt_stat bt_sys_extr 0.025 ]

xsec_el_extr = el_sig * 831.76
xsec_mu_extr = mu_sig * 831.76
xsec_bt_extr = bt_sig * 831.76

xsec_el_extr .* [el_stat el_sys_extr 0.025 ]
xsec_mu_extr .* [mu_stat mu_sys_extr 0.025 ]
xsec_bt_extr .* [bt_stat bt_sys_extr 0.025 ]



post-fit distrs:

combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_mu.root  --saveShapes --saveWithUncertainties --name MuShapes --freezeParameters lumi_13TeV
combine -M FitDiagnostics ttxsec/fit-stuff/latest_datacard_el.root  --saveShapes --saveWithUncertainties --name ElShapes --freezeParameters lumi_13TeV


python stack_postfit.py fitDiagnosticsMuShapes.root mu_sel_lj    --custom-bins --mu --ratio  --y-max 2500
python stack_postfit.py fitDiagnosticsMuShapes.root mu_sel_ljout --custom-bins --mu --ratio  --y-max 2500

python stack_postfit.py fitDiagnosticsElShapes.root el_sel_lj    --custom-bins --lumi 31.3 --ratio  --y-max 1500
python stack_postfit.py fitDiagnosticsElShapes.root el_sel_ljout --custom-bins --lumi 31.3 --ratio  --y-max 1500




# weight syst normalized to acceptance

## error while hadding a lot of files with all the weight systematics

hadd MC2016_Summer16_TTJets_powheg_Alpha_all.root v26r4/te*Alpha*

hadd MC2016_Summer16_TTJets_powheg_Mr_all.root v26r4/te*Mr*
hadd MC2016_Summer16_TTJets_powheg_Mf_all.root v26r4/te*Mf*

hadd MC2016_Summer16_TTJets_powheg_PDF_1.root v26r4/te*PDFCT14n1*
hadd MC2016_Summer16_TTJets_powheg_PDF_2.root v26r4/te*PDFCT14n2*
hadd MC2016_Summer16_TTJets_powheg_PDF_3.root v26r4/te*PDFCT14n3*
hadd MC2016_Summer16_TTJets_powheg_PDF_4.root v26r4/te*PDFCT14n4*
hadd MC2016_Summer16_TTJets_powheg_PDF_5.root v26r4/te*PDFCT14n5*
hadd MC2016_Summer16_TTJets_powheg_PDF_6.root v26r4/te*PDFCT14n[6789]*

hadd MC2016_Summer16_TTJets_powheg.root MC2016_Summer16_TTJets_powheg_Alpha_all.root MC2016_Summer16_TTJets_powheg_Mf_all.root MC2016_Summer16_TTJets_powheg_Mr_all.root MC2016_Summer16_TTJets_powheg_PDF_[123456].root


event_weight_me_f_rUp
event_weight_me_fUp_r
event_weight_me_frUp
event_weight_pdf

hadd distrs_v25pStage2Run3_2_updowns.root v25pStage2Run3/MC* v25r4/MC*

hadd distrs_v25pStage2Run3_2_updowns_weights.root v25pStage2Run3/MC* v25r4/MC* v26r4/MC2016_Summer16_TTJets_powheg.root

for sys_i, sys_w in enumerate([the_mc_weight] + w_scale + w_alphas + w_pdf):
[weights_gen_weight_f_rUp, weights_gen_weight_f_rDn, weights_gen_weight_fUp_r, weights_gen_weight_fDn_r, weights_gen_weight_frUp, weights_gen_weight_frDn]
[weights_gen_weight_alphas_up, weights_gen_weight_alphas_dn]
[round_pdf_weight(event.gen_weights_pdf_hessians[i] / weights_gen_weight_norm) for i in range(1,57)]

6
2
56




## acceptance norm

per-process aceptance changes in 2nd digit only by 1
in all channels but the signal, where the change is larger

python proc/print_acceptances.py temp/nominal.root --sys-weights
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.323      0.324      0.323      0.323      0.322      0.325      0.323      0.323      0.323      0.323      0.322      0.323      0.324      0.323      0.323      0.323      0.322      0.324      0.323      0.323      0.322      0.324      0.323      0.323      0.323      0.323      0.324      0.322      0.323      0.323      0.323      0.324      0.324      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.324      0.323      0.323      0.324      0.322      0.324      0.323      0.323      0.324      0.323      0.324      0.323      0.323      0.323      0.322      0.322      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
               eltau            0.294      0.297      0.301      0.300      0.300      0.297      0.302      0.300      0.300      0.300      0.300      0.299      0.299      0.300      0.299      0.300      0.300      0.299      0.301      0.300      0.300      0.299      0.301      0.300      0.300      0.300      0.300      0.301      0.299      0.300      0.299      0.299      0.300      0.300      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.299      0.300      0.299      0.299      0.301      0.299      0.301      0.300      0.300      0.300      0.299      0.299      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000

all procs:

$ python proc/print_acceptances.py temp/nominal.root --sys-weights --all-procs                                           
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.323      0.324      0.323      0.323      0.322      0.325      0.323      0.323      0.323      0.323      0.322      0.323      0.324      0.323      0.323      0.323      0.322      0.324      0.323      0.323      0.322      0.324      0.323      0.323      0.323      0.323      0.324      0.322      0.323      0.323      0.323      0.324      0.324      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.324      0.323      0.323      0.324      0.322      0.324      0.323      0.323      0.324      0.323      0.324      0.323      0.323      0.323      0.322      0.322      0.323      0.323      0.323      0.323      0.323      0.323      0.323      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
               eltau            0.294      0.297      0.301      0.300      0.300      0.297      0.302      0.300      0.300      0.300      0.300      0.299      0.299      0.300      0.299      0.300      0.300      0.299      0.301      0.300      0.300      0.299      0.301      0.300      0.300      0.300      0.300      0.301      0.299      0.300      0.299      0.299      0.300      0.300      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.300      0.299      0.300      0.299      0.299      0.301      0.299      0.301      0.300      0.300      0.300      0.299      0.299      0.299      0.300      0.300      0.300      0.300      0.300      0.300      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
                 muj            0.505      0.506      0.505      0.505      0.506      0.506      0.505      0.506      0.505      0.505      0.506      0.505      0.504      0.506      0.505      0.506      0.505      0.503      0.507      0.506      0.505      0.502      0.507      0.505      0.506      0.505      0.506      0.507      0.503      0.506      0.504      0.504      0.506      0.506      0.505      0.505      0.506      0.505      0.506      0.506      0.505      0.505      0.507      0.506      0.505      0.506      0.504      0.506      0.505      0.505      0.506      0.504      0.507      0.505      0.505      0.505      0.504      0.504      0.503      0.505      0.505      0.506      0.506      0.505      0.505      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
                 elj            0.486      0.486      0.487      0.486      0.486      0.486      0.486      0.486      0.486      0.486      0.486      0.485      0.485      0.487      0.485      0.486      0.485      0.484      0.488      0.487      0.486      0.483      0.488      0.486      0.486      0.486      0.486      0.488      0.484      0.486      0.485      0.485      0.487      0.487      0.485      0.486      0.486      0.486      0.486      0.486      0.486      0.486      0.487      0.486      0.486      0.487      0.485      0.486      0.486      0.485      0.487      0.485      0.487      0.486      0.486      0.485      0.485      0.485      0.484      0.486      0.486      0.487      0.486      0.486      0.486      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
           taumutauh            0.144      0.143      0.148      0.145      0.145      0.143      0.148      0.145      0.145      0.145      0.145      0.144      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.144      0.146      0.145      0.145      0.145      0.144      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.145      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
           taueltauh            0.098      0.097      0.098      0.096      0.098      0.096      0.099      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.098      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.098      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.098      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.097      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
              taumuj            0.191      0.192      0.190      0.192      0.191      0.193      0.189      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.191      0.191      0.191      0.192      0.192      0.191      0.191      0.192      0.191      0.191      0.191      0.191      0.192      0.191      0.192      0.191      0.191      0.192      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.191      0.192      0.191      0.192      0.191      0.191      0.192      0.191      0.192      0.191      0.191      0.191      0.191      0.191      0.191      0.191      0.191      0.192      0.192      0.191      0.192      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
              tauelj            0.160      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.162      0.164      0.163      0.163      0.163      0.162      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.163      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000
               other            0.028      0.028      0.029      0.028      0.029      0.028      0.029      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.028      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000      0.000

-- maybe some error in the signal?






check old full-signal study:

[olek@fermi05 proc]$ grep accept last_procs
# run for inlcuding updowns and scales in the fit, normalized to the acceptance
# first acceptance run
python genjobs.py v34 t1 --acceptance-study channels_nom_sys_both_sel_main --dtags MC2016_Summer16_TTJets_powheg,updowns,updowns_extra --scheme 5,5,2,12,12


python proc/print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root

python print_acceptances.py --sys-weights merge-sets/v34/t1/MC2016_Summer16_TTJets_powheg.root
INFO:root:import ROOT
INFO:root:done
               mutau            0.176      0.176      0.176      0.175      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.175      0.175      0.176      0.176      0.176      0.175      0.175      0.176      0.176      0.176      0.175      0.176      0.176      0.176      0.176      0.176      0.176      0.175      0.176      0.175      0.175      0.176      0.176      0.175      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.176      0.175      0.176      0.176
               eltau            0.169      0.169      0.169      0.168      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.168      0.168      0.169      0.169      0.169      0.169      0.168      0.169      0.169      0.169      0.168      0.169      0.169      0.169      0.169      0.169      0.169      0.168      0.169      0.168      0.168      0.169      0.169      0.168      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.169      0.168      0.169      0.169


-- very similar to all-proc result






## histosels

histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2
histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2

vim syst-test.syst-list.3
vim syst-test.syst-list.pdfs

histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/
histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/

source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2_weights_1 &
source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2_weights_2 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2_weights_1 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2_weights_2 &

hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root histosel-roots/v25pStage2Run3_el_ljs_updowns/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/distr*root

hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns_weights.root histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns_weights/distr*root


el alphas error

foreach sys (AlphaSUp AlphaSDown)
python stack_plot.py distrs_v25pStage2Run3_2_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/ --lumi 31300 -c el_sel_lj    -x el_selVloose_lj    -d Mt_lep_met_f --wjet 0.8    -s $sys || true
end

foreach sys (AlphaSUp AlphaSDown)
python stack_plot.py distrs_v25pStage2Run3_2_updowns_weights.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root  -o histosel-roots/v25pStage2Run3_el_ljs_updowns_weights/ --lumi 31300 -c el_sel_ljout -x el_selVloose_ljout -d Mt_lep_met_f --wjet 0.8    -s $sys || true
end

-- there was data-qcd and mc



combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root   --algo grid --points 60 --rMin 0.6 --rMax 1.4 --name MuShapes --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_el.root   --algo grid --points 32 --rMin 0.6 --rMax 1.4 --name ElShapes --freezeParameters lumi_13TeV
combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_both.root --algo grid --points 60 --rMin 0.6 --rMax 1.4 --name BothShapes --freezeParameters lumi_13TeV


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit               --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5        --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts.json                  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o postfit_mu_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit          --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5   --name ElImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeParameters lumi_13TeV  -m 125 -o latest_el_impacts.json             --name ElImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o postfit_el_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_both.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_both.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name BothImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_both.root --freezeParameters lumi_13TeV  -m 125 -o latest_both_impacts.json          --name BothImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_both_impacts.json -o postfit_both_impacts


python new_impact_table.py --merge-pdf latest_el_impacts.json
python new_impact_table.py --merge-pdf latest_mu_impacts.json
python new_impact_table.py --merge-pdf latest_both_impacts.json























# acceptances in all processes in all systematics

for dset in `cat dsets_tt_systs`
do
das_client --limit=2 --query="file dataset=$dset"
done | tee dsets_tt_systs_2file

das_client --limit=2 --query="file dataset=/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM" >> dsets_tt_systs_2file


export INFILE=/eos/user/o/otoldaie/TTJets_TuneCUETP8M2T4_13TeV-amcatnloFXFX-pythia8_366459FB-DFC5-E611-BE5E-D8D385AF8AE2.root
export DTAG=TTJets_amcatnlo
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_GluonMoveCRTune_13TeV-powheg-pythia8_B6EEA189-C940-E711-B6FB-E0071B6CAD00.root
export DTAG=TTJets_GluonMoveCRTune
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_QCDbasedCRTune_erdON_13TeV-powheg-pythia8_BE256AF2-B926-E711-A36C-A0369FD20608.root
export DTAG=TTJets_QCDbasedCRTune

export INFILE=/eos/user/o/otoldaie/TT_TuneEE5C_13TeV-powheg-herwigpp_6820BBE0-01B5-E611-85C8-002590E7E01A.root
export DTAG=TTJets_herwigpp'



export INFILE=/eos/user/o/otoldaie/TT_165F54A0-A3BE-E611-B3F7-0025905A606A.root
export DTAG=TTJets_NOMINAL
cmsRun python/ConfFile_cfg.py



export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8_3071D964-03B7-E611-98C4-B083FED18596.root
export DTAG=TTJets_FSRDown
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8_BE2542A8-C2D6-E611-BCB2-0CC47A6C0682.root
export DTAG=TTJets_FSRUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8_244A6BD6-CFB5-E611-98C3-008CFA16615C.root
export DTAG=TTJets_ISRDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8_14D0A1F0-A0BE-E611-BF78-FA163E795A09.root
export DTAG=TTJets_ISRUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8_B87402B7-52C0-E611-95D4-B8CA3A70A410.root
export DTAG=TTJets_TuneDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8_BAD9F05B-C6B6-E611-9C69-0023AEEEB226.root
export DTAG=TTJets_TuneUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8_F8364FC9-A5F2-E611-90F2-FA163E73666D.root
export DTAG=TTJets_HDAMPDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8_1EA7E8C9-C0F2-E611-85C3-FA163E65B77A.root
export DTAG=TTJets_HDAMPUp
cmsRun python/ConfFile_cfg.py


second batch

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/7C8A67E6-9ABE-E611-B3E7-0242AC130004.root
export DTAG=TTJets_NOMINAL_1
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/9031330B-9ABE-E611-BAF9-0242AC130002.root
export DTAG=TTJets_NOMINAL_2
cmsRun python/ConfFile_cfg.py


export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/9EAC0046-06B7-E611-AF76-141877411FED.root
export DTAG=TTJets_FSRDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root
export DTAG=TTJets_FSRUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/110000/005CF57C-CAB5-E611-862F-141877642ECF.root
export DTAG=TTJets_ISRDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext1-v1/70000/E0D51A37-A1BE-E611-A84E-02163E012FCB.root
export DTAG=TTJets_ISRUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/266CE88B-5FC0-E611-8C1C-0CC47A4C8EB6.root
export DTAG=TTJets_TuneDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/70000/1604C4FE-C9B6-E611-B524-0023AEEEB226.root
export DTAG=TTJets_TuneUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/4EBECEBC-AAF2-E611-8399-02163E013A79.root
export DTAG=TTJets_2_HDAMPDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/6CB65478-B7F2-E611-837A-FA163ED9F610.root
export DTAG=TTJets_2_HDAMPUp_2
cmsRun python/ConfFile_cfg.py






for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root     NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

without repetition now:

for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root     NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done


all_ev_mutau->GetBinContent(1)
all_ev_muj->GetBinContent(1)
all_ev_taumutauh->GetBinContent(1)
all_ev_taumuj->GetBinContent(1)

all_ev_eltau->GetBinContent(1)
all_ev_elj->GetBinContent(1)
all_ev_taueltauh->GetBinContent(1)
all_ev_tauelj->GetBinContent(1)

all_ev_other->GetBinContent(1)




python proc/print_acceptances.py temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root




second batch of files


for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

python proc/print_acceptances.py  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root

 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root


for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_FSRDown_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

python proc/print_acceptances.py  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root           temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root          temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root          temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_FSRDown_signal_recordAll.root    temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root



hadd nominal.root  init/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root init/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root init/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root

hadd HDAMPDown.root init/*HDAMPDown*.root 
hadd HDAMPUp.root   init/*HDAMPUp*.root 

hadd TuneDown.root  init/*TuneDown*.root 
hadd TuneUp.root    init/*TuneUp*.root 

hadd FSRDown.root  init/*FSRDown*.root 
hadd FSRUp.root    init/*FSRUp*.root 

hadd ISRDown.root  init/*ISRDown*.root 
hadd ISRUp.root    init/*ISRUp*.root 


python proc/print_acceptances.py  temp/nominal.root

python proc/print_acceptances.py  temp/init/*FSR*.root




python proc/print_acceptances.py temp/nominal.root temp/init/*FSRDown* temp/init/*FSRUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.337      0.345      0.320      0.309
               eltau            0.294      0.316      0.334      0.298      0.302
                 muj            0.505      0.513      0.508      0.492      0.486
                 elj            0.486      0.494      0.490      0.467      0.479
           taumutauh            0.144      0.116      0.111      0.135      0.072
           taueltauh            0.098      0.122      0.125      0.095      0.100
              taumuj            0.191      0.195      0.205      0.192      0.181
              tauelj            0.160      0.141      0.175      0.141      0.168
               other            0.028      0.030      0.028      0.027      0.027


python proc/print_acceptances.py temp/nominal.root temp/init/*ISRDown* temp/init/*ISRUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.336      0.328      0.302      0.309
               eltau            0.294      0.294      0.317      0.317      0.298
                 muj            0.505      0.499      0.499      0.503      0.513
                 elj            0.486      0.483      0.483      0.492      0.486
           taumutauh            0.144      0.149      0.155      0.132      0.119
           taueltauh            0.098      0.136      0.086      0.122      0.131
              taumuj            0.191      0.189      0.192      0.199      0.193
              tauelj            0.160      0.172      0.166      0.168      0.170
               other            0.028      0.028      0.028      0.030      0.030



python proc/print_acceptances.py temp/nominal.root temp/init/*HDAMPDown* temp/init/*HDAMPUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.302      0.336      0.337      0.328
               eltau            0.294      0.306      0.288      0.303      0.327
                 muj            0.505      0.499      0.503      0.510      0.507
                 elj            0.486      0.484      0.480      0.464      0.485
           taumutauh            0.144      0.139      0.154      0.076      0.135
           taueltauh            0.098      0.138      0.057      0.167      0.113
              taumuj            0.191      0.188      0.194      0.194      0.186
              tauelj            0.160      0.178      0.155      0.170      0.150
               other            0.028      0.025      0.028      0.030      0.029


python proc/print_acceptances.py temp/nominal.root temp/init/*TuneDown* temp/init/*TuneUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.327      0.334      0.325      0.308
               eltau            0.294      0.307      0.292      0.331      0.307
                 muj            0.505      0.503      0.508      0.511      0.507
                 elj            0.486      0.495      0.492      0.497      0.482
           taumutauh            0.144      0.136      0.132      0.073      0.113
           taueltauh            0.098      0.101      0.066      0.100      0.076
              taumuj            0.191      0.183      0.191      0.191      0.183
              tauelj            0.160      0.167      0.155      0.176      0.173
               other            0.028      0.028      0.027      0.030      0.030




python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*FSRDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*FSRUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*ISRDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*ISRUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*HDAMPDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*HDAMPUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*TuneDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*TuneUp*


FSR

               mutau       0.942866204619
               eltau       0.904832496014
                 muj       0.989867024467
                 elj       0.987626376095
           taumutauh       1.26952197002
           taueltauh       0.794519452559
              taumuj       0.952545290094
              tauelj       1.00932151419
               other       0.960638501667

               mutau       1.02270863374
               eltau       0.978752305853
                 muj       1.03305028026
                 elj       1.02787517806
           taumutauh       1.38979038245
           taueltauh       1.00813529447
              taumuj       1.021196958
              tauelj       1.03511748878
               other       1.03893634895

ISR

               mutau       0.969439993329
               eltau       0.962816353014
                 muj       1.01229346366
                 elj       1.00589450516
           taumutauh       0.946700623192
           taueltauh       0.884687918797
              taumuj       1.00079502107
              tauelj       0.944689165509
               other       1.00523958854

               mutau       1.05268377883
               eltau       0.954568837366
                 muj       0.994078810793
                 elj       0.994546897178
           taumutauh       1.14766291565
           taueltauh       0.773106238518
              taumuj       0.973559233887
              tauelj       0.944861104992
               other       0.952229026172

HDAMP

               mutau       1.00982009639
               eltau       0.98904717363
                 muj       1.00806668435
                 elj       1.00833128877
           taumutauh       0.978722128787
           taueltauh       1.00308679603
              taumuj       0.998311551561
              tauelj       0.96012282097
               other       1.04554624589

               mutau       0.967020783536
               eltau       0.933196123653
                 muj       0.993210779608
                 elj       1.02368791373
           taumutauh       1.36107953482
           taueltauh       0.702955720014
              taumuj       1.00474265151
              tauelj       1.00115091086
               other       0.9451016675

Tune

               mutau       0.973505498988
               eltau       0.980069401228
                 muj       0.998599918897
                 elj       0.984769512079
           taumutauh       1.07419894198
           taueltauh       1.17868224054
              taumuj       1.01979534213
              tauelj       0.993191192981
               other       1.02310781456

               mutau       1.01624297655
               eltau       0.92229220301
                 muj       0.992133811288
                 elj       0.993142123194
           taumutauh       1.5402070425
           taueltauh       1.11854729834
              taumuj       1.021249466
              tauelj       0.915446185028
               other       0.944953839721









trying to compare the acceptance variation to yield variation in the final selection

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                   mu_sel_lj     mu_sel_lj     mu_sel_lj     mu_sel_lj     mu_sel_lj                      mu_sel_ljout  mu_sel_ljout  mu_sel_ljout  mu_sel_ljout  mu_sel_ljout
                    tt_mutau         tt_lj      tt_taulj   tt_taultauh      tt_other                          tt_mutau         tt_lj      tt_taulj   tt_taultauh      tt_other
FSR              1.042/0.923   1.468/0.524   1.449/0.528   1.063/0.932   1.272/0.664  - - - - - - - - -    1.058/0.930   1.460/0.565   1.382/0.590   1.049/0.945   1.307/0.670
ISR              1.001/0.986   1.000/0.946   1.008/0.963   1.002/1.028   0.935/1.029  - - - - - - - - -    1.017/0.976   1.025/0.970   0.980/0.862   1.006/0.979   1.009/1.024
HDAMP            0.984/0.995   0.980/1.009   0.972/0.958   1.040/1.078   0.985/1.028  - - - - - - - - -    0.993/0.983   1.005/0.999   0.990/0.987   1.007/1.014   1.056/1.173
TuneCUETP8M2T4   0.994/0.978   1.001/0.984   1.037/0.947   0.999/1.054   1.016/0.977  - - - - - - - - -    1.003/0.996   1.044/0.986   0.990/0.971   1.002/0.963   1.083/1.015

FSR             lnN            1.042/0.923   1.468/0.524   1.449/0.528   1.063/0.932   1.272/0.664  - - - - - - - - -    1.058/0.930   1.460/0.565   1.382/0.590   1.049/0.945   1.307/0.670  - - - - - - - - -
ISR             lnN            1.001/0.986   1.000/0.946   1.008/0.963   1.002/1.028   0.935/1.029  - - - - - - - - -    1.017/0.976   1.025/0.970   0.980/0.862   1.006/0.979   1.009/1.024  - - - - - - - - -
HDAMP           lnN            0.984/0.995   0.980/1.009   0.972/0.958   1.040/1.078   0.985/1.028  - - - - - - - - -    0.993/0.983   1.005/0.999   0.990/0.987   1.007/1.014   1.056/1.173  - - - - - - - - -
TuneCUETP8M2T4  lnN            0.994/0.978   1.001/0.984   1.037/0.947   0.999/1.054   1.016/0.977  - - - - - - - - -    1.003/0.996   1.044/0.986   0.990/0.971   1.002/0.963   1.083/1.015  - - - - - - - - -



FSR             lnN   1.060/0.940  1.474/0.526  1.465/0.535  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.442/0.558 1.402/0.598 1.052/0.948 1.322/0.678   -
ISR             lnN   1.007/0.993  1.028/0.972  1.023/0.977  0.987/1.013  0.952/1.048  - - - - - - - - -   1.021/0.979 1.028/0.972 1.064/0.936 1.013/0.987 0.993/1.007   -
HDAMP           lnN   0.994/1.006  0.985/1.015  1.007/0.993  0.982/1.018  0.978/1.022  - - - - - - - - -   1.005/0.995 1.003/0.997 1.002/0.998 0.997/1.003 0.948/1.052   -
TuneCUETP8M2T4  lnN   1.008/0.992  1.009/0.991  1.045/0.955  0.973/1.027  1.019/0.981  - - - - - - - - -   1.003/0.997 1.029/0.971 1.009/0.991 1.020/0.980 1.032/0.968   -  

variation 3% FSR lj

FSR             lnN   1.060/0.940  1.43/0.54  1.42/0.55  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.39/0.58 1.35/0.62 1.052/0.948 1.322/0.678   -




same for electrons

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                                  tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other
FSR            lnN 1.050/0.954  1.491/0.540  1.487/0.566  1.060/0.962  1.184/0.684  - - - - - - - - -  1.082/0.945  1.506/0.573  1.501/0.548  1.097/0.862  1.374/0.721   - - - - - - - - -
ISR            lnN 1.019/0.993  1.027/0.968  0.961/0.989  1.005/1.025  0.920/0.932  - - - - - - - - -  1.030/0.997  1.033/0.985  1.135/0.961  0.998/0.945  1.098/1.068   - - - - - - - - -
HDAMP          lnN 1.017/1.018  1.013/0.998  1.014/0.981  0.947/1.063  0.775/0.975  - - - - - - - - -  1.014/1.023  1.030/1.035  1.039/1.178  1.038/1.001  1.106/1.119   - - - - - - - - -
TuneCUETP8M2T4 lnN 1.034/1.005  1.041/0.978  1.022/1.129  0.947/0.970  0.900/0.906  - - - - - - - - -  1.017/1.004  1.030/1.013  0.977/1.014  0.957/0.952  1.231/1.180   - - - - - - - - -


python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root --to-average -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj             el_sel_lj          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout          el_sel_ljout
                                  tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_eltau                 tt_lj              tt_taulj           tt_taultauh              tt_other
FSR            lnN 1.048/0.952 1.468/0.532 1.449/0.551 1.048/0.952 1.268/0.732  - - - - - - - - -           1.067/0.933 1.449/0.551 1.465/0.535 1.120/0.880 1.311/0.689  - - - - - - - - -
ISR            lnN 1.013/0.987 1.029/0.971 0.986/1.014 0.990/1.010 0.994/1.006  - - - - - - - - -           1.016/0.984 1.024/0.976 1.083/0.917 1.027/0.973 1.014/0.986  - - - - - - - - -
HDAMP          lnN 0.999/1.001 1.008/0.992 1.017/0.983 0.942/1.058 0.886/1.114  - - - - - - - - -           0.996/1.004 0.998/1.002 0.937/1.063 1.018/0.982 0.994/1.006  - - - - - - - - -
TuneCUETP8M2T4 lnN 1.014/0.986 1.032/0.968 0.950/1.050 0.988/1.012 0.996/1.004  - - - - - - - - -           1.007/0.993 1.008/0.992 0.981/1.019 1.003/0.997 1.021/0.979  - - - - - - - - -

the smaller FSR variation in signal, normalized by jet-based acceptance, not tau:

FSR            lnN 1.024/0.976 1.42/0.58   1.35/0.75   1.028/0.972 1.268/0.732  - - - - - - - - -           1.033/0.967 1.35/0.75   1.42/0.58   1.06/0.94   1.311/0.689  - - - - - - - - -

-- very reasonable looking (with LEPel reduced to 0.8)

the compromise:

FSR            lnN 1.03/0.97   1.42/0.58   1.35/0.75   1.02/0.98   1.268/0.732  - - - - - - - - -           1.04/0.96   1.35/0.75   1.42/0.58   1.07/0.93   1.311/0.689  - - - - - - - - -


-- effect of fsr+fakes a vit higher

mc stat 3.3%






old selection IDs:

time make distrs_mc_nominal dtag=TT p=pStage2Run3                      cond="selection_stage==105"  chan="mu_sel"    &
time make distrs_mc_nominal dtag=TT p=pStage2Run3 options="--el-procs" cond="selection_stage==115"  chan="el_sel" &

time make distrs_mc_updowns p=r4                      cond="selection_stage==105" chan="mu_sel" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115" chan="el_sel" &


hadd distrs/MC2016_Summer16_TTJets_powheg.root                distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*NOMINAL*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrup.root          distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*ISRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrdown.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*ISRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampUP.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*HDAMPUp*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampDOWN.root      distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*HDAMPDown*root           &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrup.root          distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*FSRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrdown.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*FSRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4up.root   distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Up*root    &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4down.root distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Down*root  &

hadd distrs_v25_pStage2Run3_r4_sel.root v25_pStage2Run3_r4_sel/MC*

python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_sel -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_sel -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                    mu_sel                mu_sel                mu_sel                mu_sel                mu_sel
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.065/0.904           1.483/0.527           1.068/0.916           1.440/0.539           1.311/0.651
                 ISR           1.009/0.983           1.009/0.958           1.003/1.002           0.996/0.926           0.980/1.029
               HDAMP           0.975/0.988           0.976/1.006           1.005/1.039           0.965/0.971           1.015/1.121
      TuneCUETP8M2T4           0.998/0.987           1.017/0.982           1.000/0.996           1.017/0.955           1.057/0.999

                                    el_sel                el_sel                el_sel                el_sel                el_sel
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.083/0.925           1.516/0.539           1.097/0.878           1.512/0.545           1.319/0.690
                 ISR           1.018/0.997           1.022/0.976           0.994/0.977           1.022/0.979           1.024/1.017
               HDAMP           1.003/1.021           1.008/1.013           0.992/1.025           1.012/1.059           0.970/1.065
      TuneCUETP8M2T4           1.021/1.002           1.034/0.990           0.951/0.957           1.002/1.082           1.103/1.075




more stats in Vloose:

time make distrs_mc_nominal dtag=TT nt=v26 p=r4                      cond="(selection_stage==105 || selection_stage==107)"  chan="mu_selVloose"    &
time make distrs_mc_nominal dtag=TT nt=v26 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)"  chan="el_selVloose" &

time make distrs_mc_updowns nt=v25 p=r4                      cond="(selection_stage==105 || selection_stage==107)" chan="mu_selVloose" &
time make distrs_mc_updowns nt=v25 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)" chan="el_selVloose" &

python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_selVloose -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_selVloose -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4


                              mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.051/0.914           1.421/0.564           1.058/0.923           1.416/0.562           1.292/0.650
                 ISR           1.004/0.987           1.004/0.977           0.998/1.008           1.002/0.964           0.978/1.026
               HDAMP           0.977/0.986           0.982/1.008           0.997/1.033           0.972/0.998           0.976/1.023
      TuneCUETP8M2T4           0.996/0.989           1.012/0.991           1.007/0.985           1.008/0.954           0.968/0.980

                              el_selVloose          el_selVloose          el_selVloose          el_selVloose          el_selVloose
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.072/0.934           1.425/0.562           1.097/0.906           1.414/0.572           1.350/0.669
                 ISR           1.015/1.001           1.007/0.975           1.004/0.985           1.006/0.984           0.989/1.022
               HDAMP           1.002/1.020           0.988/0.998           0.980/1.032           0.979/1.008           0.977/1.021
      TuneCUETP8M2T4           1.014/1.003           1.005/0.985           0.976/0.971           0.980/1.031           1.077/1.009


python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_selVloose -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4 --to-average
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_selVloose -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4 --to-average


                              mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.070/0.930           1.432/0.568           1.068/0.932           1.431/0.569           1.331/0.669
                 ISR           1.009/0.991           1.014/0.986           0.995/1.005           1.019/0.981           0.976/1.024
               HDAMP           0.995/1.005           0.987/1.013           0.983/1.017           0.987/1.013           0.977/1.023
      TuneCUETP8M2T4           1.004/0.996           1.011/0.989           1.011/0.989           1.028/0.972           0.994/1.006

                              el_selVloose          el_selVloose          el_selVloose          el_selVloose          el_selVloose
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.069/0.931           1.434/0.566           1.095/0.905           1.424/0.576           1.337/0.663
                 ISR           1.007/0.993           1.016/0.984           1.010/0.990           1.011/0.989           0.983/1.017
               HDAMP           0.991/1.009           0.995/1.005           0.975/1.025           0.986/1.014           0.978/1.022
      TuneCUETP8M2T4           1.005/0.995           1.010/0.990           1.002/0.998           0.975/1.025           1.033/0.967



lj out

FSR             lnN   1.060/0.940  1.474/0.526  1.465/0.535  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.442/0.558 1.402/0.598 1.052/0.948 1.322/0.678   -
ISR             lnN   1.007/0.993  1.028/0.972  1.023/0.977  0.987/1.013  0.952/1.048  - - - - - - - - -   1.021/0.979 1.028/0.972 1.064/0.936 1.013/0.987 0.993/1.007   -
HDAMP           lnN   0.994/1.006  0.985/1.015  1.007/0.993  0.982/1.018  0.978/1.022  - - - - - - - - -   1.005/0.995 1.003/0.997 1.002/0.998 0.997/1.003 0.948/1.052   -
TuneCUETP8M2T4  lnN   1.008/0.992  1.009/0.991  1.045/0.955  0.973/1.027  1.019/0.981  - - - - - - - - -   1.003/0.997 1.029/0.971 1.009/0.991 1.020/0.980 1.032/0.968   -  


Vloose copy

FSR             lnN   1.070/0.930  1.432/0.568  1.431/0.569  1.068/0.932  1.331/0.669  - - - - - - - - -     1.070/0.930  1.432/0.568  1.431/0.569  1.068/0.932  1.331/0.669 -        -     -     -        -     -        -     -        -
ISR             lnN   1.009/0.991  1.014/0.986  1.019/0.981  0.995/1.005  0.976/1.024  - - - - - - - - -     1.009/0.991  1.014/0.986  1.019/0.981  0.995/1.005  0.976/1.024 -        -     -     -        -     -        -     -        -
HDAMP           lnN   0.995/1.005  0.987/1.013  0.987/1.013  0.983/1.017  0.977/1.023  - - - - - - - - -     0.995/1.005  0.987/1.013  0.987/1.013  0.983/1.017  0.977/1.023 -        -     -     -        -     -        -     -        -
TuneCUETP8M2T4  lnN   1.004/0.996  1.011/0.989  1.028/0.972  1.011/0.989  0.994/1.006  - - - - - - - - -     1.004/0.996  1.011/0.989  1.028/0.972  1.011/0.989  0.994/1.006 -        -     -     -        -     -        -     -        -




Vloose lj out

python yield_variations.py distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_selVloose_lj -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c el_selVloose_lj -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4




python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_selVloose_lj,mu_selVloose_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c el_selVloose_lj,el_selVloose_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                           mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR           1.067/0.933           1.442/0.558           1.452/0.548           1.068/0.932           1.323/0.677           1.071/0.929           1.418/0.582           1.402/0.598           1.069/0.931           1.335/0.665
                 ISR           1.000/1.000           1.010/0.990           1.010/0.990           0.981/1.019           0.955/1.045           1.015/0.985           1.019/0.981           1.034/0.966           1.004/0.996           0.987/1.013
               HDAMP           0.984/1.016           0.987/1.013           0.982/1.018           0.978/1.022           0.965/1.035           1.002/0.998           0.987/1.013           0.994/1.006           0.986/1.014           0.983/1.017
      TuneCUETP8M2T4           1.004/0.996           1.006/0.994           1.043/0.957           0.984/1.016           0.994/1.006           1.004/0.996           1.017/0.983           1.005/0.995           1.029/0.971           0.994/1.006


[olek@fermi05 jobsums]$ python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR           1.079/0.921           1.489/0.511           1.480/0.520           1.085/0.915           1.331/0.669           1.084/0.916           1.457/0.543           1.417/0.583           1.071/0.929           1.339/0.661
                 ISR           1.005/0.995           1.025/0.975           1.021/0.979           0.985/1.015           0.950/1.050           1.018/0.982           1.025/0.975           1.062/0.938           1.011/0.989           0.990/1.010
               HDAMP           0.986/1.014           0.978/1.022           0.999/1.001           0.975/1.025           0.971/1.029           0.997/1.003           0.995/1.005           0.994/1.006           0.989/1.011           0.940/1.060
      TuneCUETP8M2T4           1.009/0.991           1.010/0.990           1.046/0.954           0.974/1.026           1.020/0.980           1.004/0.996           1.029/0.971           1.010/0.990           1.021/0.979           1.033/0.967




## test the old normalization

python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau -s FSR
python yield_variations.py --to-average histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau -s FSR






## full signal acecptances

















# download fsr up file

/store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root

xrdcp root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root  /eos/user/o/otoldaie/TT_FSRUp_50000_A2858033-C4D6-E611-BB70-0CC47AA989C4.root




# adding the updowns normalized to acceptance

time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_updowns p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_updowns p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

hadd distrs/MC2016_Summer16_TTJets_powheg_isrup.root          distrs/v25r4/*MC2016_Summer16_TTJets_powheg*ISRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrdown.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*ISRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampUP.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*HDAMPUp*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampDOWN.root      distrs/v25r4/*MC2016_Summer16_TTJets_powheg*HDAMPDown*root           &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrup.root          distrs/v25r4/*MC2016_Summer16_TTJets_powheg*FSRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrdown.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*FSRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4up.root   distrs/v25r4/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Up*root    &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4down.root distrs/v25r4/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Down*root  &

debuging:
the same yield in Vloose and main sel

time make distrs_mc_updowns p=r4 cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." --distr Mt_lep_met_f --chan mu_selVloose_lj --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight --sys ISRUp merge-sets/v25/r4/MC*TT*isrup*.root
python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "(selection_stage == 107) && event_jets_lj_var <= 60." --distr Mt_lep_met_f --chan mu_sel_lj --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight --sys ISRUp merge-sets/v25/r4/MC*TT*isrup*.root


root -l test1_lep_pt_MC2016_Summer16_TTJets_powheg_mu_selVloose_lj_tt_mutau_ISRUp_Mt_lep_met_f.root
mu_selVloose_lj->Get("tt_mutau/ISRUp/mu_selVloose_lj_tt_mutau_ISRUp_Mt_lep_met_f")->Print()

root -l test1_lep_pt_MC2016_Summer16_TTJets_powheg_mu_sel_lj_tt_mutau_ISRUp_Mt_lep_met_f.root
mu_sel_lj->Get("tt_mutau/ISRUp/mu_sel_lj_tt_mutau_ISRUp_Mt_lep_met_f")->Print()

--- update the selection sages 105 -> 107
vloose = 105+107 etc




signal acceptance normalization:
1. the acceptance study is done for signal process only -- for this only signal events were recorded
2. the kinematics and the acceptance probably changes for other processes too
   -- the best would be to normalize all of them separately?
      then each process would have the same number of events passing the kinematics
      (acceptance of each process = the same as nominal)
      and only the internals of jets, taus etc would be different, i.e. the effects on the efficiency
3. run test with normalization to signal



test normalization:

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s FSRUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s FSRDown


nominal
INFO:root:data   = 13558.000000
INFO:root:mc sum = 13379.059960 13379.059960

no accept norm:
INFO:root:mc sum = 11345.496707 11345.496707

all processes norm to signal:
INFO:root:mc sum = 11582.610917 11582.610917

and down:
INFO:root:mc sum = 15132.745839 15132.745839


qcd is taken from nominal ss:
DEBUG:root:data qcd for (Mt_lep_met_f, mu_sel_ljout_ss) Integral = 214.365973


acceptances per channel found in 1 file of nominal and 1 fsrdown:

cut_ev_elj->Divide( all_ev_elj )
cut_ev_taumuj->Divide( all_ev_taumuj )
cut_ev_eltau->Divide( all_ev_eltau )
cut_ev_tauelj->Divide( all_ev_tauelj )
cut_ev_mutau->Divide( all_ev_mutau )
cut_ev_taumutauh->Divide( all_ev_taumutauh )
cut_ev_other->Divide( all_ev_other )
cut_ev_taueltauh->Divide( all_ev_taueltauh )
cut_ev_muj->Divide( all_ev_muj )


cut_ev_eltau->GetBinContent(1)
cut_ev_elj->GetBinContent(1)
cut_ev_taueltauh->GetBinContent(1)
cut_ev_tauelj->GetBinContent(1)

cut_ev_mutau->GetBinContent(1)
cut_ev_muj->GetBinContent(1)
cut_ev_taumutauh->GetBinContent(1)
cut_ev_taumuj->GetBinContent(1)

cut_ev_other->GetBinContent(1)

nominal file (without tau requirement)

root [10] cut_ev_eltau->GetBinContent(1)
(Double_t) 0.315486
root [11] cut_ev_elj->GetBinContent(1)
(Double_t) 0.489868
root [12] cut_ev_taueltauh->GetBinContent(1)
(Double_t) 0.0902917
root [13] cut_ev_tauelj->GetBinContent(1)
(Double_t) 0.160139
root [14] 
root [14] cut_ev_mutau->GetBinContent(1)
(Double_t) 0.329758
root [15] cut_ev_muj->GetBinContent(1)
(Double_t) 0.506262
root [16] cut_ev_taumutauh->GetBinContent(1)
(Double_t) 0.150445
root [17] cut_ev_taumuj->GetBinContent(1)
(Double_t) 0.190607
root [18] 
root [18] cut_ev_other->GetBinContent(1)
(Double_t) 0.0273355

fsr down:

root [10] cut_ev_eltau->GetBinContent(1)
(Double_t) 0.316088
root [11] cut_ev_elj->GetBinContent(1)
(Double_t) 0.494020
root [12] cut_ev_taueltauh->GetBinContent(1)
(Double_t) 0.121670
root [13] cut_ev_tauelj->GetBinContent(1)
(Double_t) 0.141373
root [14] 
root [14] cut_ev_mutau->GetBinContent(1)
(Double_t) 0.337093
root [15] cut_ev_muj->GetBinContent(1)
(Double_t) 0.512832
root [16] cut_ev_taumutauh->GetBinContent(1)
(Double_t) 0.115956
root [17] cut_ev_taumuj->GetBinContent(1)
(Double_t) 0.195480
root [18] 
root [18] cut_ev_other->GetBinContent(1)
(Double_t) 0.0304838

tauel-tauh probably depend more on statistics

no significant difference between processes here


source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2 &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root histosel-roots/v25pStage2Run3_el_ljs_updowns/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/distr*root

and add updowns to datacard
and test fit NLL and impacts

NLL ok
impact from HRAMP is strangely large in both
it is large in el but not in mu
also in el jes is pulled and is 1st by impact, a little large than tau ID thanks to assymetry
top is not as much pulled and not so much impacts as without updowns

overall uncertainty:
el   11   % 
mu    9.2 %
both  8.6 %

python new_impact_table.py --merge-pdfs latest_el_impacts.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts.json 
python new_impact_table.py --merge-pdfs latest_both_impacts.json 

mc stats jumps much higher than before! 5% el 3% mu and 2.5% both!


test hdamp:

fit without hdamp

el   r :    +1.037   -0.103/+0.110 (68%)

mu   r :    +1.020   -0.095/+0.089 (68%)

python new_impact_table.py --merge-pdfs latest_el_impacts_noHDAMP.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts_noHDAMP.json 

MC stat el 3.1% mu 4% ???

[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_el_impacts_noHDAMP.json                                                                                                                                                            
        Tau ID efficiency  &  5.3 \\
         Jet Energy Scale  &  4.4 \\
        top quark $p_{T}$  &  4.2 \\
        QCD normalization  &  2.9 \\
      Pile-Up uncertainty  &  2.7 \\
     b-tagging efficiency  &  2.0 \\
    Jet Energy Resolution  &  1.7 \\
   Tau mis-ID probability  &  0.8 \\
 Single Top normalization  &  0.4 \\
         DY normalization  &  0.3 \\
   Dibosons normalization  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
               Luminosity  &  0.0 \\
     W+jets normalization  &  0.0 \\
                    LEPel  &  4.7 \\
          b fragmentation  &  3.3 \\
Underlying event (Pythia tune)  &  1.1 \\
  Initial State Radiation  &  0.9 \\
b decay tables, Semileptonic BR  &  0.7 \\
    Final State Radiation  &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.1 \\
[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_mu_impacts_noHDAMP.json
        Tau ID efficiency  &  5.4 \\
     b-tagging efficiency  &  4.5 \\
         Jet Energy Scale  &  4.3 \\
        top quark $p_{T}$  &  3.3 \\
      Pile-Up uncertainty  &  2.3 \\
   Tau mis-ID probability  &  2.1 \\
    Jet Energy Resolution  &  0.9 \\
 Single Top normalization  &  0.8 \\
     W+jets normalization  &  0.6 \\
         DY normalization  &  0.0 \\
   Dibosons normalization  &  0.0 \\
        QCD normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
          b fragmentation  &  2.2 \\
    Final State Radiation  &  1.6 \\
  Initial State Radiation  &  1.5 \\
                    LEPmu  &  0.5 \\
b decay tables, Semileptonic BR  &  0.5 \\
Underlying event (Pythia tune)  &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  4.0 \\



freeze all updowns

el    r :    +1.022   -0.123/+0.107 (68%)
mu    r :    +1.016   -0.086/+0.087 (68%)

python new_impact_table.py --merge-pdfs latest_el_impacts_noUpDowns.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts_noUpDowns.json 

[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_el_impacts_noUpDowns.json                                                                                                                                                                                                
        Tau ID efficiency  &  5.2 \\
         Jet Energy Scale  &  4.3 \\
      Pile-Up uncertainty  &  3.3 \\
        top quark $p_{T}$  &  3.3 \\
     b-tagging efficiency  &  2.3 \\
    Jet Energy Resolution  &  2.1 \\
   Tau mis-ID probability  &  2.0 \\
        QCD normalization  &  1.6 \\
 Single Top normalization  &  0.6 \\
         DY normalization  &  0.2 \\
     W+jets normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
                    LEPel  &  5.1 \\
          b fragmentation  &  2.8 \\
b decay tables, Semileptonic BR  &  0.7 \\
  Initial State Radiation  &  0.0 \\
    Final State Radiation  &  0.0 \\
   ME-PS matching (hdamp)  &  0.0 \\
Underlying event (Pythia tune)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.7 \\
[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_mu_impacts_noUpDowns.json
        Tau ID efficiency  &  5.8 \\
        top quark $p_{T}$  &  3.4 \\
     b-tagging efficiency  &  3.3 \\
   Tau mis-ID probability  &  3.2 \\
         Jet Energy Scale  &  2.6 \\
      Pile-Up uncertainty  &  2.2 \\
    Jet Energy Resolution  &  1.0 \\
 Single Top normalization  &  0.9 \\
     W+jets normalization  &  0.7 \\
         DY normalization  &  0.2 \\
   Dibosons normalization  &  0.0 \\
        QCD normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
          b fragmentation  &  2.1 \\
                    LEPmu  &  0.7 \\
b decay tables, Semileptonic BR  &  0.2 \\
  Initial State Radiation  &  0.0 \\
   ME-PS matching (hdamp)  &  0.0 \\
Underlying event (Pythia tune)  &  0.0 \\
    Final State Radiation  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.0 \\

-- also JES  too large?




and distrs:

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj    -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj    -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj   
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj    -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj    -s HDAMPDown

 -- as usual nothing is clear from the distrs




and the renorm-refact and pdf weights:

time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &


time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &



time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &






# baseline check

warning: tau sorting is broken!

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small nt=v25 proc=pStage2Run3
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v25 proc=pStage2Run3
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v25 proc=pStage2Run3

hadd merge-sets/v25/pStage2Run3/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v25/pStage2Run3/MC2016_Summer16_TTJets_powheg/*root


time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" dtag=SingleEle &

time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &





time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


VLoose shapes:

time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" dtag=SingleEle &

time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &


time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &



remake LEP systematics under different names

time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    sysname=LEPmu  &


time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout"   sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss"sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj"      sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss"   sysname=LEPel  &


time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    sysname=LEPmu  &


time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 117 && event_jets_lj_var > 60."  chan="el_sel_ljout"   sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss"sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 117 && event_jets_lj_var <= 60." chan="el_sel_lj"      sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"   sysname=LEPel  &




the updowns:

time make distrs_mc_updowns p=r4  cond="selection_stage==105 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_mc_updowns p=r4  cond="selection_stage==104 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_updowns p=r4  cond="selection_stage==105 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_mc_updowns p=r4  cond="selection_stage==104 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==114 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==114 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &

time make distrs_mc_updowns p=r4  cond="(selection_stage == 105 || selection_stage == 103) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 104 || selection_stage == 102) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 105 || selection_stage == 103) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 104 || selection_stage == 102) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 113) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 112) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 113) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 112) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3/*$d*root &
end

python stack_plot.py distrs_v25pStage2Run3.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj --qcd 1.05

python stack_plot.py distrs_v25pStage2Run3_2.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj --qcd 1.05 -x mu_selVloose_lj


source histosel_stage2_run3_VlooseShapes_el_sel_ljs &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root


python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --skip-procs wjets_tauh
python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --skip-procs wjets_tauh








# check if there are enough events in alliso QCD

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v27pStage2Run2ElMu/*$d*root &
end


and the fixed version 2:

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v27pStage2Run2ElMu2/*$d*root &
end





TH1D* h_mu    = (TH1D*) alliso_mu_sel   ->Get("qcd/NOMINAL/alliso_mu_sel_qcd_NOMINAL_relIso")
TH1D* h_mu_ss = (TH1D*) alliso_mu_sel_ss->Get("qcd/NOMINAL/alliso_mu_sel_ss_qcd_NOMINAL_relIso")

TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")

h_mu->Divide(h_mu_ss)
h_el->Divide(h_el_ss)

h_mu->Draw()
h_el->Draw()





and with no b-tau matching:

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v35 p=pStage2Run3   cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v35 p=pStage2Run3   cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v35 p=pStage2Run3  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v35 p=pStage2Run3  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v35pStage2Run3/*$d*root &
end





# pOld1 VS p2 comparison

git diff v20v21p2..HEAD -M -- support_channel_distrs.py proc/full_selection.py

seems like the only difference is counting b-taged jets without tau-matched jets
the result is ok in el-tau -- in pOld1 both data and MC have less events (weighted)
but in mu-tau pOld1 MC has _more_ events than p2 -- not clear how and in old framework cannot go through them one by one





# Run2 with WP and lj categories

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &



time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


lost data sel:

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5" chan="mu_sel"    &
time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" dtag=SingleEle &



foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run2/*$d*root &
end

test:

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root     -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f -p -r --qcd 1.05
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel    -d Mt_lep_met_f -p -r --qcd 1.05

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm -p -r
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm -p -r

muon

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm

electron

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm




source histosel-mu_stage2_mu_sel_ljs &
source histosel-el_stage2_el_sel_ljs &



hadd distrs_v25pStage2Run2_histosel_ljs.root histosel-roots/v25pStage2Run2_el_ljs/*root histosel-roots/v25pStage2Run2_mu_ljs/*root



python new_impact_table.py --merge-pdfs latest_el_impacts.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts.json 




very high MC stat uncertainty in electron+tau









# running it on Test5 to compare with Old1 distrs

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var > 60."  chan="mu_sel_ljout"     &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss"  &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj"        &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"     &

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj"       dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    dtag=SingleEle &

time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var > 60."  chan="mu_sel_ljout"     &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss"  &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj"        &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"     &

time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj"       &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Test5_ljs/*$d*root &
end


python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_lj    --qcd 1.05 --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_ljout --qcd 1.05 --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"

-- very few differences between the two, practically the same distributions

what's the reason problem? new b WP, custom bins, this smal divergence with Old1?


and muons:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel_lj    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02" --qcd 1.05
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel_ljout --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02" --qcd 1.05



old test

python stack_plot.py distrs_v25pStage2Test5.root ../distrs/pStage2Test5/test1_lep_pt_SingleMuon_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f 1.05 --bin-norm


again somewhere lost the data for test5_2 with linear bins

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5"  chan="mu_sel"  &

time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==15 && event_jets_lj_var <= 60."  chan="el_sel_lj"      dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==14 && event_jets_lj_var <= 60."  chan="el_sel_lj_ss"   dtag=SingleElectron &

finally:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"
python stack_plot.py distrs_v25pStage2Test5_2.root ../distrs/pStage2Test5_2_linear-bins/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f

-- kind of ok


el ljout in old1:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_ljout    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(e, MET)" -d Mt_lep_met_f --legend-shift "0.02"

and test5 2

python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f



# Run2 with updated b WP

1. custom bins?
2. muon and electron?
3. lj and ljout?
4. OS and SS

-- no lj and lj_out for now

muon:

time make distrs_data_nominal      p=pStage2Run2  &
time make distrs_mc_common_weights p=pStage2Run2  &
time make distrs_mc_objects        p=pStage2Run2  &
time make distrs_mc_tt_weights     p=pStage2Run2  &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &

electron:

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &



time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2  &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run2/*$d*root &
end

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2/test1_lep_pt_SingleMuon_mu_sel_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f --qcd 1.05 --bin-norm

electron

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel -d Mt_lep_met_f --qcd 1.05 --bin-norm




all distrs for test fit

source histosel-mu_stage2_mu_sel &
source histosel-el_stage2_el_sel &


./scripts/text2workspace.py ttxsec/fit-stuff/latest_datacard_mu.txt

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root --algo grid --points 100 --rMin 0.5 --rMax 1.5 --name MuShapes --freezeParameters lumi_13TeV

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts.json            --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o postfit_mu_impacts

table of systematics:

python new_impact_table.py --merge-pdfs latest_mu_impacts.json 








# All sys for MC and data in script files

time source all-distrs-from-stage2_data-nominals &
time source all-distrs-from-stage2_w-common-weight-variations &
time source all-distrs-from-stage2_w-common-weight-variations_tt-specific &
time source all-distrs-from-stage2_w-object-variations &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/Run1/*$d*root
end


time make distrs_mc_common_weights &
time make distrs_mc_objects        &
time make distrs_mc_tt_weights     &

time make distrs_mc_common_weights dtag=QCD  &
time make distrs_mc_common_weights dtag=WZ   &
time make distrs_mc_common_weights dtag=WW   &
time make distrs_mc_common_weights dtag=ZZ   &

time make distrs_mc_objects dtag=QCD  &
time make distrs_mc_objects dtag=WZ   &
time make distrs_mc_objects dtag=WW   &
time make distrs_mc_objects dtag=ZZ   &


compare Old1 to v25 pOld1
pStage2Test5

time make distrs_data_nominal      p=pStage2Test5 &
time make distrs_mc_common_weights p=pStage2Test5 &
time make distrs_mc_objects        p=pStage2Test5 &
time make distrs_mc_tt_weights     p=pStage2Test5 &

time make distrs_data_nominal      p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_tt_weights     p=pStage2Test5 bins="--histo-range 20,0,250" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/pStage2Test5/*$d*root &
end

python stack_plot.py distrs_v25pStage2Test5_2.root ../distrs/pStage2Test5/test1_lep_pt_SingleMuon_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f

VS

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"

the stage2test5-2 files contain the same amount of events as Old1
but there are less after distrs
test nominal tt distrs

python selections.py --out-dir distrs/ "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --distr Mt_lep_met_f --chan mu_sel --histo-range 20,0,250             --weight event_weight      merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --histo-range 20,0,250 --cond-com "event_weight * (selection_stage == 5 && (gen_proc_id == 31 || gen_proc_id == 32))" --output distrs//test1_lep_pt_MC2016_Summer16_TTJets_powheg_tt_mutau_NOMINAL_Mt_lep_met_f.root  --histo-name mu_sel/tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f  --save-weight --per-weight merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root







SS selection

time make distrs_data_nominal      p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &







issue with large error in dibosons

python selections.py --debug --out-dir distrs/ "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --distr Mt_lep_met_f --chan mu_sel --histo-range 20,0,250             --weight event_weight      merge-sets/v25/pStage2Test5/MC2016_Summer16_WWTo2L2Nu_powheg.root

-- fine
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &

time make distrs_mc_objects p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &

and hadd are fine

time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WW*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WW*" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WZ*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WZ*" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*ZZ*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*ZZ*" &


foreach d ( `cat all-dtags_dibosons` )
hadd distrs/$d.root distrs/pStage2Test5/*$d*root &
end


TH1D* h = (TH1D*) mu_sel->Get("dibosons/NOMINAL/mu_sel_dibosons_NOMINAL_Mt_lep_met_f")
h->GetBinError(2)
h->GetBinContent(2)

root -l distrs/pStage2Test5/test1_lep_pt_MC2016_Summer16_WWToLNuQQ_powheg_dibosons_NOMINAL_Mt_lep_met_f.root 

-- ok

root -l distrs/pStage2Test5_2_linear-bins/MC2016_Summer16_WWTo2L2Nu_powheg.root
root -l distrs/pStage2Test5_2_linear-bins/MC2016_Summer16_WWToLNuQQ_powheg.root

-- not ok

hadd dibosons1.root pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_[TJ]E[RS]* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_LEP* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_bSF* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_PU*

-- no NOMINAL here

TH1D* h = (TH1D*) mu_sel->Get("dibosons/PUUp/mu_sel_dibosons_PUUp_Mt_lep_met_f")
h->GetBinError(2)
h->GetBinContent(2)

-- ok

hadd dibosons1.root pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_[TJ]E[RS]* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_LEP* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_bSF* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_PU* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_NOMINAL_Mt_lep_met_f.root

-- ok


-- there were MC*[WW|WZ|ZZ] in the pStage5 dir














Mt of full run with stage

time python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "selection_stage == 5" --ttree ttree_out --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 14 seconds

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 1m13s

custom bins for selections
all selections in loop?

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 1m20s

all MC:

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC*.root

and data:

-- data failed, fixed, reran 1 job in 1m33s

also some QCD and WZ failed

MC2016_Summer16_WWToLNuQQ_powheg
MC2016_Summer16_WZTo3LNu_powheg

MC2016_Summer16_QCD_HT-1000-1500.root
MC2016_Summer16_QCD_HT-2000-Inf.root
MC2016_Summer16_QCD_HT-700-1000.root

source remaining_jobs_aa &
source remaining_jobs_ab &
source remaining_jobs_ac &
source remaining_jobs_ad &
source remaining_jobs_ae &
source remaining_jobs_af &
source remaining_jobs_ag &
source remaining_jobs_ah &
source remaining_jobs_ai &
source remaining_jobs_aj &
source remaining_jobs_ak &
source remaining_jobs_al &
source remaining_jobs_am &


# runs for tt systematics

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys TOPPTDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys TOPPTUp   --weight event_weight_toppt merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys LEPUp --weight event_weight_LEPUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys LEPDown --weight event_weight_LEPDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PUUp --weight event_weight_PUUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PUDown --weight event_weight_PUDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys FragUp --weight event_weight_FragUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys FragDown --weight event_weight_FragDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys SemilepBRUp --weight event_weight_SemilepBRUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys SemilepBRDown --weight event_weight_SemilepBRDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PetersonUp --weight event_weight_PetersonUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PetersonDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- in separate file, timed full run 19m14s, ok for now












the rebinning to 1 bin for cut-n-count MC statistics test

python rebin_to_one.py Mt_lep_met_f fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop_bin1.root
















redo electron osss

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 


final with all wjet/dy factors:

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --lumi 30000 --wjets 0.8 --factor-dy 1.05 --lumi-label 31300 --title "" --title-x "relative Isolation of electron" --y-range 0,1.2



muons

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 32800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2


and in v27

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 --y-range 0,1.4

-- last bin is a bit off

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleMuon.root          -o plots/paper-draft-1_an-version-3/ --lumi 34800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2

-- flat










python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 -c ctr_old_el_sel --qcd 1.05 --wjet 0.85 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "tau p_{T}"       -d tau_pt       --draw-overflows 2 --legend-shift "0.01"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 -c ctr_old_el_sel --qcd 1.05 --wjet 0.85 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(e, MET)"   -d Mt_lep_met_f --draw-overflows 5 --legend-shift "0.02"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel --qcd 1.05 --wjet 0.8  -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "tau p_{T}"       -d tau_pt       --draw-overflows 2 --legend-shift "0.01"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel --qcd 1.05 --wjet 0.8  -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --draw-overflows 5 --legend-shift "0.02"










tau

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "tau p_{T}" -d tau_pt
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "tau #eta"  -d tau_eta

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "tau p_{T}"  -d tau_pt
python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "tau #eta"   -d tau_eta

leptons

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "electron p_{T}" -d lep_pt
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "electron #eta"  -d lep_eta

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "muon p_{T}"  -d lep_pt
python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "muon #eta"   -d lep_eta

Mt

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel -x ctr_old_el_selVloose --qcd 1.05 --title "" --title-x "transverse mass M_{T}"  -d Mt_lep_met_f

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "transverse mass M_{T}"  -d Mt_lep_met_f

cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_lep_pt_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png  mu_sel_lep_pt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_lep_eta_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png mu_sel_lep_eta.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_lep_pt_ctr_old_el_sel_NOMINAL_stack_ratio_dataqcd.png  el_sel_lep_pt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_lep_eta_ctr_old_el_sel_NOMINAL_stack_ratio_dataqcd.png el_sel_lep_eta.png

cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_Mt_lep_met_f_ctr_old_el_sel_NOMINAL_stack_ratio_x_ctr_old_el_selVloose_dataqcd.png el_sel_Mt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_Mt_lep_met_f_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png mu_sel_Mt.png








# Mt VS eta and Mt with tau

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root


python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):event_leptons[0].eta()" --cond-com "selection_stage == 5 && gen_proc_id > 30" --histo-range 10,-2.5,2.5,20,0,250 --ttree ttree_out --output test_shapes_mutau.root --histo-name mt_lepeta_tt_mutau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):event_leptons[0].eta()" --cond-com "selection_stage == 5 && gen_proc_id < 30" --histo-range 10,-2.5,2.5,20,0,250 --ttree ttree_out --output test_shapes_notmutau.root --histo-name mt_lepeta_tt_notmutau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &


with tau

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_taus[0].Px()*event_taus[0].Px() + event_taus[0].Py()*event_taus[0].Py())) - (event_met.Px()*event_taus[0].Px() + event_met.Py()*event_taus[0].Py())))" --cond-com "selection_stage == 5 && gen_proc_id > 30" --histo-range 20,0,250,20,0,250    --ttree ttree_out --output test_shapes_mutau_mttau.root    --histo-name mt_lepeta_tt_mutau_mttau    merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_taus[0].Px()*event_taus[0].Px() + event_taus[0].Py()*event_taus[0].Py())) - (event_met.Px()*event_taus[0].Px() + event_met.Py()*event_taus[0].Py())))" --cond-com "selection_stage == 5 && gen_proc_id < 30" --histo-range 20,0,250,20,0,250 --ttree ttree_out --output test_shapes_notmutau_mttau.root --histo-name mt_lepeta_tt_notmutau_mttau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &


-- no clear distinction
maybe some correlation in mt-lep - mt-tau







# test of custom bins

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root





# test of nominal with full event weight

lep pt and Mt

python selections.py --debug "event_leptons[0].pt()" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test2/MC2016_Summer16_*root
python selections.py --debug "event_leptons[0].pt()" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test3/MC2016_Summer16_*root

python selections.py --debug "event_leptons[0].pt()" --weight "event_weight" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root

dalitzes in mutau, ljb and ljw

python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 24" --output test2_dalitzes_tt_ljb.root  --histo-name dalitzes_tt_ljb  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 23" --output test2_dalitzes_tt_ljw.root  --histo-name dalitzes_tt_ljw  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 22" --output test2_dalitzes_tt_ljo.root  --histo-name dalitzes_tt_ljo  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 32" --output test2_dalitzes_tt_mutau3ch.root  --histo-name dalitzes_tt_mutau3ch  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &



























# again event yields disagreement in pStage2Test3 (false alarm)

comparison with v25pF4 fails
in mu_sel TT lj

comparison betweeen Test2 (Tight tau ID) and v25pCheckTight3 worked

compare Test3 to both

lstore_outdirs/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root

lstore_outdirs/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root
lstore_outdirs/v26/pF4/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root

ctr_old_mu_sel->Get("tt_lj/NOMINAL/ctr_old_mu_sel_tt_lj_NOMINAL_yield")->Print()

v26pF4
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_yield, Entries= 189, Total sum= 172.785

v25pCheckTight3
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_yield, Entries= 120, Total sum= 109.168


Test3:
ttree_out->Draw("selection_stage", "selection_stage==5")
668

(none)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 21)")
42

(other = both w and b)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 22)")
0
(w)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 23)")
114
(b)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 24)")
33

ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 24 || gen_proc_id == 23 || gen_proc_id == 22 || gen_proc_id == 21)")
189


-- exact with v26pF4!


compare hadd-s
-- forgot Test3 TT hadd!

   [ hadd takes about 30 seconds ]

19784 events
19784 in v26pF4

all ok!

-- run selections on TT
   and lep_pt in lj:

root [2] ctr_old_mu_sel->Get("tt_lj/NOMINAL/ctr_old_mu_sel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_lep_pt, Entries= 19784, Total sum= 0.000251543

root [3] 0.000251543 * 831 * 35800
(double) 7483.35

all ok!





























shape of lep_pt and second lepton pt

python get_shapes.py --formula "ltaul : elmu " -d lep_pt -p tt_mutau -c ctr_mu_tt_em_close elmu:mc_v31v27_pAllElMu.root:,tt_elmu,NOMINAL ltaul:mc_v31v27_pAllElMu.root:,tt_ltaul,NOMINAL 

-- indeed slight difference even here


sumup and subleading lepton:

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() < lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_elmu_lep0_pt --output subleadlep_elmu_tt_elmu_lep0_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

python sumup_ttree_distrs.py "lep_p4[1].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() > lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_elmu_lep1_pt --output subleadlep_elmu_tt_elmu_lep1_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &


python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13*15) || (abs(gen_t_w_decay_id) == 13*15 && abs(gen_tb_w_decay_id) == 11) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() < lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_ltaul_lep0_pt --output subleadlep_elmu_tt_ltaul_lep0_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

python sumup_ttree_distrs.py "lep_p4[1].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13*15) || (abs(gen_t_w_decay_id) == 13*15 && abs(gen_tb_w_decay_id) == 11) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() > lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_ltaul_lep1_pt --output subleadlep_elmu_tt_ltaul_lep1_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

subleadlep_elmu_tt_elmu_lep0_pt->Scale(1./subleadlep_elmu_tt_elmu_lep0_pt->Integral())
subleadlep_elmu_tt_elmu_lep1_pt->Scale(1./subleadlep_elmu_tt_elmu_lep1_pt->Integral())

subleadlep_elmu_tt_ltaul_lep0_pt->Scale(1./subleadlep_elmu_tt_ltaul_lep0_pt->Integral())
subleadlep_elmu_tt_ltaul_lep1_pt->Scale(1./subleadlep_elmu_tt_ltaul_lep1_pt->Integral())



subleadlep_elmu_tt_ltaul_lep0_pt->SetLineColor(kRed)
subleadlep_elmu_tt_ltaul_lep1_pt->SetLineColor(kRed)


subleadlep_elmu_tt_ltaul_lep0_pt->Draw()
subleadlep_elmu_tt_ltaul_lep1_pt->Draw("same")

subleadlep_elmu_tt_ltaul_lep0_pt->Draw()
subleadlep_elmu_tt_elmu_lep0_pt ->Draw("same")

subleadlep_elmu_tt_ltaul_lep1_pt->Draw()
subleadlep_elmu_tt_elmu_lep1_pt ->Draw("same")


















shape of Mt with lep-jet

in TT

python jobsums/get_shapes.py --formula "reNOM : lepJet " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL lepJet:merge-sets/v25/pCheckTight4SubLep/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL 

-- pract no difference


run in Data
























testing autoMC 0 for MC stat uncertainty

produce post-fit distrs
check the uncertainties in bins

./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor.txt
./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor_no_autoMC.txt

combine -M FitDiagnostics ttxsec/fit-stuff/v25p2_mu_2_recor.root --saveShapes --saveWithUncertainties --name MuShapesTestWithAutoMC --freezeParameters lumi_13TeV

Best fit r: 0.959184  -0.0719329/+0.0876966  (68% CL)
Done in 0.24 min (cpu), 0.24 min (real)

combine -M FitDiagnostics ttxsec/fit-stuff/v25p2_mu_2_recor_no_autoMC.root --saveShapes --saveWithUncertainties --name MuShapesTestNoAutoMC --freezeParameters lumi_13TeV

Best fit r: 0.959184  -0.0719329/+0.0876966  (68% CL)


python stack_postfit.py fitDiagnosticsMuShapesTestWithAutoMC.root ctr_old_mu_sel_lj    --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestWithAutoMC.root ctr_old_mu_sel_ljout --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestNoAutoMC.root   ctr_old_mu_sel_lj    --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestNoAutoMC.root   ctr_old_mu_sel_ljout --mu --ratio 

root -l fitDiagnosticsMuShapesTestWithAutoMC.root

((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinContent(7)
(Double_t) 54.8818
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinError(7)
(Double_t) 7.46415

root -l fitDiagnosticsMuShapesTestNoAutoMC.root
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinContent(7)
(Double_t) 54.8818
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinError(7)
(Double_t) 7.46415



































continueing met phis

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL,Mt_lep_met_shifted 


python jobsums/get_shapes.py --formula "reNOM : shifted_reNOM " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL shifted_reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL,Mt_lep_met_shifted 

the shifts seem to correct bin 130,but not 120 (and not 140, which is not significant)
although not sure if the shift is large enough etc
(judging by the means of met x/y distrs it should be enough, but visually not sure)

finally the test of phi difference

!!! rev_met_phi !!!
-- did not work?
-- it just flips + to -

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d regMt_phi
python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d met_phi


merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root

./mc_v25v26pR5_updowns_HISTOSEL_regMt_phi_ctr_old_mu_sel_NOMINAL.root
./mc_v25v26pR5_updowns_HISTOSEL_met_phi_ctr_old_mu_sel_NOMINAL.root

ctr_old_mu_sel->Get("data/NOMINAL/ctr_old_mu_sel_data_NOMINAL_met_phi")
ctr_old_mu_sel->Get("sums_NOMINAL/mc_sum2_NOMINAL")

python flip_met_phi.py ./mc_v25v26pR5_updowns_HISTOSEL_met_phi_ctr_old_mu_sel_NOMINAL.root   output_met_phi.root
python flip_met_phi.py ./mc_v25v26pR5_updowns_HISTOSEL_regMt_phi_ctr_old_mu_sel_NOMINAL.root output_regMt_phi.root -d regMt_phi

flipped_mc->SetLineColor(kRed)
flipped_mc_2->SetLineColor(kRed)
flipped_mc_3->SetLineColor(kRed)
flipped_data->SetLineColor(kRed)


ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_mc->Draw("same")

ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_mc_2->Draw("same")

ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_data->Draw("same")

mc_sum2_NOMINAL->Draw()
flipped_mc_3->Draw("same")


ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_mc->Draw("same")

ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_mc_2->Draw("same")

ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_data->Draw("same")

-- seems like there is slight disagreement at positive phis in the sel (data>mc),
but in regMt it is leveled out, but slight disagreement (mc>data) apears at negative phis
as if data just moved down

there is slight asymetry in phi in data: more on positive side
no assymetry in mc

are there 2 minima in MC and omly 1 in data?

python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d met_phi -p -r --exp-leg

-- no, the #2 in MC is confusion due to zoomed scale and fluctuations and shift

the magnitude of the shift, the width seem equal in mc and data


python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d met_phi

python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d Mt_lep_met_shifted -p -r --exp-leg
-- the shift barely changes Mt in presel

python jobsums/get_shapes.py --formula "reNOM : shiftedMt" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL shiftedMt:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL,Mt_lep_met_shifted 

jet -> lep sub
Mt_lep_met_sublep

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d Mt_lep_met_sublep -p -r --exp-leg

-- same divergence in 120-130, but couple percent smaller

python get_shapes.py --formula "dataOut : dataVlooseOut" -d Mt_lep_met_f -p data -c ctr_old_mu_sel dataOut:../merge-sets/v25/pR5/SingleMuon.root:ctr_old_mu_sel_ljout,data,NOMINAL dataVlooseOut:../merge-sets/v25/pR5/SingleMuon.root:ctr_old_mu_selVloose_ljout,data,NOMINAL

-- data shape is from sel, but it should be right

-- in Vloose the bins seem to agree well, but data-qcd spoils the agreement a bit...
   and regMt_lep_pt seems much better, close to error bars and only 95 events more in MC
   in sel MC has 190 more events


compare shape to tight:

merge-sets/v25/pCheckTight/MC2016_Summer16_TTJets_powheg.root

python get_shapes.py --formula "mediumTau : tight : Vloose" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_sel mediumTau:mc_v25v26pR5_updowns.root:ctr_old_mu_sel,tt_mutau,NOMINAL Vloose:mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL tight:mc_norm/v25pCheckTight/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

-- same distr in all three selections





side check of nominal TES:

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d tau_cor_control -p -r --exp-leg

merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root

python jobsums/get_shapes.py --formula "reNOM : nomTES" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL nomTES:merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL 

python jobsums/get_shapes.py --formula "reNOM : nomTES" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL nomTES:merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL 

-- no difference
regMt_tau_pt has peak at 30 and fall by hyperbola










 compare to jet-tau substituted tt

python jobsums/get_shapes.py --formula "norm : subst" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL subst:merge-sets/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

python jobsums/get_shapes.py --formula "norm : subst" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL subst:merge-sets/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

compare data distr

python jobsums/get_shapes.py --formula "norm : subst" -d regMt_lep_pt -p data -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL subst:merge-sets/v25/pCheckTight3/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL

python jobsums/get_shapes.py --formula "norm : subst" -d Mt_lep_met_f -p data -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL subst:merge-sets/v25/pCheckTight3/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL





python jobsums/get_shapes.py --formula "data : 0.921 tt_mutau + 0.079 tt_lj" -d regMt_tau_jet_scale -p tt_mutau -c ctr_old_mu_sel data:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL tt_mutau:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL tt_lj:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_lj,NOMINAL








met phi stuff

python distr_ratios.py mc_v25v26pR5_updowns.root -c ctr_old_mu_sel -d met -p tt_mutau --var-distr met_pt_smallphi:met_pt_largephi

 --y-range 0.8,1.1 --add-x-line 40,130

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --qcd 1.05 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -p -r --exp-leg -d lep1_phi

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --qcd 1.05 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -p -r --exp-leg -d met_phi









Fit only ljout

./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.txt

combine -M MultiDimFit ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.txt --algo grid --points 100 --freezeNuisanceGroup tt_th_pdf --rMin 0.5 --rMax 1.5 --name MuShapesOnlyOut

-- 

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 -o v25p2_mu_2_recor_ljoutonly.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i v25p2_mu_2_recor_ljoutonly.json -o v25p2_mu_2_recor_ljoutonly








event weight fluctuations

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_lj -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_lj -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_ljout       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_ljout -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130


b weight fluctuations -- the fluctuations of b efficiencies are different in updown

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_ljout       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_ljout -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130















check norm and shapes of all proc in NOM VS FSR

results:
the yields are ok in all processes for FSR
this process did change them a little, maybe the shapes got shifted a bit,
but main issue with couple bins in mu selection is still there
(Vloose and main sel, in lj category and inclusive)

v25/pCheckNomFSR

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown



python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_taultauh,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_taultauh,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_taultauh,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_taultauh,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_taultauh,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_taultauh,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_taulj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_taulj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_taulj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_taulj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_taulj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_taulj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_other,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_other,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_other,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_other,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_other,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_other,FSRDown





problematic bins in inclusive sel and Vloose

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel,tt_mutau,FSRDown


no norm all chan in Vloose

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_taultauh,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_taultauh,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_taultauh,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_taultauh,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_taultauh,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_taultauh,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_taulj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_taulj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_taulj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_taulj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_taulj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_taulj,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_other,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_other,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_other,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_other,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_other,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_other,FSRDown














rateParams for ratio

dilep_norm              lnU         -              -              -              -              -              -              -              -              -              -              -              -              -              -     


rate_mutau              rateParam  mu   tt_mutau 13609.554

tau_ratio               param                    1.         0.1

./scripts/text2workspace.py ttxsec/fit-stuff/ratio_both_0.txt

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_0.txt --algo grid --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --saveSpecifiedNuis dilep_norm --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

--expectSignal 1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts.json -o latest_ratio_toys_asimov_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts_no_updowns.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts_no_updowns.json -o latest_ratio_toys_asimov_impacts_no_updowns

--setParameters tt_elmu=1.0,tt_mutau=1.0











../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts



python yield_variations.py -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj mc_v25v26pR5_updowns_with_data.root -c ctr_old_mu_sel_lj,ctr_old_mu_sel_ljout -d Mt_lep_met_f -s TuneCUETP8M2T4,FSR,ISR,HDAMP --to-average
INFO:root:import ROOT
                         ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj           tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
      TuneCUETP8M2T4           0.965/1.035           1.009/0.991           1.060/0.940           1.009/0.991           1.032/0.968           1.030/0.970           1.032/0.968           1.015/0.985           1.004/0.996           1.033/0.967
                 FSR           1.095/0.905           1.486/0.514           1.341/0.659           1.079/0.921           1.483/0.517           1.067/0.933           1.457/0.543           1.323/0.677           1.081/0.919           1.419/0.581
                 ISR           0.976/1.024           1.023/0.977           0.949/1.051           1.003/0.997           1.019/0.981           1.016/0.984           1.027/0.973           1.000/1.000           1.018/0.982           1.054/0.946
               HDAMP           0.963/1.037           0.981/1.019           0.955/1.045           0.979/1.021           1.007/0.993           0.994/1.006           0.992/1.008           0.933/1.067           1.001/0.999           0.969/1.031


python yield_variations.py -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj mc_v25p2_v26p2_updowns2_with_data.root -c ctr_old_el_sel_lj,ctr_old_el_sel_ljout -d Mt_lep_met_f -s TuneCUETP8M2T4,FSR,ISR,HDAMP --to-average
INFO:root:import ROOT
                         ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj           tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
      TuneCUETP8M2T4           1.015/0.985           1.036/0.964           1.009/0.991           1.013/0.987           0.963/1.037           0.986/1.014           1.006/0.994           1.014/0.986           1.005/0.995           0.974/1.026
                 FSR           1.077/0.923           1.480/0.520           1.325/0.675           1.065/0.935           1.456/0.544           1.119/0.881           1.461/0.539           1.318/0.682           1.084/0.916           1.478/0.522
                 ISR           0.999/1.001           1.026/0.974           0.969/1.031           1.002/0.998           0.996/1.004           1.023/0.977           1.022/0.978           1.010/0.990           1.013/0.987           1.053/0.947
               HDAMP           0.931/1.069           1.000/1.000           0.872/1.128           1.004/0.996           0.981/1.019           1.008/0.992           0.996/1.004           0.973/1.027           0.987/1.013           0.958/1.042






rate nuisances for updowns

muons

nominals

ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj
tt_taultauh              tt_lj                    tt_other                 tt_mutau                 tt_taulj         
3                        1                        4                        0                        2                
0.009                    0.107                    0.003                    0.147                    0.007            

ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     
tt_taultauh              tt_lj                    tt_other                 tt_mutau                 tt_taulj                 
3                        1                        4                        0                        2                        
0.017                    0.081                    0.006                    0.273                    0.005                    









testing the full selection of tt_mutau process

1) repeate the sumup in pyroot

python mu_sel_test.py mu_sel_test_nom.root      gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python mu_sel_test.py mu_sel_test_fsr_down.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &
python mu_sel_test.py mu_sel_test_fsr_up.root   gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &

2) add propper jets and tau selection (with anti-lepmatch)

3) add main weights (LEP, PU, bSF)




sumup mutau only
and compare with selection

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mutau_mu1t3j1b_leptaucuts_ttfsr_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mutau_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_mutau_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &

-- the fsr variations are weak

and in mujets (it should have larger effect from fsr)

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_muj_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_muj_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_muj_mu1t3j1b_leptaucuts_ttfsr_Mt   --output tt_muj_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_muj_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_muj_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &




rerun selection on nominal TT and FSR up-down
v25 pCheckNomFSR

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown



python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_lj,FSRDown &

compare nominal to the fit one:

python jobsums/get_shapes.py --formula "reNOM : NOMold " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL NOMold:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL 






same stuff with electrons

get_shapes:

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_lj NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : ISRUp : ISRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL ISRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,ISRUp ISRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,ISRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRDown

compare with full plot:

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_selVloose -d Mt_lep_met_f

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_sel_lj    -x ctr_old_el_selVloose_lj    -d Mt_lep_met_f
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_sel_ljout -x ctr_old_el_selVloose_ljout -d Mt_lep_met_f

full plot from fitting file:

../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root

python stack_plot.py ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root -p -r -c ctr_old_el_sel_lj    -d Mt_lep_met_f
python stack_plot.py ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root -p -r -c ctr_old_el_sel_ljout -d Mt_lep_met_f


and sumup:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name tt_el1t3j1b_leptaucuts_ttnom_Mt --output tt_el1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_el1t3j1b_leptaucuts_ttfsr_Mt --output tt_el1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_el1t3j1b_leptaucuts_ttfsrup_Mt --output tt_el1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &






add lep and tau pt cut:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name tt_mu1t3j1b_leptaucuts_ttnom_Mt --output tt_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_leptaucuts_ttfsr_Mt --output tt_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &







python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0" --histo-name tt_mu1t3j1b_ttnom_Mt --output tt_mu1t3j1b_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_ttfsr_Mt --output tt_mu1t3j1b_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_ttfsrup_Mt --output tt_mu1t3j1b_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &








python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 200,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) > 110" --histo-name tt_mu1t3j1b_ttnom_leppt --output tt_mu1t3j1b_ttnom_leppt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 200,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) > 110" --histo-name tt_mu1t3j1b_ttfsr_leppt --output tt_mu1t3j1b_ttfsr_leppt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &














python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown






python jobsums/get_shapes.py --no-norm --formula "NOM : ISRUp : ISRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL ISRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,ISRUp ISRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,ISRDown





python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown







python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,HDAMPDown








python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,TuneCUETP8M2T4Down




