# acceptances in all processes in all systematics

for dset in `cat dsets_tt_systs`
do
das_client --limit=2 --query="file dataset=$dset"
done | tee dsets_tt_systs_2file

das_client --limit=2 --query="file dataset=/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/RunIISummer16MiniAODv2-PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/MINIAODSIM" >> dsets_tt_systs_2file


export INFILE=/eos/user/o/otoldaie/TTJets_TuneCUETP8M2T4_13TeV-amcatnloFXFX-pythia8_366459FB-DFC5-E611-BE5E-D8D385AF8AE2.root
export DTAG=TTJets_amcatnlo
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_GluonMoveCRTune_13TeV-powheg-pythia8_B6EEA189-C940-E711-B6FB-E0071B6CAD00.root
export DTAG=TTJets_GluonMoveCRTune
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_QCDbasedCRTune_erdON_13TeV-powheg-pythia8_BE256AF2-B926-E711-A36C-A0369FD20608.root
export DTAG=TTJets_QCDbasedCRTune

export INFILE=/eos/user/o/otoldaie/TT_TuneEE5C_13TeV-powheg-herwigpp_6820BBE0-01B5-E611-85C8-002590E7E01A.root
export DTAG=TTJets_herwigpp'



export INFILE=/eos/user/o/otoldaie/TT_165F54A0-A3BE-E611-B3F7-0025905A606A.root
export DTAG=TTJets_NOMINAL
cmsRun python/ConfFile_cfg.py



export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8_3071D964-03B7-E611-98C4-B083FED18596.root
export DTAG=TTJets_FSRDown
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8_BE2542A8-C2D6-E611-BCB2-0CC47A6C0682.root
export DTAG=TTJets_FSRUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8_244A6BD6-CFB5-E611-98C3-008CFA16615C.root
export DTAG=TTJets_ISRDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8_14D0A1F0-A0BE-E611-BF78-FA163E795A09.root
export DTAG=TTJets_ISRUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8_B87402B7-52C0-E611-95D4-B8CA3A70A410.root
export DTAG=TTJets_TuneDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8_BAD9F05B-C6B6-E611-9C69-0023AEEEB226.root
export DTAG=TTJets_TuneUp
cmsRun python/ConfFile_cfg.py

export INFILE=/eos/user/o/otoldaie/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8_F8364FC9-A5F2-E611-90F2-FA163E73666D.root
export DTAG=TTJets_HDAMPDown
cmsRun python/ConfFile_cfg.py
export INFILE=/eos/user/o/otoldaie/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8_1EA7E8C9-C0F2-E611-85C3-FA163E65B77A.root
export DTAG=TTJets_HDAMPUp
cmsRun python/ConfFile_cfg.py


second batch

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/7C8A67E6-9ABE-E611-B3E7-0242AC130004.root
export DTAG=TTJets_NOMINAL_1
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/9031330B-9ABE-E611-BAF9-0242AC130002.root
export DTAG=TTJets_NOMINAL_2
cmsRun python/ConfFile_cfg.py


export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/80000/9EAC0046-06B7-E611-AF76-141877411FED.root
export DTAG=TTJets_FSRDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root
export DTAG=TTJets_FSRUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/110000/005CF57C-CAB5-E611-862F-141877642ECF.root
export DTAG=TTJets_ISRDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6_ext1-v1/70000/E0D51A37-A1BE-E611-A84E-02163E012FCB.root
export DTAG=TTJets_ISRUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/266CE88B-5FC0-E611-8C1C-0CC47A4C8EB6.root
export DTAG=TTJets_TuneDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/70000/1604C4FE-C9B6-E611-B524-0023AEEEB226.root
export DTAG=TTJets_TuneUp_2
cmsRun python/ConfFile_cfg.py

export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/4EBECEBC-AAF2-E611-8399-02163E013A79.root
export DTAG=TTJets_2_HDAMPDown_2
cmsRun python/ConfFile_cfg.py
export INFILE=root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/120000/6CB65478-B7F2-E611-837A-FA163ED9F610.root
export DTAG=TTJets_2_HDAMPUp_2
cmsRun python/ConfFile_cfg.py






for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root     NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

without repetition now:

for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root  NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root     NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root    NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done


all_ev_mutau->GetBinContent(1)
all_ev_muj->GetBinContent(1)
all_ev_taumutauh->GetBinContent(1)
all_ev_taumuj->GetBinContent(1)

all_ev_eltau->GetBinContent(1)
all_ev_elj->GetBinContent(1)
all_ev_taueltauh->GetBinContent(1)
all_ev_tauelj->GetBinContent(1)

all_ev_other->GetBinContent(1)




python proc/print_acceptances.py temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPDown_signal_recordAll.root  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_HDAMPUp_signal_recordAll.root    temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_signal_recordAll.root   temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrup_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrdown_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrup_signal_recordAll.root




second batch of files


for f in NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root
do
python proc/signal_acceptance.py temp/ $f --no-tau-cut
done

python proc/print_acceptances.py  temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root

 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_HDAMPUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_TuneDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_isrDown_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrUp_2_signal_recordAll.root
 temp/NtuplerAnalyzer_test_METfiltersOFF_TTJets_fsrDown_2_signal_recordAll.root

hadd nominal.root  init/NtuplerAnalyzer_test_METfiltersOFF_TTJets2_signal_recordAll.root init/NtuplerAnalyzer_test_METfiltersOFF_TTJets_1_signal_recordAll.root init/NtuplerAnalyzer_test_METfiltersOFF_TTJets_2_signal_recordAll.root

hadd HDAMPDown.root init/*HDAMPDown*.root 
hadd HDAMPUp.root   init/*HDAMPUp*.root 

hadd TuneDown.root  init/*TuneDown*.root 
hadd TuneUp.root    init/*TuneUp*.root 

hadd FSRDown.root  init/*FSRDown*.root 
hadd FSRUp.root    init/*FSRUp*.root 

hadd ISRDown.root  init/*ISRDown*.root 
hadd ISRUp.root    init/*ISRUp*.root 


python proc/print_acceptances.py  temp/nominal.root

python proc/print_acceptances.py  temp/init/*FSR*.root




python proc/print_acceptances.py temp/nominal.root temp/init/*FSRDown* temp/init/*FSRUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.337      0.345      0.320      0.309
               eltau            0.294      0.316      0.334      0.298      0.302
                 muj            0.505      0.513      0.508      0.492      0.486
                 elj            0.486      0.494      0.490      0.467      0.479
           taumutauh            0.144      0.116      0.111      0.135      0.072
           taueltauh            0.098      0.122      0.125      0.095      0.100
              taumuj            0.191      0.195      0.205      0.192      0.181
              tauelj            0.160      0.141      0.175      0.141      0.168
               other            0.028      0.030      0.028      0.027      0.027


python proc/print_acceptances.py temp/nominal.root temp/init/*ISRDown* temp/init/*ISRUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.336      0.328      0.302      0.309
               eltau            0.294      0.294      0.317      0.317      0.298
                 muj            0.505      0.499      0.499      0.503      0.513
                 elj            0.486      0.483      0.483      0.492      0.486
           taumutauh            0.144      0.149      0.155      0.132      0.119
           taueltauh            0.098      0.136      0.086      0.122      0.131
              taumuj            0.191      0.189      0.192      0.199      0.193
              tauelj            0.160      0.172      0.166      0.168      0.170
               other            0.028      0.028      0.028      0.030      0.030



python proc/print_acceptances.py temp/nominal.root temp/init/*HDAMPDown* temp/init/*HDAMPUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.302      0.336      0.337      0.328
               eltau            0.294      0.306      0.288      0.303      0.327
                 muj            0.505      0.499      0.503      0.510      0.507
                 elj            0.486      0.484      0.480      0.464      0.485
           taumutauh            0.144      0.139      0.154      0.076      0.135
           taueltauh            0.098      0.138      0.057      0.167      0.113
              taumuj            0.191      0.188      0.194      0.194      0.186
              tauelj            0.160      0.178      0.155      0.170      0.150
               other            0.028      0.025      0.028      0.030      0.029


python proc/print_acceptances.py temp/nominal.root temp/init/*TuneDown* temp/init/*TuneUp*
INFO:root:import ROOT
INFO:root:done
               mutau            0.322      0.327      0.334      0.325      0.308
               eltau            0.294      0.307      0.292      0.331      0.307
                 muj            0.505      0.503      0.508      0.511      0.507
                 elj            0.486      0.495      0.492      0.497      0.482
           taumutauh            0.144      0.136      0.132      0.073      0.113
           taueltauh            0.098      0.101      0.066      0.100      0.076
              taumuj            0.191      0.183      0.191      0.191      0.183
              tauelj            0.160      0.167      0.155      0.176      0.173
               other            0.028      0.028      0.027      0.030      0.030




python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*FSRDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*FSRUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*ISRDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*ISRUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*HDAMPDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*HDAMPUp*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*TuneDown*
python proc/print_acceptances.py --ratio temp/nominal.root temp/init/*TuneUp*


FSR

               mutau       0.942866204619
               eltau       0.904832496014
                 muj       0.989867024467
                 elj       0.987626376095
           taumutauh       1.26952197002
           taueltauh       0.794519452559
              taumuj       0.952545290094
              tauelj       1.00932151419
               other       0.960638501667

               mutau       1.02270863374
               eltau       0.978752305853
                 muj       1.03305028026
                 elj       1.02787517806
           taumutauh       1.38979038245
           taueltauh       1.00813529447
              taumuj       1.021196958
              tauelj       1.03511748878
               other       1.03893634895

ISR

               mutau       0.969439993329
               eltau       0.962816353014
                 muj       1.01229346366
                 elj       1.00589450516
           taumutauh       0.946700623192
           taueltauh       0.884687918797
              taumuj       1.00079502107
              tauelj       0.944689165509
               other       1.00523958854

               mutau       1.05268377883
               eltau       0.954568837366
                 muj       0.994078810793
                 elj       0.994546897178
           taumutauh       1.14766291565
           taueltauh       0.773106238518
              taumuj       0.973559233887
              tauelj       0.944861104992
               other       0.952229026172

HDAMP

               mutau       1.00982009639
               eltau       0.98904717363
                 muj       1.00806668435
                 elj       1.00833128877
           taumutauh       0.978722128787
           taueltauh       1.00308679603
              taumuj       0.998311551561
              tauelj       0.96012282097
               other       1.04554624589

               mutau       0.967020783536
               eltau       0.933196123653
                 muj       0.993210779608
                 elj       1.02368791373
           taumutauh       1.36107953482
           taueltauh       0.702955720014
              taumuj       1.00474265151
              tauelj       1.00115091086
               other       0.9451016675

Tune

               mutau       0.973505498988
               eltau       0.980069401228
                 muj       0.998599918897
                 elj       0.984769512079
           taumutauh       1.07419894198
           taueltauh       1.17868224054
              taumuj       1.01979534213
              tauelj       0.993191192981
               other       1.02310781456

               mutau       1.01624297655
               eltau       0.92229220301
                 muj       0.992133811288
                 elj       0.993142123194
           taumutauh       1.5402070425
           taueltauh       1.11854729834
              taumuj       1.021249466
              tauelj       0.915446185028
               other       0.944953839721









trying to compare the acceptance variation to yield variation in the final selection

python yield_variations.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                   mu_sel_lj     mu_sel_lj     mu_sel_lj     mu_sel_lj     mu_sel_lj                      mu_sel_ljout  mu_sel_ljout  mu_sel_ljout  mu_sel_ljout  mu_sel_ljout
                    tt_mutau         tt_lj      tt_taulj   tt_taultauh      tt_other                          tt_mutau         tt_lj      tt_taulj   tt_taultauh      tt_other
FSR              1.042/0.923   1.468/0.524   1.449/0.528   1.063/0.932   1.272/0.664  - - - - - - - - -    1.058/0.930   1.460/0.565   1.382/0.590   1.049/0.945   1.307/0.670
ISR              1.001/0.986   1.000/0.946   1.008/0.963   1.002/1.028   0.935/1.029  - - - - - - - - -    1.017/0.976   1.025/0.970   0.980/0.862   1.006/0.979   1.009/1.024
HDAMP            0.984/0.995   0.980/1.009   0.972/0.958   1.040/1.078   0.985/1.028  - - - - - - - - -    0.993/0.983   1.005/0.999   0.990/0.987   1.007/1.014   1.056/1.173
TuneCUETP8M2T4   0.994/0.978   1.001/0.984   1.037/0.947   0.999/1.054   1.016/0.977  - - - - - - - - -    1.003/0.996   1.044/0.986   0.990/0.971   1.002/0.963   1.083/1.015

FSR             lnN            1.042/0.923   1.468/0.524   1.449/0.528   1.063/0.932   1.272/0.664  - - - - - - - - -    1.058/0.930   1.460/0.565   1.382/0.590   1.049/0.945   1.307/0.670  - - - - - - - - -
ISR             lnN            1.001/0.986   1.000/0.946   1.008/0.963   1.002/1.028   0.935/1.029  - - - - - - - - -    1.017/0.976   1.025/0.970   0.980/0.862   1.006/0.979   1.009/1.024  - - - - - - - - -
HDAMP           lnN            0.984/0.995   0.980/1.009   0.972/0.958   1.040/1.078   0.985/1.028  - - - - - - - - -    0.993/0.983   1.005/0.999   0.990/0.987   1.007/1.014   1.056/1.173  - - - - - - - - -
TuneCUETP8M2T4  lnN            0.994/0.978   1.001/0.984   1.037/0.947   0.999/1.054   1.016/0.977  - - - - - - - - -    1.003/0.996   1.044/0.986   0.990/0.971   1.002/0.963   1.083/1.015  - - - - - - - - -



FSR             lnN   1.060/0.940  1.474/0.526  1.465/0.535  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.442/0.558 1.402/0.598 1.052/0.948 1.322/0.678   -
ISR             lnN   1.007/0.993  1.028/0.972  1.023/0.977  0.987/1.013  0.952/1.048  - - - - - - - - -   1.021/0.979 1.028/0.972 1.064/0.936 1.013/0.987 0.993/1.007   -
HDAMP           lnN   0.994/1.006  0.985/1.015  1.007/0.993  0.982/1.018  0.978/1.022  - - - - - - - - -   1.005/0.995 1.003/0.997 1.002/0.998 0.997/1.003 0.948/1.052   -
TuneCUETP8M2T4  lnN   1.008/0.992  1.009/0.991  1.045/0.955  0.973/1.027  1.019/0.981  - - - - - - - - -   1.003/0.997 1.029/0.971 1.009/0.991 1.020/0.980 1.032/0.968   -  



old selection IDs:

time make distrs_mc_nominal dtag=TT p=pStage2Run3                      cond="selection_stage==105"  chan="mu_sel"    &
time make distrs_mc_nominal dtag=TT p=pStage2Run3 options="--el-procs" cond="selection_stage==115"  chan="el_sel" &

time make distrs_mc_updowns p=r4                      cond="selection_stage==105" chan="mu_sel" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115" chan="el_sel" &


hadd distrs/MC2016_Summer16_TTJets_powheg.root                distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*NOMINAL*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrup.root          distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*ISRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrdown.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*ISRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampUP.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*HDAMPUp*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampDOWN.root      distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*HDAMPDown*root           &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrup.root          distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*FSRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrdown.root        distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*FSRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4up.root   distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Up*root    &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4down.root distrs/v25_pStage2Run3_r4_sel/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Down*root  &

hadd distrs_v25_pStage2Run3_r4_sel.root v25_pStage2Run3_r4_sel/MC*

python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_sel -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_sel -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                    mu_sel                mu_sel                mu_sel                mu_sel                mu_sel
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.065/0.904           1.483/0.527           1.068/0.916           1.440/0.539           1.311/0.651
                 ISR           1.009/0.983           1.009/0.958           1.003/1.002           0.996/0.926           0.980/1.029
               HDAMP           0.975/0.988           0.976/1.006           1.005/1.039           0.965/0.971           1.015/1.121
      TuneCUETP8M2T4           0.998/0.987           1.017/0.982           1.000/0.996           1.017/0.955           1.057/0.999

                                    el_sel                el_sel                el_sel                el_sel                el_sel
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.083/0.925           1.516/0.539           1.097/0.878           1.512/0.545           1.319/0.690
                 ISR           1.018/0.997           1.022/0.976           0.994/0.977           1.022/0.979           1.024/1.017
               HDAMP           1.003/1.021           1.008/1.013           0.992/1.025           1.012/1.059           0.970/1.065
      TuneCUETP8M2T4           1.021/1.002           1.034/0.990           0.951/0.957           1.002/1.082           1.103/1.075




more stats in Vloose:

time make distrs_mc_nominal dtag=TT nt=v26 p=r4                      cond="(selection_stage==105 || selection_stage==107)"  chan="mu_selVloose"    &
time make distrs_mc_nominal dtag=TT nt=v26 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)"  chan="el_selVloose" &

time make distrs_mc_updowns nt=v25 p=r4                      cond="(selection_stage==105 || selection_stage==107)" chan="mu_selVloose" &
time make distrs_mc_updowns nt=v25 p=r4 options="--el-procs" cond="(selection_stage==115 || selection_stage==117)" chan="el_selVloose" &

python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_selVloose -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_selVloose -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4


                              mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.051/0.914           1.421/0.564           1.058/0.923           1.416/0.562           1.292/0.650
                 ISR           1.004/0.987           1.004/0.977           0.998/1.008           1.002/0.964           0.978/1.026
               HDAMP           0.977/0.986           0.982/1.008           0.997/1.033           0.972/0.998           0.976/1.023
      TuneCUETP8M2T4           0.996/0.989           1.012/0.991           1.007/0.985           1.008/0.954           0.968/0.980

                              el_selVloose          el_selVloose          el_selVloose          el_selVloose          el_selVloose
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.072/0.934           1.425/0.562           1.097/0.906           1.414/0.572           1.350/0.669
                 ISR           1.015/1.001           1.007/0.975           1.004/0.985           1.006/0.984           0.989/1.022
               HDAMP           1.002/1.020           0.988/0.998           0.980/1.032           0.979/1.008           0.977/1.021
      TuneCUETP8M2T4           1.014/1.003           1.005/0.985           0.976/0.971           0.980/1.031           1.077/1.009


python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c mu_selVloose -p tt_mutau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4 --to-average
python yield_variations.py mc_norm/distrs_v25_pStage2Run3_r4_sel.root -d Mt_lep_met_f -c el_selVloose -p tt_eltau,tt_lj,tt_taultauh,tt_taulj,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4 --to-average


                              mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose          mu_selVloose
                                  tt_mutau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.070/0.930           1.432/0.568           1.068/0.932           1.431/0.569           1.331/0.669
                 ISR           1.009/0.991           1.014/0.986           0.995/1.005           1.019/0.981           0.976/1.024
               HDAMP           0.995/1.005           0.987/1.013           0.983/1.017           0.987/1.013           0.977/1.023
      TuneCUETP8M2T4           1.004/0.996           1.011/0.989           1.011/0.989           1.028/0.972           0.994/1.006

                              el_selVloose          el_selVloose          el_selVloose          el_selVloose          el_selVloose
                                  tt_eltau                 tt_lj           tt_taultauh              tt_taulj              tt_other
                 FSR           1.069/0.931           1.434/0.566           1.095/0.905           1.424/0.576           1.337/0.663
                 ISR           1.007/0.993           1.016/0.984           1.010/0.990           1.011/0.989           0.983/1.017
               HDAMP           0.991/1.009           0.995/1.005           0.975/1.025           0.986/1.014           0.978/1.022
      TuneCUETP8M2T4           1.005/0.995           1.010/0.990           1.002/0.998           0.975/1.025           1.033/0.967



lj out

FSR             lnN   1.060/0.940  1.474/0.526  1.465/0.535  1.066/0.934  1.314/0.686  - - - - - - - - -   1.065/0.935 1.442/0.558 1.402/0.598 1.052/0.948 1.322/0.678   -
ISR             lnN   1.007/0.993  1.028/0.972  1.023/0.977  0.987/1.013  0.952/1.048  - - - - - - - - -   1.021/0.979 1.028/0.972 1.064/0.936 1.013/0.987 0.993/1.007   -
HDAMP           lnN   0.994/1.006  0.985/1.015  1.007/0.993  0.982/1.018  0.978/1.022  - - - - - - - - -   1.005/0.995 1.003/0.997 1.002/0.998 0.997/1.003 0.948/1.052   -
TuneCUETP8M2T4  lnN   1.008/0.992  1.009/0.991  1.045/0.955  0.973/1.027  1.019/0.981  - - - - - - - - -   1.003/0.997 1.029/0.971 1.009/0.991 1.020/0.980 1.032/0.968   -  


Vloose copy

FSR             lnN   1.070/0.930  1.432/0.568  1.431/0.569  1.068/0.932  1.331/0.669  - - - - - - - - -     1.070/0.930  1.432/0.568  1.431/0.569  1.068/0.932  1.331/0.669 -        -     -     -        -     -        -     -        -
ISR             lnN   1.009/0.991  1.014/0.986  1.019/0.981  0.995/1.005  0.976/1.024  - - - - - - - - -     1.009/0.991  1.014/0.986  1.019/0.981  0.995/1.005  0.976/1.024 -        -     -     -        -     -        -     -        -
HDAMP           lnN   0.995/1.005  0.987/1.013  0.987/1.013  0.983/1.017  0.977/1.023  - - - - - - - - -     0.995/1.005  0.987/1.013  0.987/1.013  0.983/1.017  0.977/1.023 -        -     -     -        -     -        -     -        -
TuneCUETP8M2T4  lnN   1.004/0.996  1.011/0.989  1.028/0.972  1.011/0.989  0.994/1.006  - - - - - - - - -     1.004/0.996  1.011/0.989  1.028/0.972  1.011/0.989  0.994/1.006 -        -     -     -        -     -        -     -        -




Vloose lj out

python yield_variations.py distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_selVloose_lj -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c el_selVloose_lj -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4




python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_selVloose_lj,mu_selVloose_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4
python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c el_selVloose_lj,el_selVloose_ljout -p tt_eltau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                           mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj       mu_selVloose_lj    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout    mu_selVloose_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR           1.067/0.933           1.442/0.558           1.452/0.548           1.068/0.932           1.323/0.677           1.071/0.929           1.418/0.582           1.402/0.598           1.069/0.931           1.335/0.665
                 ISR           1.000/1.000           1.010/0.990           1.010/0.990           0.981/1.019           0.955/1.045           1.015/0.985           1.019/0.981           1.034/0.966           1.004/0.996           0.987/1.013
               HDAMP           0.984/1.016           0.987/1.013           0.982/1.018           0.978/1.022           0.965/1.035           1.002/0.998           0.987/1.013           0.994/1.006           0.986/1.014           0.983/1.017
      TuneCUETP8M2T4           1.004/0.996           1.006/0.994           1.043/0.957           0.984/1.016           0.994/1.006           1.004/0.996           1.017/0.983           1.005/0.995           1.029/0.971           0.994/1.006


[olek@fermi05 jobsums]$ python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau,tt_lj,tt_taulj,tt_taultauh,tt_other -s FSR,ISR,HDAMP,TuneCUETP8M2T4

                                 mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj             mu_sel_lj          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout          mu_sel_ljout
                                  tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other              tt_mutau                 tt_lj              tt_taulj           tt_taultauh              tt_other
                 FSR           1.079/0.921           1.489/0.511           1.480/0.520           1.085/0.915           1.331/0.669           1.084/0.916           1.457/0.543           1.417/0.583           1.071/0.929           1.339/0.661
                 ISR           1.005/0.995           1.025/0.975           1.021/0.979           0.985/1.015           0.950/1.050           1.018/0.982           1.025/0.975           1.062/0.938           1.011/0.989           0.990/1.010
               HDAMP           0.986/1.014           0.978/1.022           0.999/1.001           0.975/1.025           0.971/1.029           0.997/1.003           0.995/1.005           0.994/1.006           0.989/1.011           0.940/1.060
      TuneCUETP8M2T4           1.009/0.991           1.010/0.990           1.046/0.954           0.974/1.026           1.020/0.980           1.004/0.996           1.029/0.971           1.010/0.990           1.021/0.979           1.033/0.967




## test the old normalization

python yield_variations.py --to-average distrs_v25pStage2Run3_2_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau -s FSR
python yield_variations.py --to-average histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout -p tt_mutau -s FSR






## full signal acecptances

















# download fsr up file

/store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root

xrdcp root://xrootd-cms.infn.it//store/mc/RunIISummer16MiniAODv2/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/MINIAODSIM/PUMoriond17_80X_mcRun2_asymptotic_2016_TrancheIV_v6-v1/50000/A2858033-C4D6-E611-BB70-0CC47AA989C4.root  /eos/user/o/otoldaie/TT_FSRUp_50000_A2858033-C4D6-E611-BB70-0CC47AA989C4.root




# adding the updowns normalized to acceptance

time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_updowns p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_updowns p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

hadd distrs/MC2016_Summer16_TTJets_powheg_isrup.root          distrs/v25r4/*MC2016_Summer16_TTJets_powheg*ISRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_isrdown.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*ISRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampUP.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*HDAMPUp*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_hdampDOWN.root      distrs/v25r4/*MC2016_Summer16_TTJets_powheg*HDAMPDown*root           &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrup.root          distrs/v25r4/*MC2016_Summer16_TTJets_powheg*FSRUp*root               &
hadd distrs/MC2016_Summer16_TTJets_powheg_fsrdown.root        distrs/v25r4/*MC2016_Summer16_TTJets_powheg*FSRDown*root             &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4up.root   distrs/v25r4/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Up*root    &
hadd distrs/MC2016_Summer16_TTJets_powheg_CUETP8M2T4down.root distrs/v25r4/*MC2016_Summer16_TTJets_powheg*TuneCUETP8M2T4Down*root  &

debuging:
the same yield in Vloose and main sel

time make distrs_mc_updowns p=r4 cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_updowns p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." --distr Mt_lep_met_f --chan mu_selVloose_lj --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight --sys ISRUp merge-sets/v25/r4/MC*TT*isrup*.root
python selections.py  --out-dir distrs/  "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "(selection_stage == 107) && event_jets_lj_var <= 60." --distr Mt_lep_met_f --chan mu_sel_lj --custom-range 0,20,40,60,80,100,130,160,200,250 --weight event_weight --sys ISRUp merge-sets/v25/r4/MC*TT*isrup*.root


root -l test1_lep_pt_MC2016_Summer16_TTJets_powheg_mu_selVloose_lj_tt_mutau_ISRUp_Mt_lep_met_f.root
mu_selVloose_lj->Get("tt_mutau/ISRUp/mu_selVloose_lj_tt_mutau_ISRUp_Mt_lep_met_f")->Print()

root -l test1_lep_pt_MC2016_Summer16_TTJets_powheg_mu_sel_lj_tt_mutau_ISRUp_Mt_lep_met_f.root
mu_sel_lj->Get("tt_mutau/ISRUp/mu_sel_lj_tt_mutau_ISRUp_Mt_lep_met_f")->Print()

--- update the selection sages 105 -> 107
vloose = 105+107 etc




signal acceptance normalization:
1. the acceptance study is done for signal process only -- for this only signal events were recorded
2. the kinematics and the acceptance probably changes for other processes too
   -- the best would be to normalize all of them separately?
      then each process would have the same number of events passing the kinematics
      (acceptance of each process = the same as nominal)
      and only the internals of jets, taus etc would be different, i.e. the effects on the efficiency
3. run test with normalization to signal



test normalization:

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s FSRUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s FSRDown


nominal
INFO:root:data   = 13558.000000
INFO:root:mc sum = 13379.059960 13379.059960

no accept norm:
INFO:root:mc sum = 11345.496707 11345.496707

all processes norm to signal:
INFO:root:mc sum = 11582.610917 11582.610917

and down:
INFO:root:mc sum = 15132.745839 15132.745839


qcd is taken from nominal ss:
DEBUG:root:data qcd for (Mt_lep_met_f, mu_sel_ljout_ss) Integral = 214.365973


acceptances per channel found in 1 file of nominal and 1 fsrdown:

cut_ev_elj->Divide( all_ev_elj )
cut_ev_taumuj->Divide( all_ev_taumuj )
cut_ev_eltau->Divide( all_ev_eltau )
cut_ev_tauelj->Divide( all_ev_tauelj )
cut_ev_mutau->Divide( all_ev_mutau )
cut_ev_taumutauh->Divide( all_ev_taumutauh )
cut_ev_other->Divide( all_ev_other )
cut_ev_taueltauh->Divide( all_ev_taueltauh )
cut_ev_muj->Divide( all_ev_muj )


cut_ev_eltau->GetBinContent(1)
cut_ev_elj->GetBinContent(1)
cut_ev_taueltauh->GetBinContent(1)
cut_ev_tauelj->GetBinContent(1)

cut_ev_mutau->GetBinContent(1)
cut_ev_muj->GetBinContent(1)
cut_ev_taumutauh->GetBinContent(1)
cut_ev_taumuj->GetBinContent(1)

cut_ev_other->GetBinContent(1)

nominal file (without tau requirement)

root [10] cut_ev_eltau->GetBinContent(1)
(Double_t) 0.315486
root [11] cut_ev_elj->GetBinContent(1)
(Double_t) 0.489868
root [12] cut_ev_taueltauh->GetBinContent(1)
(Double_t) 0.0902917
root [13] cut_ev_tauelj->GetBinContent(1)
(Double_t) 0.160139
root [14] 
root [14] cut_ev_mutau->GetBinContent(1)
(Double_t) 0.329758
root [15] cut_ev_muj->GetBinContent(1)
(Double_t) 0.506262
root [16] cut_ev_taumutauh->GetBinContent(1)
(Double_t) 0.150445
root [17] cut_ev_taumuj->GetBinContent(1)
(Double_t) 0.190607
root [18] 
root [18] cut_ev_other->GetBinContent(1)
(Double_t) 0.0273355

fsr down:

root [10] cut_ev_eltau->GetBinContent(1)
(Double_t) 0.316088
root [11] cut_ev_elj->GetBinContent(1)
(Double_t) 0.494020
root [12] cut_ev_taueltauh->GetBinContent(1)
(Double_t) 0.121670
root [13] cut_ev_tauelj->GetBinContent(1)
(Double_t) 0.141373
root [14] 
root [14] cut_ev_mutau->GetBinContent(1)
(Double_t) 0.337093
root [15] cut_ev_muj->GetBinContent(1)
(Double_t) 0.512832
root [16] cut_ev_taumutauh->GetBinContent(1)
(Double_t) 0.115956
root [17] cut_ev_taumuj->GetBinContent(1)
(Double_t) 0.195480
root [18] 
root [18] cut_ev_other->GetBinContent(1)
(Double_t) 0.0304838

tauel-tauh probably depend more on statistics

no significant difference between processes here


source histosel_stage2_run3_VlooseShapes_el_sel_ljs_updowns2 &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs_updowns2 &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs_updowns.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root histosel-roots/v25pStage2Run3_el_ljs_updowns/distr*root histosel-roots/v25pStage2Run3_mu_ljs_updowns/distr*root

and add updowns to datacard
and test fit NLL and impacts

NLL ok
impact from HRAMP is strangely large in both
it is large in el but not in mu
also in el jes is pulled and is 1st by impact, a little large than tau ID thanks to assymetry
top is not as much pulled and not so much impacts as without updowns

overall uncertainty:
el   11   % 
mu    9.2 %
both  8.6 %

python new_impact_table.py --merge-pdfs latest_el_impacts.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts.json 
python new_impact_table.py --merge-pdfs latest_both_impacts.json 

mc stats jumps much higher than before! 5% el 3% mu and 2.5% both!


test hdamp:

fit without hdamp

el   r :    +1.037   -0.103/+0.110 (68%)

mu   r :    +1.020   -0.095/+0.089 (68%)

python new_impact_table.py --merge-pdfs latest_el_impacts_noHDAMP.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts_noHDAMP.json 

MC stat el 3.1% mu 4% ???

[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_el_impacts_noHDAMP.json                                                                                                                                                            
        Tau ID efficiency  &  5.3 \\
         Jet Energy Scale  &  4.4 \\
        top quark $p_{T}$  &  4.2 \\
        QCD normalization  &  2.9 \\
      Pile-Up uncertainty  &  2.7 \\
     b-tagging efficiency  &  2.0 \\
    Jet Energy Resolution  &  1.7 \\
   Tau mis-ID probability  &  0.8 \\
 Single Top normalization  &  0.4 \\
         DY normalization  &  0.3 \\
   Dibosons normalization  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
               Luminosity  &  0.0 \\
     W+jets normalization  &  0.0 \\
                    LEPel  &  4.7 \\
          b fragmentation  &  3.3 \\
Underlying event (Pythia tune)  &  1.1 \\
  Initial State Radiation  &  0.9 \\
b decay tables, Semileptonic BR  &  0.7 \\
    Final State Radiation  &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.1 \\
[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_mu_impacts_noHDAMP.json
        Tau ID efficiency  &  5.4 \\
     b-tagging efficiency  &  4.5 \\
         Jet Energy Scale  &  4.3 \\
        top quark $p_{T}$  &  3.3 \\
      Pile-Up uncertainty  &  2.3 \\
   Tau mis-ID probability  &  2.1 \\
    Jet Energy Resolution  &  0.9 \\
 Single Top normalization  &  0.8 \\
     W+jets normalization  &  0.6 \\
         DY normalization  &  0.0 \\
   Dibosons normalization  &  0.0 \\
        QCD normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
          b fragmentation  &  2.2 \\
    Final State Radiation  &  1.6 \\
  Initial State Radiation  &  1.5 \\
                    LEPmu  &  0.5 \\
b decay tables, Semileptonic BR  &  0.5 \\
Underlying event (Pythia tune)  &  0.4 \\
   ME-PS matching (hdamp)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  4.0 \\



freeze all updowns

el    r :    +1.022   -0.123/+0.107 (68%)
mu    r :    +1.016   -0.086/+0.087 (68%)

python new_impact_table.py --merge-pdfs latest_el_impacts_noUpDowns.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts_noUpDowns.json 

[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_el_impacts_noUpDowns.json                                                                                                                                                                                                
        Tau ID efficiency  &  5.2 \\
         Jet Energy Scale  &  4.3 \\
      Pile-Up uncertainty  &  3.3 \\
        top quark $p_{T}$  &  3.3 \\
     b-tagging efficiency  &  2.3 \\
    Jet Energy Resolution  &  2.1 \\
   Tau mis-ID probability  &  2.0 \\
        QCD normalization  &  1.6 \\
 Single Top normalization  &  0.6 \\
         DY normalization  &  0.2 \\
     W+jets normalization  &  0.1 \\
   Dibosons normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
                    LEPel  &  5.1 \\
          b fragmentation  &  2.8 \\
b decay tables, Semileptonic BR  &  0.7 \\
  Initial State Radiation  &  0.0 \\
    Final State Radiation  &  0.0 \\
   ME-PS matching (hdamp)  &  0.0 \\
Underlying event (Pythia tune)  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.7 \\
[olek@fermi01 CombinedLimit]$ python new_impact_table.py --merge-pdfs latest_mu_impacts_noUpDowns.json
        Tau ID efficiency  &  5.8 \\
        top quark $p_{T}$  &  3.4 \\
     b-tagging efficiency  &  3.3 \\
   Tau mis-ID probability  &  3.2 \\
         Jet Energy Scale  &  2.6 \\
      Pile-Up uncertainty  &  2.2 \\
    Jet Energy Resolution  &  1.0 \\
 Single Top normalization  &  0.9 \\
     W+jets normalization  &  0.7 \\
         DY normalization  &  0.2 \\
   Dibosons normalization  &  0.0 \\
        QCD normalization  &  0.0 \\
               Luminosity  &  0.0 \\
         Tau Energy Scale  &  0.0 \\
          b fragmentation  &  2.1 \\
                    LEPmu  &  0.7 \\
b decay tables, Semileptonic BR  &  0.2 \\
  Initial State Radiation  &  0.0 \\
   ME-PS matching (hdamp)  &  0.0 \\
Underlying event (Pythia tune)  &  0.0 \\
    Final State Radiation  &  0.0 \\
                      PDF  &  0.0 \\
            MC statistics  &  3.0 \\

-- also JES  too large?




and distrs:

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_ljout --qcd 1.05 -x mu_selVloose_ljout -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj    -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root     -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj    --qcd 1.05 -x mu_selVloose_lj    -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_ljout --qcd 1.05 -x el_selVloose_ljout -s HDAMPDown

python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj   
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj    -s HDAMPUp
python stack_plot.py distrs_v25pStage2Run3_2_updowns.root ../distrs/v25pStage2Run3_hadds/SingleElectron.root -o plots/ -p -r --lumi 31300 -d Mt_lep_met_f -c el_sel_lj    --qcd 1.05 -x el_selVloose_lj    -s HDAMPDown

 -- as usual nothing is clear from the distrs




and the renorm-refact and pdf weights:

time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_scale nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &


time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_alphas nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &



time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 116) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 117) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 104 || selection_stage == 106) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="(selection_stage == 105 || selection_stage == 107) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights_pdf nt=v26 p=r4 cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &






# baseline check

warning: tau sorting is broken!

make merge_proc dtags=merge-sets/jobs_hadd.dtags.small nt=v25 proc=pStage2Run3
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_aa nt=v25 proc=pStage2Run3
make merge_proc dtags=merge-sets/jobs_hadd.dtags.large_ab nt=v25 proc=pStage2Run3

hadd merge-sets/v25/pStage2Run3/MC2016_Summer16_TTJets_powheg.root lstore_outdirs/v25/pStage2Run3/MC2016_Summer16_TTJets_powheg/*root


time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_data_nominal      p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_mc_nominal        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" dtag=SingleEle &

time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==107 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_mc_common_weights p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="selection_stage==106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==117 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="selection_stage==116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


VLoose shapes:

time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_data_nominal      p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_mc_nominal        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" dtag=SingleEle &

time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_nominal        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &


time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60." chan="mu_selVloose_ljout" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60." chan="mu_selVloose_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj" &

time make distrs_mc_common_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss" &



time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60." chan="el_selVloose_ljout" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60." chan="el_selVloose_ljout_ss" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &

time make distrs_mc_common_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_objects        p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &



remake LEP systematics under different names

time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 107 || selection_stage == 105) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="(selection_stage == 106 || selection_stage == 104) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    sysname=LEPmu  &


time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var > 60."  chan="el_selVloose_ljout"   sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss"sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 117 || selection_stage == 115) && event_jets_lj_var <= 60." chan="el_selVloose_lj"      sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="(selection_stage == 116 || selection_stage == 114) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss"   sysname=LEPel  &


time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 107 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 106 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 107 && event_jets_lj_var <= 60." chan="mu_sel_lj"       sysname=LEPmu  &
time make distrs_mc_lep_weights p=pStage2Run3  cond="selection_stage == 106 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    sysname=LEPmu  &


time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 117 && event_jets_lj_var > 60."  chan="el_sel_ljout"   sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 116 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss"sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 117 && event_jets_lj_var <= 60." chan="el_sel_lj"      sysname=LEPel  &
time make distrs_mc_lep_weights p=pStage2Run3 options="--el-procs" cond="selection_stage == 116 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"   sysname=LEPel  &




the updowns:

time make distrs_mc_updowns p=r4  cond="selection_stage==105 && event_jets_lj_var > 60."  chan="mu_sel_ljout"    &
time make distrs_mc_updowns p=r4  cond="selection_stage==104 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss" &
time make distrs_mc_updowns p=r4  cond="selection_stage==105 && event_jets_lj_var <= 60." chan="mu_sel_lj"       &
time make distrs_mc_updowns p=r4  cond="selection_stage==104 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"    &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115 && event_jets_lj_var > 60."  chan="el_sel_ljout" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==114 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==115 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="selection_stage==114 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &

time make distrs_mc_updowns p=r4  cond="(selection_stage == 105 || selection_stage == 103) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout"    &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 104 || selection_stage == 102) && event_jets_lj_var > 60."  chan="mu_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 105 || selection_stage == 103) && event_jets_lj_var <= 60." chan="mu_selVloose_lj"       &
time make distrs_mc_updowns p=r4  cond="(selection_stage == 104 || selection_stage == 102) && event_jets_lj_var <= 60." chan="mu_selVloose_lj_ss"    &

time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 113) && event_jets_lj_var > 60."  chan="el_selVloose_ljout" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 112) && event_jets_lj_var > 60."  chan="el_selVloose_ljout_ss" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 115 || selection_stage == 113) && event_jets_lj_var <= 60." chan="el_selVloose_lj" &
time make distrs_mc_updowns p=r4 options="--el-procs" cond="(selection_stage == 114 || selection_stage == 112) && event_jets_lj_var <= 60." chan="el_selVloose_lj_ss" &




foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run3/*$d*root &
end

python stack_plot.py distrs_v25pStage2Run3.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj --qcd 1.05

python stack_plot.py distrs_v25pStage2Run3_2.root ../distrs/v25pStage2Run3_hadds/SingleMuon.root -o plots/ -p -r --lumi 35800 -d Mt_lep_met_f -c mu_sel_lj --qcd 1.05 -x mu_selVloose_lj


source histosel_stage2_run3_VlooseShapes_el_sel_ljs &
source histosel_stage2_run3_VlooseShapes_mu_sel_ljs &


hadd histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root histosel-roots/v25pStage2Run3_el_ljs/distr*root histosel-roots/v25pStage2Run3_mu_ljs/distr*root


python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root -d Mt_lep_met_f -c mu_sel_lj,mu_sel_ljout --skip-procs wjets_tauh
python numbers_for_datacard.py histosel-roots/HISTOSEL_v25pStage2Run3_Vloose_shape_el_mu_ljs.root -d Mt_lep_met_f -c el_sel_lj,el_sel_ljout --skip-procs wjets_tauh








# check if there are enough events in alliso QCD

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v27pStage2Run2ElMu/*$d*root &
end


and the fixed version 2:

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4."   nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v27 p=pStage2Run2ElMu2  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v27pStage2Run2ElMu2/*$d*root &
end





TH1D* h_mu    = (TH1D*) alliso_mu_sel   ->Get("qcd/NOMINAL/alliso_mu_sel_qcd_NOMINAL_relIso")
TH1D* h_mu_ss = (TH1D*) alliso_mu_sel_ss->Get("qcd/NOMINAL/alliso_mu_sel_ss_qcd_NOMINAL_relIso")

TH1D* h_el    = (TH1D*) alliso_el_sel   ->Get("qcd/NOMINAL/alliso_el_sel_qcd_NOMINAL_relIso")
TH1D* h_el_ss = (TH1D*) alliso_el_sel_ss->Get("qcd/NOMINAL/alliso_el_sel_ss_qcd_NOMINAL_relIso")

h_mu->Divide(h_mu_ss)
h_el->Divide(h_el_ss)

h_mu->Draw()
h_el->Draw()





and with no b-tau matching:

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v35 p=pStage2Run3   cond="selection_stage_tt_alliso==503" chan="alliso_mu_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.15,0.25,0.5,1.,2.,4." nt=v35 p=pStage2Run3   cond="selection_stage_tt_alliso==502" chan="alliso_mu_sel_ss" dtag="QCD" &

time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v35 p=pStage2Run3  cond="selection_stage_tt_alliso==513" chan="alliso_el_sel"    dtag="QCD" &
time make distrs_mc_nominal draw="event_leptons_alliso_reliso[0]" distr=relIso bins="--custom-range 0.,0.058,0.1,0.175,0.3,0.5" nt=v35 p=pStage2Run3  cond="selection_stage_tt_alliso==512" chan="alliso_el_sel_ss" dtag="QCD" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v35pStage2Run3/*$d*root &
end





# pOld1 VS p2 comparison

git diff v20v21p2..HEAD -M -- support_channel_distrs.py proc/full_selection.py

seems like the only difference is counting b-taged jets without tau-matched jets
the result is ok in el-tau -- in pOld1 both data and MC have less events (weighted)
but in mu-tau pOld1 MC has _more_ events than p2 -- not clear how and in old framework cannot go through them one by one





# Run2 with WP and lj categories

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var > 60." chan="mu_sel_ljout" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var > 60." chan="mu_sel_ljout_ss" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj" &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss" &



time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60." chan="el_sel_ljout" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60." chan="el_sel_ljout_ss" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss" &


lost data sel:

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==5" chan="mu_sel"    &
time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel"    dtag=SingleEle &
time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" dtag=SingleEle &



foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run2/*$d*root &
end

test:

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root     -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f -p -r --qcd 1.05
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel    -d Mt_lep_met_f -p -r --qcd 1.05

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm -p -r
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm -p -r

muon

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm

electron

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm




source histosel-mu_stage2_mu_sel_ljs &
source histosel-el_stage2_el_sel_ljs &



hadd distrs_v25pStage2Run2_histosel_ljs.root histosel-roots/v25pStage2Run2_el_ljs/*root histosel-roots/v25pStage2Run2_mu_ljs/*root



python new_impact_table.py --merge-pdfs latest_el_impacts.json 
python new_impact_table.py --merge-pdfs latest_mu_impacts.json 




very high MC stat uncertainty in electron+tau









# running it on Test5 to compare with Old1 distrs

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var > 60."  chan="mu_sel_ljout"     &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss"  &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj"        &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"     &

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj"       dtag=SingleEle &
time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    dtag=SingleEle &

time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var > 60."  chan="mu_sel_ljout"     &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var > 60."  chan="mu_sel_ljout_ss"  &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5 && event_jets_lj_var <= 60." chan="mu_sel_lj"        &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==4 && event_jets_lj_var <= 60." chan="mu_sel_lj_ss"     &

time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==15 && event_jets_lj_var <= 60." chan="el_sel_lj"       &
time make distrs_mc_nominal bins="--histo-range 20,0,250"  p=pStage2Test5 options="--el-procs" cond="selection_stage==14 && event_jets_lj_var <= 60." chan="el_sel_lj_ss"    &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Test5_ljs/*$d*root &
end


python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_lj    -d Mt_lep_met_f --qcd 1.05 --bin-norm
python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f --qcd 1.05 --bin-norm

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_lj    --qcd 1.05 --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_ljout --qcd 1.05 --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"

-- very few differences between the two, practically the same distributions

what's the reason problem? new b WP, custom bins, this smal divergence with Old1?


and muons:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel_lj    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02" --qcd 1.05
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel_ljout --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02" --qcd 1.05



old test

python stack_plot.py distrs_v25pStage2Test5.root ../distrs/pStage2Test5/test1_lep_pt_SingleMuon_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f 1.05 --bin-norm


again somewhere lost the data for test5_2 with linear bins

time make distrs_data_nominal bins="--histo-range 20,0,250"  p=pStage2Test5  cond="selection_stage==5"  chan="mu_sel"  &

time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==15 && event_jets_lj_var > 60."  chan="el_sel_ljout"    dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==14 && event_jets_lj_var > 60."  chan="el_sel_ljout_ss" dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==15 && event_jets_lj_var <= 60."  chan="el_sel_lj"      dtag=SingleElectron &
time make distrs_data_nominal bins="--histo-range 20,0,250" options="--el-procs" p=pStage2Test5  cond="selection_stage==14 && event_jets_lj_var <= 60."  chan="el_sel_lj_ss"   dtag=SingleElectron &

finally:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"
python stack_plot.py distrs_v25pStage2Test5_2.root ../distrs/pStage2Test5_2_linear-bins/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel    -d Mt_lep_met_f

-- kind of ok


el ljout in old1:

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root --lumi 31300 -c ctr_old_el_sel_ljout    --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(e, MET)" -d Mt_lep_met_f --legend-shift "0.02"

and test5 2

python stack_plot.py distrs_v25pStage2Test5_ljs.root ../distrs/v25pStage2Test5_ljs_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel_ljout -d Mt_lep_met_f



# Run2 with updated b WP

1. custom bins?
2. muon and electron?
3. lj and ljout?
4. OS and SS

-- no lj and lj_out for now

muon:

time make distrs_data_nominal      p=pStage2Run2  &
time make distrs_mc_common_weights p=pStage2Run2  &
time make distrs_mc_objects        p=pStage2Run2  &
time make distrs_mc_tt_weights     p=pStage2Run2  &

time make distrs_data_nominal      p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_objects        p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &

electron:

time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_data_nominal      p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" dtag=SingleEle &
time make distrs_mc_common_weights p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &
time make distrs_mc_objects        p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &



time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2  &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2  cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2 options="--el-procs" cond="selection_stage==15" chan="el_sel" &
time make distrs_mc_common_weights dtag="TTJet" p=pStage2Run2 options="--el-procs" cond="selection_stage==14" chan="el_sel_ss" &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/v25pStage2Run2/*$d*root &
end

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2/test1_lep_pt_SingleMuon_mu_sel_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleMuon.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f --qcd 1.05 --bin-norm

electron

python stack_plot.py distrs_v25pStage2Run2.root ../distrs/v25pStage2Run2_hadds/SingleElectron.root -p -r --lumi 31300 --wjet 0.8 -c el_sel -d Mt_lep_met_f --qcd 1.05 --bin-norm




all distrs for test fit

source histosel-mu_stage2_mu_sel &
source histosel-el_stage2_el_sel &


./scripts/text2workspace.py ttxsec/fit-stuff/latest_datacard_mu.txt

combine -M MultiDimFit ttxsec/fit-stuff/latest_datacard_mu.root --algo grid --points 100 --rMin 0.5 --rMax 1.5 --name MuShapes --freezeParameters lumi_13TeV

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doInitialFit         --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 --robustFit 1 --doFits --parallel 5  --name MuImpacts
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeParameters lumi_13TeV  -m 125 -o latest_mu_impacts.json            --name MuImpacts
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o postfit_mu_impacts

table of systematics:

python new_impact_table.py --merge-pdfs latest_mu_impacts.json 








# All sys for MC and data in script files

time source all-distrs-from-stage2_data-nominals &
time source all-distrs-from-stage2_w-common-weight-variations &
time source all-distrs-from-stage2_w-common-weight-variations_tt-specific &
time source all-distrs-from-stage2_w-object-variations &


foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/Run1/*$d*root
end


time make distrs_mc_common_weights &
time make distrs_mc_objects        &
time make distrs_mc_tt_weights     &

time make distrs_mc_common_weights dtag=QCD  &
time make distrs_mc_common_weights dtag=WZ   &
time make distrs_mc_common_weights dtag=WW   &
time make distrs_mc_common_weights dtag=ZZ   &

time make distrs_mc_objects dtag=QCD  &
time make distrs_mc_objects dtag=WZ   &
time make distrs_mc_objects dtag=WW   &
time make distrs_mc_objects dtag=ZZ   &


compare Old1 to v25 pOld1
pStage2Test5

time make distrs_data_nominal      p=pStage2Test5 &
time make distrs_mc_common_weights p=pStage2Test5 &
time make distrs_mc_objects        p=pStage2Test5 &
time make distrs_mc_tt_weights     p=pStage2Test5 &

time make distrs_data_nominal      p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" &
time make distrs_mc_tt_weights     p=pStage2Test5 bins="--histo-range 20,0,250" &

foreach d ( `cat all-dtags` )
hadd distrs/$d.root distrs/pStage2Test5/*$d*root &
end

python stack_plot.py distrs_v25pStage2Test5_2.root ../distrs/pStage2Test5/test1_lep_pt_SingleMuon_data_NOMINAL_Mt_lep_met_f.root -p -r --lumi 35800 --wjet 0.8 -c mu_sel -d Mt_lep_met_f

VS

python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root --lumi 35800 -c ctr_old_mu_sel --wjet 0.8 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --legend-shift "0.02"

the stage2test5-2 files contain the same amount of events as Old1
but there are less after distrs
test nominal tt distrs

python selections.py --out-dir distrs/ "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --distr Mt_lep_met_f --chan mu_sel --histo-range 20,0,250             --weight event_weight      merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --ttree ttree_out --histo-range 20,0,250 --cond-com "event_weight * (selection_stage == 5 && (gen_proc_id == 31 || gen_proc_id == 32))" --output distrs//test1_lep_pt_MC2016_Summer16_TTJets_powheg_tt_mutau_NOMINAL_Mt_lep_met_f.root  --histo-name mu_sel/tt_mutau/NOMINAL/mu_sel_tt_mutau_NOMINAL_Mt_lep_met_f  --save-weight --per-weight merge-sets/v25/pStage2Test5/MC2016_Summer16_TTJets_powheg.root







SS selection

time make distrs_data_nominal      p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &
time make distrs_mc_tt_weights     p=pStage2Test5 bins="--histo-range 20,0,250" cond="selection_stage==4" chan="mu_sel_ss" &







issue with large error in dibosons

python selections.py --debug --out-dir distrs/ "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --distr Mt_lep_met_f --chan mu_sel --histo-range 20,0,250             --weight event_weight      merge-sets/v25/pStage2Test5/MC2016_Summer16_WWTo2L2Nu_powheg.root

-- fine
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &

time make distrs_mc_objects p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WWTo2L2Nu*" &

and hadd are fine

time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WW*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WW*" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WZ*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*WZ*" &
time make distrs_mc_common_weights p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*ZZ*" &
time make distrs_mc_objects        p=pStage2Test5 bins="--histo-range 20,0,250" dtag="*ZZ*" &


foreach d ( `cat all-dtags_dibosons` )
hadd distrs/$d.root distrs/pStage2Test5/*$d*root &
end


TH1D* h = (TH1D*) mu_sel->Get("dibosons/NOMINAL/mu_sel_dibosons_NOMINAL_Mt_lep_met_f")
h->GetBinError(2)
h->GetBinContent(2)

root -l distrs/pStage2Test5/test1_lep_pt_MC2016_Summer16_WWToLNuQQ_powheg_dibosons_NOMINAL_Mt_lep_met_f.root 

-- ok

root -l distrs/pStage2Test5_2_linear-bins/MC2016_Summer16_WWTo2L2Nu_powheg.root
root -l distrs/pStage2Test5_2_linear-bins/MC2016_Summer16_WWToLNuQQ_powheg.root

-- not ok

hadd dibosons1.root pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_[TJ]E[RS]* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_LEP* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_bSF* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_PU*

-- no NOMINAL here

TH1D* h = (TH1D*) mu_sel->Get("dibosons/PUUp/mu_sel_dibosons_PUUp_Mt_lep_met_f")
h->GetBinError(2)
h->GetBinContent(2)

-- ok

hadd dibosons1.root pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_[TJ]E[RS]* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_LEP* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_bSF* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_PU* pStage2Test5/test1_lep_pt_MC2016_Summer16_WWTo2L2Nu_powheg_dibosons_NOMINAL_Mt_lep_met_f.root

-- ok


-- there were MC*[WW|WZ|ZZ] in the pStage5 dir














Mt of full run with stage

time python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "selection_stage == 5" --ttree ttree_out --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 14 seconds

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 1m13s

custom bins for selections
all selections in loop?

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- 1m20s

all MC:

time python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC*.root

and data:

-- data failed, fixed, reran 1 job in 1m33s

also some QCD and WZ failed

MC2016_Summer16_WWToLNuQQ_powheg
MC2016_Summer16_WZTo3LNu_powheg

MC2016_Summer16_QCD_HT-1000-1500.root
MC2016_Summer16_QCD_HT-2000-Inf.root
MC2016_Summer16_QCD_HT-700-1000.root

source remaining_jobs_aa &
source remaining_jobs_ab &
source remaining_jobs_ac &
source remaining_jobs_ad &
source remaining_jobs_ae &
source remaining_jobs_af &
source remaining_jobs_ag &
source remaining_jobs_ah &
source remaining_jobs_ai &
source remaining_jobs_aj &
source remaining_jobs_ak &
source remaining_jobs_al &
source remaining_jobs_am &


# runs for tt systematics

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys TOPPTDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys TOPPTUp   --weight event_weight_toppt merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys LEPUp --weight event_weight_LEPUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys LEPDown --weight event_weight_LEPDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PUUp --weight event_weight_PUUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PUDown --weight event_weight_PUDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys FragUp --weight event_weight_FragUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys FragDown --weight event_weight_FragDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys SemilepBRUp --weight event_weight_SemilepBRUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys SemilepBRDown --weight event_weight_SemilepBRDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root


python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PetersonUp --weight event_weight_PetersonUp merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

python selections.py --debug "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py())))" --cond-com "selection_stage == 5" --custom-range 1,20,40,60,80,100,130,160,200,250 --sys PetersonDown merge-sets/v25/pStage2Run1/MC2016_Summer16_TTJets_powheg.root

-- in separate file, timed full run 19m14s, ok for now












the rebinning to 1 bin for cut-n-count MC statistics test

python rebin_to_one.py Mt_lep_met_f fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop_bin1.root
















redo electron osss

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 


final with all wjet/dy factors:

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 30000 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --lumi 30000 --wjets 0.8 --factor-dy 1.05 --lumi-label 31300 --title "" --title-x "relative Isolation of electron" --y-range 0,1.2



muons

python stack_plot.py v23p1_mc.root ../merge-sets/v23/p1_data/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 32800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2


and in v27

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --osss -c ctr_old_el_presel_alliso -p -d lep_relIso_el --wjets 0.8 --factor-dy 1.05 --y-range 0,1.4

-- last bin is a bit off

python stack_plot.py mc_v27p1.root ../merge-sets/v27/p1/SingleMuon.root          -o plots/paper-draft-1_an-version-3/ --lumi 34800 --osss -c ctr_old_mu_presel_alliso -p -d lep_relIso --wjets 0.8 --factor-dy 1.05 --lumi-label 35800 --title "" --title-x "relative Isolation of muon" --y-range 0,1.2

-- flat










python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 -c ctr_old_el_sel --qcd 1.05 --wjet 0.85 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "tau p_{T}"       -d tau_pt       --draw-overflows 2 --legend-shift "0.01"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 -c ctr_old_el_sel --qcd 1.05 --wjet 0.85 -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(e, MET)"   -d Mt_lep_met_f --draw-overflows 5 --legend-shift "0.02"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel --qcd 1.05 --wjet 0.8  -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "tau p_{T}"       -d tau_pt       --draw-overflows 2 --legend-shift "0.01"
python stack_plot.py mc_v25pOld1.root ../merge-sets/v25/pOld1/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel --qcd 1.05 --wjet 0.8  -s NOMINAL --title "" -p -r --title-y "events/GeV" --title-x "M_{T}(#mu, MET)" -d Mt_lep_met_f --draw-overflows 5 --legend-shift "0.02"










tau

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "tau p_{T}" -d tau_pt
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "tau #eta"  -d tau_eta

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "tau p_{T}"  -d tau_pt
python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "tau #eta"   -d tau_eta

leptons

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "electron p_{T}" -d lep_pt
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel --qcd 1.05 --title "" --title-x "electron #eta"  -d lep_eta

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "muon p_{T}"  -d lep_pt
python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "muon #eta"   -d lep_eta

Mt

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root -o plots/paper-draft-1_an-version-3/ --lumi 31300 --wjet 0.85 --factor-dy 1.05 -p -r -c ctr_old_el_sel -x ctr_old_el_selVloose --qcd 1.05 --title "" --title-x "transverse mass M_{T}"  -d Mt_lep_met_f

python stack_plot.py mc_v25v26pR5.root ../merge-sets/v25/pR5/SingleMuon.root     -o plots/paper-draft-1_an-version-3/ --lumi 35800 -c ctr_old_mu_sel   --qcd 1.05 --wjet 0.8  -x ctr_old_mu_selVloose    -s NOMINAL --title "" -p -r --title-x "transverse mass M_{T}"  -d Mt_lep_met_f

cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_lep_pt_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png  mu_sel_lep_pt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_lep_eta_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png mu_sel_lep_eta.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_lep_pt_ctr_old_el_sel_NOMINAL_stack_ratio_dataqcd.png  el_sel_lep_pt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_lep_eta_ctr_old_el_sel_NOMINAL_stack_ratio_dataqcd.png el_sel_lep_eta.png

cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25p2_v26p2_updowns2_..,merge-sets,v25,p2,SingleElectron_Mt_lep_met_f_ctr_old_el_sel_NOMINAL_stack_ratio_x_ctr_old_el_selVloose_dataqcd.png el_sel_Mt.png
cp /home/alex/Documents/lip_phd/scrap/AN-v3_paper-draft-1/mc_v25v26pR5_..,merge-sets,v25,pR5,SingleMuon_Mt_lep_met_f_ctr_old_mu_sel_NOMINAL_stack_ratio_x_ctr_old_mu_selVloose_dataqcd.png mu_sel_Mt.png








# Mt VS eta and Mt with tau

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root


python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):event_leptons[0].eta()" --cond-com "selection_stage == 5 && gen_proc_id > 30" --histo-range 10,-2.5,2.5,20,0,250 --ttree ttree_out --output test_shapes_mutau.root --histo-name mt_lepeta_tt_mutau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):event_leptons[0].eta()" --cond-com "selection_stage == 5 && gen_proc_id < 30" --histo-range 10,-2.5,2.5,20,0,250 --ttree ttree_out --output test_shapes_notmutau.root --histo-name mt_lepeta_tt_notmutau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &


with tau

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_taus[0].Px()*event_taus[0].Px() + event_taus[0].Py()*event_taus[0].Py())) - (event_met.Px()*event_taus[0].Px() + event_met.Py()*event_taus[0].Py())))" --cond-com "selection_stage == 5 && gen_proc_id > 30" --histo-range 20,0,250,20,0,250    --ttree ttree_out --output test_shapes_mutau_mttau.root    --histo-name mt_lepeta_tt_mutau_mttau    merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_leptons[0].Px()*event_leptons[0].Px() + event_leptons[0].Py()*event_leptons[0].Py())) - (event_met.Px()*event_leptons[0].Px() + event_met.Py()*event_leptons[0].Py()))):sqrt(2*(sqrt((event_met.Px()*event_met.Px() + event_met.Py()*event_met.Py())*(event_taus[0].Px()*event_taus[0].Px() + event_taus[0].Py()*event_taus[0].Py())) - (event_met.Px()*event_taus[0].Px() + event_met.Py()*event_taus[0].Py())))" --cond-com "selection_stage == 5 && gen_proc_id < 30" --histo-range 20,0,250,20,0,250 --ttree ttree_out --output test_shapes_notmutau_mttau.root --histo-name mt_lepeta_tt_notmutau_mttau merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &


-- no clear distinction
maybe some correlation in mt-lep - mt-tau







# test of custom bins

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --custom-range 1,20,40,60,80,100,130,160,200,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root





# test of nominal with full event weight

lep pt and Mt

python selections.py --debug "event_leptons[0].pt()" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test2/MC2016_Summer16_*root
python selections.py --debug "event_leptons[0].pt()" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test3/MC2016_Summer16_*root

python selections.py --debug "event_leptons[0].pt()" --weight "event_weight" --cond-com "selection_stage == 5" --histo-range 50,0,200 merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root

dalitzes in mutau, ljb and ljw

python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 24" --output test2_dalitzes_tt_ljb.root  --histo-name dalitzes_tt_ljb  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 23" --output test2_dalitzes_tt_ljw.root  --histo-name dalitzes_tt_ljw  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 22" --output test2_dalitzes_tt_ljo.root  --histo-name dalitzes_tt_ljo  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &
python sumup_ttree_distrs.py "event_taus_sv_dalitz_m1:event_taus_sv_dalitz_m2" --ttree ttree_out --histo-range 20,0,2,20,0,2 --cond-com "selection_stage == 5 && gen_proc_id == 32" --output test2_dalitzes_tt_mutau3ch.root  --histo-name dalitzes_tt_mutau3ch  --save-weight --per-weight merge-sets/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg.root &



























# again event yields disagreement in pStage2Test3 (false alarm)

comparison with v25pF4 fails
in mu_sel TT lj

comparison betweeen Test2 (Tight tau ID) and v25pCheckTight3 worked

compare Test3 to both

lstore_outdirs/v25/pStage2Test3/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root

lstore_outdirs/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root
lstore_outdirs/v26/pF4/MC2016_Summer16_TTJets_powheg/MC2016_Summer16_TTJets_powheg_61.root

ctr_old_mu_sel->Get("tt_lj/NOMINAL/ctr_old_mu_sel_tt_lj_NOMINAL_yield")->Print()

v26pF4
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_yield, Entries= 189, Total sum= 172.785

v25pCheckTight3
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_yield, Entries= 120, Total sum= 109.168


Test3:
ttree_out->Draw("selection_stage", "selection_stage==5")
668

(none)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 21)")
42

(other = both w and b)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 22)")
0
(w)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 23)")
114
(b)
ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 24)")
33

ttree_out->Draw("selection_stage", "selection_stage==5 && (gen_proc_id == 24 || gen_proc_id == 23 || gen_proc_id == 22 || gen_proc_id == 21)")
189


-- exact with v26pF4!


compare hadd-s
-- forgot Test3 TT hadd!

   [ hadd takes about 30 seconds ]

19784 events
19784 in v26pF4

all ok!

-- run selections on TT
   and lep_pt in lj:

root [2] ctr_old_mu_sel->Get("tt_lj/NOMINAL/ctr_old_mu_sel_tt_lj_NOMINAL_lep_pt")->Print()
TH1.Print Name  = ctr_old_mu_sel_tt_lj_NOMINAL_lep_pt, Entries= 19784, Total sum= 0.000251543

root [3] 0.000251543 * 831 * 35800
(double) 7483.35

all ok!





























shape of lep_pt and second lepton pt

python get_shapes.py --formula "ltaul : elmu " -d lep_pt -p tt_mutau -c ctr_mu_tt_em_close elmu:mc_v31v27_pAllElMu.root:,tt_elmu,NOMINAL ltaul:mc_v31v27_pAllElMu.root:,tt_ltaul,NOMINAL 

-- indeed slight difference even here


sumup and subleading lepton:

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() < lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_elmu_lep0_pt --output subleadlep_elmu_tt_elmu_lep0_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

python sumup_ttree_distrs.py "lep_p4[1].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() > lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_elmu_lep1_pt --output subleadlep_elmu_tt_elmu_lep1_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &


python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13*15) || (abs(gen_t_w_decay_id) == 13*15 && abs(gen_tb_w_decay_id) == 11) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() < lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_ltaul_lep0_pt --output subleadlep_elmu_tt_ltaul_lep0_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

python sumup_ttree_distrs.py "lep_p4[1].pt()" --histo-range 50,0.,200. --cond-com "((abs(gen_t_w_decay_id) == 11 && abs(gen_tb_w_decay_id) == 13*15) || (abs(gen_t_w_decay_id) == 13*15 && abs(gen_tb_w_decay_id) == 11) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15) || (abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 11*15)) && leps_ID == -13*11 && HLT_mu && lep_matched_HLT[0] && no_iso_veto_leps && lep_p4[0].pt() > 30 && abs(lep_p4[0].eta()) < 2.4 && lep_p4[1].pt() > 30 && abs(lep_p4[1].eta()) < 2.4 && lep_p4[0].pt() > lep_p4[1].pt()" --histo-name subleadlep_elmu_tt_ltaul_lep1_pt --output subleadlep_elmu_tt_ltaul_lep1_pt.root gstore_outdirs/v31v27/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v31v27_MC2016_Summer16_TTJets_powheg/180522_225221/0000/*root &

subleadlep_elmu_tt_elmu_lep0_pt->Scale(1./subleadlep_elmu_tt_elmu_lep0_pt->Integral())
subleadlep_elmu_tt_elmu_lep1_pt->Scale(1./subleadlep_elmu_tt_elmu_lep1_pt->Integral())

subleadlep_elmu_tt_ltaul_lep0_pt->Scale(1./subleadlep_elmu_tt_ltaul_lep0_pt->Integral())
subleadlep_elmu_tt_ltaul_lep1_pt->Scale(1./subleadlep_elmu_tt_ltaul_lep1_pt->Integral())



subleadlep_elmu_tt_ltaul_lep0_pt->SetLineColor(kRed)
subleadlep_elmu_tt_ltaul_lep1_pt->SetLineColor(kRed)


subleadlep_elmu_tt_ltaul_lep0_pt->Draw()
subleadlep_elmu_tt_ltaul_lep1_pt->Draw("same")

subleadlep_elmu_tt_ltaul_lep0_pt->Draw()
subleadlep_elmu_tt_elmu_lep0_pt ->Draw("same")

subleadlep_elmu_tt_ltaul_lep1_pt->Draw()
subleadlep_elmu_tt_elmu_lep1_pt ->Draw("same")


















shape of Mt with lep-jet

in TT

python jobsums/get_shapes.py --formula "reNOM : lepJet " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL lepJet:merge-sets/v25/pCheckTight4SubLep/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL 

-- pract no difference


run in Data
























testing autoMC 0 for MC stat uncertainty

produce post-fit distrs
check the uncertainties in bins

./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor.txt
./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor_no_autoMC.txt

combine -M FitDiagnostics ttxsec/fit-stuff/v25p2_mu_2_recor.root --saveShapes --saveWithUncertainties --name MuShapesTestWithAutoMC --freezeParameters lumi_13TeV

Best fit r: 0.959184  -0.0719329/+0.0876966  (68% CL)
Done in 0.24 min (cpu), 0.24 min (real)

combine -M FitDiagnostics ttxsec/fit-stuff/v25p2_mu_2_recor_no_autoMC.root --saveShapes --saveWithUncertainties --name MuShapesTestNoAutoMC --freezeParameters lumi_13TeV

Best fit r: 0.959184  -0.0719329/+0.0876966  (68% CL)


python stack_postfit.py fitDiagnosticsMuShapesTestWithAutoMC.root ctr_old_mu_sel_lj    --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestWithAutoMC.root ctr_old_mu_sel_ljout --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestNoAutoMC.root   ctr_old_mu_sel_lj    --mu --ratio 
python stack_postfit.py fitDiagnosticsMuShapesTestNoAutoMC.root   ctr_old_mu_sel_ljout --mu --ratio 

root -l fitDiagnosticsMuShapesTestWithAutoMC.root

((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinContent(7)
(Double_t) 54.8818
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinError(7)
(Double_t) 7.46415

root -l fitDiagnosticsMuShapesTestNoAutoMC.root
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinContent(7)
(Double_t) 54.8818
((TH1D*) shapes_fit_s->Get("ctr_old_mu_sel_lj/wjets"))->GetBinError(7)
(Double_t) 7.46415



































continueing met phis

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL,Mt_lep_met_shifted 

python jobsums/get_shapes.py --formula "reNOM : shifted " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL shifted:merge-sets/v26/pF9/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL,Mt_lep_met_shifted 


python jobsums/get_shapes.py --formula "reNOM : shifted_reNOM " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL shifted_reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL,Mt_lep_met_shifted 

the shifts seem to correct bin 130,but not 120 (and not 140, which is not significant)
although not sure if the shift is large enough etc
(judging by the means of met x/y distrs it should be enough, but visually not sure)

finally the test of phi difference

!!! rev_met_phi !!!
-- did not work?
-- it just flips + to -

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d regMt_phi
python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d met_phi


merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root

./mc_v25v26pR5_updowns_HISTOSEL_regMt_phi_ctr_old_mu_sel_NOMINAL.root
./mc_v25v26pR5_updowns_HISTOSEL_met_phi_ctr_old_mu_sel_NOMINAL.root

ctr_old_mu_sel->Get("data/NOMINAL/ctr_old_mu_sel_data_NOMINAL_met_phi")
ctr_old_mu_sel->Get("sums_NOMINAL/mc_sum2_NOMINAL")

python flip_met_phi.py ./mc_v25v26pR5_updowns_HISTOSEL_met_phi_ctr_old_mu_sel_NOMINAL.root   output_met_phi.root
python flip_met_phi.py ./mc_v25v26pR5_updowns_HISTOSEL_regMt_phi_ctr_old_mu_sel_NOMINAL.root output_regMt_phi.root -d regMt_phi

flipped_mc->SetLineColor(kRed)
flipped_mc_2->SetLineColor(kRed)
flipped_mc_3->SetLineColor(kRed)
flipped_data->SetLineColor(kRed)


ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_mc->Draw("same")

ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_mc_2->Draw("same")

ctr_old_mu_sel_data_NOMINAL_met_phi->Draw()
flipped_data->Draw("same")

mc_sum2_NOMINAL->Draw()
flipped_mc_3->Draw("same")


ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_mc->Draw("same")

ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_mc_2->Draw("same")

ctr_old_mu_sel_data_NOMINAL_regMt_phi->Draw()
flipped_data->Draw("same")

-- seems like there is slight disagreement at positive phis in the sel (data>mc),
but in regMt it is leveled out, but slight disagreement (mc>data) apears at negative phis
as if data just moved down

there is slight asymetry in phi in data: more on positive side
no assymetry in mc

are there 2 minima in MC and omly 1 in data?

python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d met_phi -p -r --exp-leg

-- no, the #2 in MC is confusion due to zoomed scale and fluctuations and shift

the magnitude of the shift, the width seem equal in mc and data


python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d met_phi

python stack_plot.py mc_v25v26pR4.root ../merge-sets/v25/pR4/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_presel -d Mt_lep_met_shifted -p -r --exp-leg
-- the shift barely changes Mt in presel

python jobsums/get_shapes.py --formula "reNOM : shiftedMt" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL shiftedMt:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL,Mt_lep_met_shifted 

jet -> lep sub
Mt_lep_met_sublep

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d Mt_lep_met_sublep -p -r --exp-leg

-- same divergence in 120-130, but couple percent smaller

python get_shapes.py --formula "dataOut : dataVlooseOut" -d Mt_lep_met_f -p data -c ctr_old_mu_sel dataOut:../merge-sets/v25/pR5/SingleMuon.root:ctr_old_mu_sel_ljout,data,NOMINAL dataVlooseOut:../merge-sets/v25/pR5/SingleMuon.root:ctr_old_mu_selVloose_ljout,data,NOMINAL

-- data shape is from sel, but it should be right

-- in Vloose the bins seem to agree well, but data-qcd spoils the agreement a bit...
   and regMt_lep_pt seems much better, close to error bars and only 95 events more in MC
   in sel MC has 190 more events


compare shape to tight:

merge-sets/v25/pCheckTight/MC2016_Summer16_TTJets_powheg.root

python get_shapes.py --formula "mediumTau : tight : Vloose" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_sel mediumTau:mc_v25v26pR5_updowns.root:ctr_old_mu_sel,tt_mutau,NOMINAL Vloose:mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL tight:mc_norm/v25pCheckTight/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

-- same distr in all three selections





side check of nominal TES:

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -d tau_cor_control -p -r --exp-leg

merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root

python jobsums/get_shapes.py --formula "reNOM : nomTES" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL nomTES:merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL 

python jobsums/get_shapes.py --formula "reNOM : nomTES" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL nomTES:merge-sets/v25/pCheckNomTES/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL 

-- no difference
regMt_tau_pt has peak at 30 and fall by hyperbola










 compare to jet-tau substituted tt

python jobsums/get_shapes.py --formula "norm : subst" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL subst:merge-sets/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

python jobsums/get_shapes.py --formula "norm : subst" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL subst:merge-sets/v25/pCheckTight3/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL

compare data distr

python jobsums/get_shapes.py --formula "norm : subst" -d regMt_lep_pt -p data -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL subst:merge-sets/v25/pCheckTight3/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL

python jobsums/get_shapes.py --formula "norm : subst" -d Mt_lep_met_f -p data -c ctr_old_mu_sel norm:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL subst:merge-sets/v25/pCheckTight3/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL





python jobsums/get_shapes.py --formula "data : 0.921 tt_mutau + 0.079 tt_lj" -d regMt_tau_jet_scale -p tt_mutau -c ctr_old_mu_sel data:merge-sets/v25/pCheckTight2/SingleMuon.root:ctr_old_mu_sel,data,NOMINAL tt_mutau:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL tt_lj:merge-sets/v25/pCheckTight2/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_lj,NOMINAL








met phi stuff

python distr_ratios.py mc_v25v26pR5_updowns.root -c ctr_old_mu_sel -d met -p tt_mutau --var-distr met_pt_smallphi:met_pt_largephi

 --y-range 0.8,1.1 --add-x-line 40,130

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --qcd 1.05 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -p -r --exp-leg -d lep1_phi

python stack_plot.py mc_v25v26pR5_updowns.root ../merge-sets/v25/pR5/SingleMuon.root --lumi 35800 --qcd 1.05 --wjet 0.8 --factor-dy 1.05 -c ctr_old_mu_sel -p -r --exp-leg -d met_phi









Fit only ljout

./scripts/text2workspace.py ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.txt

combine -M MultiDimFit ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.txt --algo grid --points 100 --freezeNuisanceGroup tt_th_pdf --rMin 0.5 --rMax 1.5 --name MuShapesOnlyOut

-- 

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/v25p2_mu_2_recor_ljoutonly.root --freezeNuisanceGroup tt_th_pdf  -m 125 -o v25p2_mu_2_recor_ljoutonly.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i v25p2_mu_2_recor_ljoutonly.json -o v25p2_mu_2_recor_ljoutonly








event weight fluctuations

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_lj -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_lj -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_ljout       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_ljout -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f --y-range 0.8,1.1 --add-x-line 40,130


b weight fluctuations -- the fluctuations of b efficiencies are different in updown

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel_ljout       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose_ljout -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130

python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_sel       -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130
python distr_ratios.py mc_norm/mc_v25pCheckNomFSR.root -c ctr_old_mu_selVloose -d Mt_lep_met_f_init -p tt_mutau --var-distr Mt_lep_met_f:Mt_lep_met_f_w_in:Mt_lep_met_f_w_bf:Mt_lep_met_f_w_pu --y-range 0.8,1.1 --add-x-line 40,130















check norm and shapes of all proc in NOM VS FSR

results:
the yields are ok in all processes for FSR
this process did change them a little, maybe the shapes got shifted a bit,
but main issue with couple bins in mu selection is still there
(Vloose and main sel, in lj category and inclusive)

v25/pCheckNomFSR

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown



python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_taultauh,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_taultauh,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_taultauh,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_taultauh,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_taultauh,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_taultauh,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_taulj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_taulj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_taulj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_taulj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_taulj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_taulj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_sel_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_ljout,tt_other,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_ljout,tt_other,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_ljout,tt_other,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_sel_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_other,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_other,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_other,FSRDown





problematic bins in inclusive sel and Vloose

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_sel reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_sel,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_sel,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_sel,tt_mutau,FSRDown


no norm all chan in Vloose

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_taultauh,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_taultauh,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_taultauh,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taultauh -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_taultauh,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_taultauh,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_taultauh,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_taulj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_taulj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_taulj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_taulj -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_taulj,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_taulj,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_taulj,FSRDown


python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_selVloose_ljout reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_other,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_other,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_other,FSRDown

python jobsums/get_shapes.py --no-norm --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_other -c ctr_old_mu_selVloose_lj reNOM:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_other,NOMINAL FSRUp:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_other,FSRUp FSRDown:jobsums/mc_norm/v25pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_other,FSRDown














rateParams for ratio

dilep_norm              lnU         -              -              -              -              -              -              -              -              -              -              -              -              -              -     


rate_mutau              rateParam  mu   tt_mutau 13609.554

tau_ratio               param                    1.         0.1

./scripts/text2workspace.py ttxsec/fit-stuff/ratio_both_0.txt

combine -M MultiDimFit ttxsec/fit-stuff/ratio_both_0.txt --algo grid --points 100 --redefineSignalPOIs tau_ratio --freezeParameters r --saveSpecifiedNuis dilep_norm --rMin 0.5 --rMax 1.5 --name RatioElMuShapes

--expectSignal 1

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts.json -o latest_ratio_toys_asimov_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts --redefineSignalPOIs tau_ratio --freezeParameters r --freezeNuisanceGroup tt_updowns -t -1  -d ttxsec/fit-stuff/ratio_both_0.root -m 125 -o latest_ratio_toys_asimov_impacts_no_updowns.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_ratio_toys_asimov_impacts_no_updowns.json -o latest_ratio_toys_asimov_impacts_no_updowns

--setParameters tt_elmu=1.0,tt_mutau=1.0











../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf  -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_mu.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 -o latest_mu_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_mu_impacts.json -o latest_mu_impacts


../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts

../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doInitialFit
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 --robustFit 1 --doFits --parallel 5
../../CombineHarvester/CombineTools/scripts/combineTool.py -M Impacts -d ttxsec/fit-stuff/latest_datacard_el.root --freezeNuisanceGroup tt_th_pdf --freezeParameters FSR -m 125 -o latest_el_impacts.json
../../CombineHarvester/CombineTools/scripts/plotImpacts_my.py -i latest_el_impacts.json -o latest_el_impacts



python yield_variations.py -p tt_taultauh,tt_lj,tt_other,tt_mutau,tt_taulj mc_v25v26pR5_updowns_with_data.root -c ctr_old_mu_sel_lj,ctr_old_mu_sel_ljout -d Mt_lep_met_f -s TuneCUETP8M2T4,FSR,ISR,HDAMP --to-average
INFO:root:import ROOT
                         ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj     ctr_old_mu_sel_lj  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout  ctr_old_mu_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj           tt_taultauh                 tt_lj              tt_other              tt_mutau              tt_taulj
      TuneCUETP8M2T4           0.965/1.035           1.009/0.991           1.060/0.940           1.009/0.991           1.032/0.968           1.030/0.970           1.032/0.968           1.015/0.985           1.004/0.996           1.033/0.967
                 FSR           1.095/0.905           1.486/0.514           1.341/0.659           1.079/0.921           1.483/0.517           1.067/0.933           1.457/0.543           1.323/0.677           1.081/0.919           1.419/0.581
                 ISR           0.976/1.024           1.023/0.977           0.949/1.051           1.003/0.997           1.019/0.981           1.016/0.984           1.027/0.973           1.000/1.000           1.018/0.982           1.054/0.946
               HDAMP           0.963/1.037           0.981/1.019           0.955/1.045           0.979/1.021           1.007/0.993           0.994/1.006           0.992/1.008           0.933/1.067           1.001/0.999           0.969/1.031


python yield_variations.py -p tt_taultauh,tt_lj,tt_other,tt_eltau,tt_taulj mc_v25p2_v26p2_updowns2_with_data.root -c ctr_old_el_sel_lj,ctr_old_el_sel_ljout -d Mt_lep_met_f -s TuneCUETP8M2T4,FSR,ISR,HDAMP --to-average
INFO:root:import ROOT
                         ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj     ctr_old_el_sel_lj  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout  ctr_old_el_sel_ljout
                               tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj           tt_taultauh                 tt_lj              tt_other              tt_eltau              tt_taulj
      TuneCUETP8M2T4           1.015/0.985           1.036/0.964           1.009/0.991           1.013/0.987           0.963/1.037           0.986/1.014           1.006/0.994           1.014/0.986           1.005/0.995           0.974/1.026
                 FSR           1.077/0.923           1.480/0.520           1.325/0.675           1.065/0.935           1.456/0.544           1.119/0.881           1.461/0.539           1.318/0.682           1.084/0.916           1.478/0.522
                 ISR           0.999/1.001           1.026/0.974           0.969/1.031           1.002/0.998           0.996/1.004           1.023/0.977           1.022/0.978           1.010/0.990           1.013/0.987           1.053/0.947
               HDAMP           0.931/1.069           1.000/1.000           0.872/1.128           1.004/0.996           0.981/1.019           1.008/0.992           0.996/1.004           0.973/1.027           0.987/1.013           0.958/1.042






rate nuisances for updowns

muons

nominals

ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj        ctr_old_mu_sel_lj
tt_taultauh              tt_lj                    tt_other                 tt_mutau                 tt_taulj         
3                        1                        4                        0                        2                
0.009                    0.107                    0.003                    0.147                    0.007            

ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     ctr_old_mu_sel_ljout     
tt_taultauh              tt_lj                    tt_other                 tt_mutau                 tt_taulj                 
3                        1                        4                        0                        2                        
0.017                    0.081                    0.006                    0.273                    0.005                    









testing the full selection of tt_mutau process

1) repeate the sumup in pyroot

python mu_sel_test.py mu_sel_test_nom.root      gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python mu_sel_test.py mu_sel_test_fsr_down.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &
python mu_sel_test.py mu_sel_test_fsr_up.root   gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &

2) add propper jets and tau selection (with anti-lepmatch)

3) add main weights (LEP, PU, bSF)




sumup mutau only
and compare with selection

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mutau_mu1t3j1b_leptaucuts_ttfsr_Mt   --output tt_mutau_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) > 15*15) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) > 15*15)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mutau_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_mutau_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &

-- the fsr variations are weak

and in mujets (it should have larger effect from fsr)

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name  tt_muj_mu1t3j1b_leptaucuts_ttnom_Mt   --output tt_muj_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_muj_mu1t3j1b_leptaucuts_ttfsr_Mt   --output tt_muj_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "((abs(gen_t_w_decay_id) == 13 && abs(gen_tb_w_decay_id) == 1) || (abs(gen_tb_w_decay_id) == 13 && abs(gen_t_w_decay_id) == 1)) && abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_muj_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_muj_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &




rerun selection on nominal TT and FSR up-down
v25 pCheckNomFSR

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown



python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_mutau,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_mutau,FSRDown

python jobsums/get_shapes.py --formula "reNOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_lj,NOMINAL FSRUp:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrup.root:ctr_old_mu_selVloose,tt_lj,FSRUp FSRDown:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg_fsrdown.root:ctr_old_mu_selVloose,tt_lj,FSRDown &

compare nominal to the fit one:

python jobsums/get_shapes.py --formula "reNOM : NOMold " -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose reNOM:merge-sets/v25/pCheckNomFSR/MC2016_Summer16_TTJets_powheg.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL NOMold:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose,tt_mutau,NOMINAL 






same stuff with electrons

get_shapes:

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_lj NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_lj,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRDown

python jobsums/get_shapes.py --formula "NOM : ISRUp : ISRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL ISRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,ISRUp ISRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,ISRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_eltau -c ctr_old_el_selVloose_ljout NOM:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,NOMINAL FSRUp:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRUp FSRDown:jobsums/mc_v25p2_v26p2_updowns2.root:ctr_old_el_selVloose_ljout,tt_eltau,FSRDown

compare with full plot:

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_selVloose -d Mt_lep_met_f

python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_sel_lj    -x ctr_old_el_selVloose_lj    -d Mt_lep_met_f
python stack_plot.py mc_v25p2_v26p2_updowns2.root ../merge-sets/v25/p2/SingleElectron.root --lumi 31300 -p -r --qcd 1.05 --wjet 0.85 --factor-dy 1.05 -c ctr_old_el_sel_ljout -x ctr_old_el_selVloose_ljout -d Mt_lep_met_f

full plot from fitting file:

../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root

python stack_plot.py ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root -p -r -c ctr_old_el_sel_lj    -d Mt_lep_met_f
python stack_plot.py ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root ../../fit-stuff/histosels_mc_v25p2_v26p2_updowns2_el_w-qcd-prop.root -p -r -c ctr_old_el_sel_ljout -d Mt_lep_met_f


and sumup:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name tt_el1t3j1b_leptaucuts_ttnom_Mt --output tt_el1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_el1t3j1b_leptaucuts_ttfsr_Mt --output tt_el1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 11 && HLT_el && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_el1t3j1b_leptaucuts_ttfsrup_Mt --output tt_el1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &






add lep and tau pt cut:

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0" --histo-name tt_mu1t3j1b_leptaucuts_ttnom_Mt --output tt_mu1t3j1b_leptaucuts_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_leptaucuts_ttfsr_Mt --output tt_mu1t3j1b_leptaucuts_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 20,0,250 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && lep_p4[0].pt() > 30. && abs(lep_p4[0].eta()) < 2.4 && tau_p4[0].pt() > 30 && abs(tau_p4[0].eta()) < 2.4 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_leptaucuts_ttfsrup_Mt --output tt_mu1t3j1b_leptaucuts_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &







python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0" --histo-name tt_mu1t3j1b_ttnom_Mt --output tt_mu1t3j1b_ttnom_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_ttfsr_Mt --output tt_mu1t3j1b_ttfsr_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &

python sumup_ttree_distrs.py "sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py())))" --histo-range 250,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 " --histo-name tt_mu1t3j1b_ttfsrup_Mt --output tt_mu1t3j1b_ttfsrup_Mt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrup_ext2/*/0000/*root &








python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 200,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) > 110" --histo-name tt_mu1t3j1b_ttnom_leppt --output tt_mu1t3j1b_ttnom_leppt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg/180409_022217/0000/*root &

python sumup_ttree_distrs.py "lep_p4[0].pt()" --histo-range 200,0,200 --cond-com "abs(leps_ID) == 13 && HLT_mu && lep_matched_HLT[0] && tau_IDlev[0] > 2 && njets > 2 && nbjets > 0 && sqrt(2*(sqrt((met_init.Px()*met_init.Px() + met_init.Py()*met_init.Py())*(lep_p4[0].Px()*lep_p4[0].Px() + lep_p4[0].Py()*lep_p4[0].Py())) - (met_init.Px()*lep_p4[0].Px() + met_init.Py()*lep_p4[0].Py()))) > 110" --histo-name tt_mu1t3j1b_ttfsr_leppt --output tt_mu1t3j1b_ttfsr_leppt.root gstore_outdirs/v25/TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8/Ntupler_v25_MC2016_Summer16_TTJets_powheg_fsrdown_ext2/180411_005426/0000/*root &














python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d regMt_lep_pt -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown






python jobsums/get_shapes.py --no-norm --formula "NOM : ISRUp : ISRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL ISRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,ISRUp ISRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,ISRDown





python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,FSRDown

python jobsums/get_shapes.py --no-norm --formula "NOM : FSRUp : FSRDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL FSRUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRUp FSRDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,FSRDown







python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,HDAMPDown

python jobsums/get_shapes.py --no-norm --formula "NOM : HDAMPUp : HDAMPDown" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL HDAMPUp:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,HDAMPUp HDAMPDown:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,HDAMPDown








python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_mutau,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_mutau -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_mutau,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_lj NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_lj,tt_lj,TuneCUETP8M2T4Down

python jobsums/get_shapes.py --no-norm --formula "NOM : TuneCUETP8M2T4Up : TuneCUETP8M2T4Down" -d Mt_lep_met_f -p tt_lj -c ctr_old_mu_selVloose_ljout NOM:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,NOMINAL TuneCUETP8M2T4Up:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,TuneCUETP8M2T4Up TuneCUETP8M2T4Down:jobsums/mc_v25v26pR5_updowns.root:ctr_old_mu_selVloose_ljout,tt_lj,TuneCUETP8M2T4Down




