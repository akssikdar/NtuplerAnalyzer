
cat merge_jobs_* > all_merge_jobs

foreach d (`grep --only-matching "/lstore[^ ]*" all_merge_jobs | uniq`)
mkdir $d
end

wc -l all_merge_jobs / n_queues

n_queues = 5+5+5+12+12

split -l 60 all_merge_jobs queue_all_merge_

ls queue_all_merge_* > queue_commands

-- split them into 5 5 5 12 12

ssh fermi01 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands1 "'
ssh fermi02 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands2 "'
ssh fermi03 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands3 "'
ssh fermi04 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands4 "'
ssh fermi05 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands5 "'

merge-sets/queue_commands_tt_fsr_1  merge-sets/queue_commands_tt_fsr_2  merge-sets/queue_commands_tt_fsr_5
queue_commands_tt_only_1
queue_commands_tt_only_2
queue_commands_tt_only_3
queue_commands_tt_only_5

test on resources
ssh fermi01 'screen -d -m bash -c "lscpu | grep ^CPU ; uptime ; bash" '
ssh fermi02 'screen -d -m bash -c "lscpu | grep ^CPU ; uptime ; bash" '
ssh fermi03 'screen -d -m bash -c "lscpu | grep ^CPU ; uptime ; bash" '
ssh fermi04 'screen -d -m bash -c "lscpu | grep ^CPU ; uptime ; bash" '
ssh fermi05 'screen -d -m bash -c "lscpu | grep ^CPU ; uptime ; bash" '

ssh fermi04 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/merge_jobs_w4jets_wjetsamcatnlo_commands_4 "'
ssh fermi05 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/merge_jobs_w4jets_wjetsamcatnlo_commands_5 "'

ssh fermi01 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands_wjets-dy_1 "'
ssh fermi02 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands_wjets-dy_2 "'
ssh fermi03 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands_wjets-dy_3 "'
ssh fermi04 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands_wjets-dy_4 "'
ssh fermi05 'screen -d -m tcsh -c "source /exper-sw/cmst3/cmssw/users/olek/CMSSW_8_0_26_patch1/src/UserCode/NtuplerAnalyzer/merge-sets/queue_commands_wjets-dy_5 "'

hadd-ing

foreach d (`cat merge-sets/jobs_hadd.dtags.small`)
hadd merge-sets/v14/raw2/$d.root /lstore/cms/olek/outdirs/v14/proc-raw/$d/*.root &
end

foreach d (`cat merge-sets/jobs_hadd.dtags.large_aa`)
hadd merge-sets/v14/raw2/$d.root /lstore/cms/olek/outdirs/v14/proc-raw/$d/*.root &
end

foreach d (`cat merge-sets/jobs_hadd.dtags.large_ab`)
hadd merge-sets/v14/raw2/$d.root /lstore/cms/olek/outdirs/v14/proc-raw/$d/*.root &
end

foreach d (SingleMuon SingleElectron)

hadd merge-sets/v13-0/run_2/tt_systs/MC2016_Summer16_TTJets_powheg_FSRDown.root /lstore/cms/olek/outdirs/v13-0/run_2/tt_systs/MC2016_Summer16_TTJets_powheg_FSRDown/*root &
hadd merge-sets/v13-0/run_2/tt_systs/MC2016_Summer16_TTJets_powheg_FSRUp.root   /lstore/cms/olek/outdirs/v13-0/run_2/tt_systs/MC2016_Summer16_TTJets_powheg_FSRUp/*root &

